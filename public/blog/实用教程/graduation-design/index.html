<!DOCTYPE html>
<html lang="en-US">

<head>
  <meta http-equiv="X-Clacks-Overhead" content="GNU Terry Pratchett" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="shortcut icon" href="https://bu.dusays.com/2024/04/23/6627ad7c08194.jpeg" />
<title>[æ¯•ä¸šè®¾è®¡] åŸºäºYoloçš„èˆªæ‹å›¾åƒé»‘åŒ£å­æ£€æµ‹ç®—æ³•è®¾è®¡ | Hugo Ê•â€¢á´¥â€¢Ê” Bear Blog</title>
<meta name="title" content="[æ¯•ä¸šè®¾è®¡] åŸºäºYoloçš„èˆªæ‹å›¾åƒé»‘åŒ£å­æ£€æµ‹ç®—æ³•è®¾è®¡" />
<meta name="description" content="è¿™ç¯‡æ–‡ç« éšè¿›åº¦æ›´æ–°ï¼Œç”¨äºè®°å½•åœ¨æ¯•è®¾è¿‡ç¨‹ä¸­é‡åˆ°çš„å¿ƒå¾—å’Œé—®é¢˜ã€‚" />
<meta name="keywords" content="å®ç”¨æ•™ç¨‹," />


<meta property="og:title" content="[æ¯•ä¸šè®¾è®¡] åŸºäºYoloçš„èˆªæ‹å›¾åƒé»‘åŒ£å­æ£€æµ‹ç®—æ³•è®¾è®¡" />
<meta property="og:description" content="è¿™ç¯‡æ–‡ç« éšè¿›åº¦æ›´æ–°ï¼Œç”¨äºè®°å½•åœ¨æ¯•è®¾è¿‡ç¨‹ä¸­é‡åˆ°çš„å¿ƒå¾—å’Œé—®é¢˜ã€‚" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://hugo.matrixcore.life/blog/%E5%AE%9E%E7%94%A8%E6%95%99%E7%A8%8B/graduation-design/" /><meta property="og:image" content="https://hugo.matrixcore.life/images/share.png"/><meta property="article:section" content="Blog" />
<meta property="article:published_time" content="2024-03-01T00:00:00+00:00" />
<meta property="article:modified_time" content="2024-03-01T00:00:00+00:00" /><meta property="og:site_name" content="Hugo Ê•â€¢á´¥â€¢Ê” Bear" />



<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://hugo.matrixcore.life/images/share.png"/>

<meta name="twitter:title" content="[æ¯•ä¸šè®¾è®¡] åŸºäºYoloçš„èˆªæ‹å›¾åƒé»‘åŒ£å­æ£€æµ‹ç®—æ³•è®¾è®¡"/>
<meta name="twitter:description" content="è¿™ç¯‡æ–‡ç« éšè¿›åº¦æ›´æ–°ï¼Œç”¨äºè®°å½•åœ¨æ¯•è®¾è¿‡ç¨‹ä¸­é‡åˆ°çš„å¿ƒå¾—å’Œé—®é¢˜ã€‚"/>



<meta itemprop="name" content="[æ¯•ä¸šè®¾è®¡] åŸºäºYoloçš„èˆªæ‹å›¾åƒé»‘åŒ£å­æ£€æµ‹ç®—æ³•è®¾è®¡">
<meta itemprop="description" content="è¿™ç¯‡æ–‡ç« éšè¿›åº¦æ›´æ–°ï¼Œç”¨äºè®°å½•åœ¨æ¯•è®¾è¿‡ç¨‹ä¸­é‡åˆ°çš„å¿ƒå¾—å’Œé—®é¢˜ã€‚"><meta itemprop="datePublished" content="2024-03-01T00:00:00+00:00" />
<meta itemprop="dateModified" content="2024-03-01T00:00:00+00:00" />
<meta itemprop="wordCount" content="3834"><meta itemprop="image" content="https://hugo.matrixcore.life/images/share.png"/>
<meta itemprop="keywords" content="å®ç”¨æ•™ç¨‹," />
<meta name="referrer" content="no-referrer-when-downgrade" />

  <style>
  body {
    font-family: Verdana, sans-serif;
    margin: auto;
    padding: 20px;
    max-width: 720px;
    text-align: left;
    background-color: #fff;
    word-wrap: break-word;
    overflow-wrap: break-word;
    line-height: 1.5;
    color: #444;
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6,
  strong,
  b {
    color: #222;
  }

  a {
    color: #3273dc;
     
  }

  .title {
    text-decoration: none;
    border: 0;
  }

  .title span {
    font-weight: 400;
  }

  nav a {
    margin-right: 10px;
  }

  textarea {
    width: 100%;
    font-size: 16px;
  }

  input {
    font-size: 16px;
  }

  content {
    line-height: 1.6;
  }

  table {
    width: 100%;
  }

  img {
    max-width: 100%;
  }

  code {
    padding: 2px 5px;
    background-color: #f2f2f2;
  }

  pre code {
    color: #222;
    display: block;
    padding: 20px;
    white-space: pre-wrap;
    font-size: 14px;
    overflow-x: auto;
  }

  div.highlight pre {
    background-color: initial;
    color: initial;
  }

  div.highlight code {
    background-color: unset;
    color: unset;
  }

  blockquote {
    border-left: 1px solid #999;
    color: #222;
    padding-left: 20px;
    font-style: italic;
  }

  footer {
    padding: 25px;
    text-align: center;
  }

  .helptext {
    color: #777;
    font-size: small;
  }

  .errorlist {
    color: #eba613;
    font-size: small;
  }

   
  ul.blog-posts {
    list-style-type: none;
    padding: unset;
  }

  ul.blog-posts li {
    display: flex;
  }

  ul.blog-posts li span {
    flex: 0 0 130px;
  }

  ul.blog-posts li a:visited {
    color: #8b6fcb;
  }

  @media (prefers-color-scheme: dark) {
    body {
      background-color: #333;
      color: #ddd;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6,
    strong,
    b {
      color: #eee;
    }

    a {
      color: #8cc2dd;
    }

    code {
      background-color: #777;
    }

    pre code {
      color: #ddd;
    }

    blockquote {
      color: #ccc;
    }

    textarea,
    input {
      background-color: #252525;
      color: #ddd;
    }

    .helptext {
      color: #aaa;
    }
  }

</style>

</head>

<body>
  <header><a href="/" class="title">
  <h2>Hugo Ê•â€¢á´¥â€¢Ê” Bear Blog</h2>
</a>
<nav><a href="/">Home</a>


<a href="/blog">Blog</a>

</nav>
</header>
  <main>

<content>
  <h1 id="å‰è¨€">å‰è¨€</h1>
<hr>
<blockquote>
<p>ğŸ’¡   é¦–å…ˆéœ€è¦æ„Ÿè°¢å­¦æ ¡ä¸ºæˆ‘ä»¬æä¾›çš„ä¸€ä¸ªè‰¯å¥½çš„å­¦ä¹ å¹³å°ï¼Œè®©æˆ‘ä»¬é€šè¿‡æ¯•è®¾æ¥äº†è§£é¡¹ç›®å¼€å‘çš„æµç¨‹ï¼Œå¹¶é€šè¿‡æ ‡å‡†åŒ–çš„ä¹¦å†™æ¥è§„èŒƒæ ¼å¼ã€‚æ„Ÿè°¢ç½—è€å¸ˆçš„è€å¿ƒæŒ‡å¯¼å’Œå¸®åŠ©ï¼Œåœ¨å®é™…æ¯•è®¾çš„å†™ä½œè¿‡ç¨‹ä¸­ï¼Œå…³æ³¨ç€æˆ‘ä»¬çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ã€‚<br>
åŒæ—¶éœ€è¦æ„Ÿè°¢å…¬å¸<a href="http://www.andawell.com/">Andawell</a>çš„æ”¯æŒï¼Œèƒ½ä¸ºæˆ‘æä¾›åœ¨å…¬å¸è¾¹å®ä¹ è¾¹åšæ¯•è®¾çš„æœºä¼šã€‚åŒæ—¶èƒ½å°†æ¯•è®¾ä¸é¡¹ç›®å¼€å‘çš„æ ‡å‡†æ›´å¥½åœ°ç»“åˆã€‚<br>
æœ€åè¿˜éœ€è¦é¼“åŠ±è‡ªå·±ï¼Œå› ä¸ºéœ€è¦ä»˜å‡ºå¾ˆå¤šçš„åŠªåŠ›ã€‚</p>
</blockquote>
<h1 id="æ­£æ–‡">æ­£æ–‡</h1>
<hr>
<p>ä¸€æ–¹é¢ä¸»è¦æ˜¯æŠ€æœ¯ä¸Šçš„è¦æ±‚ï¼Œä¸€æ–¹é¢ä¸»è¦æ˜¯è®ºæ–‡ä¸Šçš„æ’ç‰ˆã€‚ç„¶åå¸Œæœ›æˆ‘é‡åˆ°çš„é—®é¢˜ï¼Œä¹Ÿèƒ½å¸®åˆ°å¤§å®¶ã€‚</p>
<h2 id="wordä¸­mathtypeå…¬å¼åä¸Šæµ®æˆ–åä¸‹æ²‰æ€ä¹ˆåŠ"><strong>wordä¸­mathtypeå…¬å¼åä¸Šæµ®æˆ–åä¸‹æ²‰æ€ä¹ˆåŠ</strong></h2>
<hr>
<p>åˆšæ‰é‡åˆ°äº†å…¬å¼ä¸Šæµ®çš„é—®é¢˜ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯amathè¿›è¡Œå…¬å¼çš„ç¼–å†™ï¼Œæ­é…å›¾ç‰‡è½¬latexè¿›è¡Œè°ƒæ•´ã€‚ç„¶åæ‰¾åˆ°äº†è¿™ä¸ªé—®é¢˜çš„è§£å†³åŠæ³•ã€‚æ„Ÿè°¢whuæ•°ç å›æä¾›çš„<a href="https://jingyan.baidu.com/article/09ea3edef9845480aede39a5.html">å›ç­”</a>ã€‚</p>
<h2 id="å¦‚ä½•ä½¿ç”¨å›¾ç‰‡è½¬latex">å¦‚ä½•ä½¿ç”¨å›¾ç‰‡è½¬latex</h2>
<hr>
<p>ä¹‹å‰æœ‰åŒå­¦é—®è¿‡æˆ‘è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»Šå¤©ä¹Ÿå†ä¸€æ¬¡é‡åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œçœ‹åˆ°è®ºæ–‡ä¸­å¤æ‚çš„å…¬å¼ï¼Œä¸€ç­¹è«å±•æ€ä¹ˆåŠï¼Œå¯ä»¥é€šè¿‡å›¾ç‰‡è½¬latexçš„æ–¹å¼ï¼Œè¿™æ˜¯æˆ‘æ¯”è¾ƒå¸¸ç”¨çš„æ–¹å¼ï¼Œä½†æ˜¯ç°åœ¨ä¸»æµçš„è½¬latexçš„å¥½çš„è½¯ä»¶ä¸å¤šï¼Œåœ¨æ­¤ç‰¹åˆ«æ„Ÿè°¢<a href="https://simpletex.cn/ai/latex_ocr">simpletex</a>æä¾›çš„æ”¯æŒã€‚</p>
<h2 id="å…³äºè¯­ç—…çš„ä¿®æ”¹">å…³äºè¯­ç—…çš„ä¿®æ”¹</h2>
<hr>
<p>æ„Ÿè°¢upä¸»ï¼š<a href="https://space.bilibili.com/26021795">ç”¨é•œå¤´è®°å½•æˆé•¿</a>ï¼Œå‚è€ƒ<a href="https://www.bilibili.com/video/BV1PB4y1U7JU/?buvid=XYA9A96A2DBF2E51A918ECE55EFA494C98935&amp;is_story_h5=false&amp;mid=nPIoZdTfuXw2Qtcat9xxZw%3D%3D&amp;p=1&amp;plat_id=114&amp;share_from=ugc&amp;share_medium=android&amp;share_plat=android&amp;share_session_id=e1117509-5d59-4fd0-b122-21d23e500899&amp;share_source=WEIXIN&amp;share_tag=s_i&amp;timestamp=1693714483&amp;unique_k=HFqrbnI&amp;up_id=26021795&amp;share_times=1&amp;vd_source=237e295a40d7aaea043ead8c0d2c78ab">è®ºæ–‡å†™ä½œè¡¨è¾¾è¯­å¥è¡¨è¾¾ç³»åˆ—è¯¾ç¨‹ ä¸€ ç—…å¥ä¿®æ”¹ æˆåˆ†æ®‹ç¼º_å“”å“©å“”å“©_bilibili</a>è¯¥è§†é¢‘è¿›è¡Œæ€»ç»“ã€‚</p>
<!-- raw HTML omitted -->
<h3 id="ä¸€ä¸»è¯­æ®‹ç¼º">ä¸€ã€ä¸»è¯­æ®‹ç¼º</h3>
<hr>
<ul>
<li><strong>æ»¥ç”¨ä»‹è¯</strong></li>
</ul>
<blockquote>
<p>ä»è¿™ä»¶å°äº‹ï¼Œè¯´æ˜ä¸€ä¸ªé“ç†</p>
</blockquote>
<p>åº”æ”¹ä¸ºï¼Œè¿™ä»¶å°äº‹è¯´æ˜ä¸€ä¸ªé“ç†ã€‚ä¸Šè¿°ä¾‹å­ä¸­ç¼ºå°‘ä¸»è¯­ã€‚</p>
<blockquote>
<p>å½“å­¦ç”Ÿäº†è§£äº†ç¾æ˜¯ä»€ä¹ˆï¼Œå°±ä¼šä»¥ç¾çš„æ ‡å‡†ç±³è§„èŒƒè‡ªå·±çš„è¡Œä¸ºå’Œæ€æƒ³ã€‚</p>
</blockquote>
<p>åº”å»é™¤â€œå½“â€å­—ã€‚</p>
<ul>
<li><strong>æ»¥ç”¨ä½¿ä»¤åŠ¨è¯</strong></li>
</ul>
<blockquote>
<p>é€šè¿‡è¿™ä»¶å°äº‹ï¼Œä½¿æˆ‘æ˜ç™½äº†ä¸€ä¸ªé“ç†ã€‚</p>
</blockquote>
<p>å»é™¤â€é€šè¿‡â€œäºŒå­—ã€‚</p>
<blockquote>
<p>é€šè¿‡å¯¹è¯¥è¯¾é¢˜çš„ç ”ç©¶ï¼Œå¾—å‡ºæ–°æ—¶ä»£ç²¾ç¥çš„å«ä¹‰ã€‚</p>
</blockquote>
<p>éœ€æ·»åŠ ä¸»è¯­ï¼Œä¾‹å¦‚â€œç¬”è€…å¾—å‡ºâ€¦â€¦â€<strong>(å¦å¤–è¿˜éœ€è¦å°½é‡é¿å…åœ¨è®ºæ–‡ä¸­ä½¿ç”¨â€œæˆ‘â€å­—)</strong></p>
<ul>
<li><strong>åæ­£çŸ­è¯­ç¼ºä¸­å¿ƒè¯­</strong></li>
</ul>
<blockquote>
<p>è¯¾å ‚æ•™å­¦ä½æ•ˆï¼Œä¸€ç›´æœªå¾—åˆ°è§£å†³ã€‚</p>
</blockquote>
<p>éœ€åœ¨â€ä½æ•ˆâ€œåé¢åŠ ä¸Šâ€çš„é—®é¢˜â€œ</p>
<blockquote>
<p>æˆ‘å¯¹ç»æµä¸ç”Ÿæ´»è¿™æœ¬æ•™ææ„Ÿåˆ°å›°æ„Ÿã€‚</p>
</blockquote>
<p>éœ€åœ¨â€œæ•™æâ€åé¢åŠ ä¸Šâ€œçš„å†…å®¹â€</p>
<ul>
<li><strong>æ»¥ç”¨çœç•¥</strong></li>
</ul>
<blockquote>
<p>åœ¨ç»å†äº†å‡ åƒå¹´çš„å°å»ºç»Ÿæ²»åï¼Œäººä»¬åˆå¼€å§‹é‡è§†è¢«ç¦é”¯çš„å¤å…¸æ–‡åŒ–ï¼Œå¹¶æˆä¸ºäººæ–‡ä¸»ä¹‰è€…çš„æ­¦å™¨ï¼Œç”¨ç±³åå¯¹ç¥æƒã€‚</p>
</blockquote>
<p>åº”æ”¹ä¸ºâ€å¤å…¸æ–‡åŒ–å¹¶æˆä¸ºäººæ–‡ä¸»ä¹‰è€…çš„æ­¦å™¨â€œ</p>
<ul>
<li><strong>åŠ©è¯ç”¨é”™</strong></li>
</ul>
<blockquote>
<p>2022å¹´é¢å¸ƒäº†ã€Šå®¶åº­æ•™è‚²æŒ‡å¯¼æ³•ã€‹ï¼Œæ˜¯æˆ‘å›½é¦–éƒ¨å®¶åº­æ•™è‚²æ³•ã€‚</p>
</blockquote>
<p>æŠŠâ€œäº†â€æ”¹æˆâ€œçš„â€</p>
<h3 id="äºŒè°“è¯­æ®‹ç¼º">äºŒã€è°“è¯­æ®‹ç¼º</h3>
<hr>
<ul>
<li><strong>å¥é¦–ç¼ºè°“å¦èµ·å¤´</strong></li>
</ul>
<blockquote>
<p>ç»è¿‡å‡ åå¹´çš„åŠªåŠ›ï¼Œæˆ‘å›½å·±ç»ç‹¬ç«‹è‡ªä¸»åœ°ç ”åˆ¶ã€å‘å°„ã€è·Ÿè¸ªå’Œæµ‹æ£€åœ°çƒåŒæ­¥é€šè®¯å«æ˜Ÿçš„èƒ½åŠ›ã€‚</p>
</blockquote>
<p>å…·å¤‡â€¦â€¦çš„èƒ½åŠ›</p>
<blockquote>
<p>æŸå¤§å­¦å·¥å•†ç®¡ç†å­¦é™¢åœ¨è¯¾ç¨‹è®¾ç½®ä¸Šé™¤äº†ä¸“ä¸šè¯¾ã€å¤–è¯­è¯¾ã€æ”¿æ²»ç†è®ºè¯¾ï¼Œè¿˜åŒ…æ‹¬æ¼”è®²ä¸å£æ‰ã€åŸºç¡€å†™ä½œç­‰è¯¾ç¨‹ï¼Œä»¥è¿›ä¸€æ­¥æé«˜è¯´å†™æ–¹é¢çš„æŠ€èƒ½ã€‚</p>
</blockquote>
<p>é™¤äº†è®¾ç½®æœ‰â€¦â€¦ <strong>(ç¬¬ä¸€å¥è¯ç¼ºå°‘è°“è¯­)</strong></p>
<ul>
<li><strong>åŠ¨å®¾ç¼ºåŠ¨</strong></li>
</ul>
<blockquote>
<p>æˆ‘å¸‚æœ€è¿‘å‘åŠ¨äº†å…¨é¢çš„è´¨é‡å¤§æ£€æŸ¥è¿åŠ¨ï¼Œè¦åœ¨è¿™ä¸ªè¿åŠ¨ä¸­å»ºç«‹ä¸åŠ å¼ºæŠ€æœ¯ç®¡ç†åˆ¶åº¦ç­‰ä¸€ç³»åˆ—å·¥ä½œã€‚</p>
</blockquote>
<p>è¦åœ¨è¿™ä¸ªè¿åŠ¨ä¸­<strong>å®Œæˆ</strong>å»ºç«‹ä¸åŠ å¼ºæŠ€æœ¯ç®¡ç†åˆ¶åº¦ç­‰ä¸€ç³»åˆ—<strong>å·¥ä½œ</strong></p>
<blockquote>
<p>æ”¿åºœå¿…é¡»ä¸¥å‰æ‰“å‡»é£Ÿå“å®‰å…¨è¿æ³•è¿è§„è¡Œä¸ºçš„é«˜å‹æ€åŠ¿ï¼ŒåŠæ—¶æ¶ˆé™¤å„ç¯èŠ‚é¢†åŸŸçš„éšæ‚£ï¼Œåˆ›æ–°é£Ÿå“å®‰å…¨ç›‘ç®¡æƒ©å¤„ä½“åˆ¶æœºåˆ¶ã€‚</p>
</blockquote>
<p>ä¿æŒä¸¥å‰æ‰“å‡»â€¦</p>
<blockquote>
<p>æ•™å¸ˆåœ¨æ³•å¾‹ä¸“ä¸šçŸ¥è¯†å’Œé€»è¾‘æ€ç»´èƒ½åŠ›æå‡æ–¹é¢é¢ä¸´å›°éš¾ã€‚</p>
</blockquote>
<p>æ•™å¸ˆåœ¨æ³•å¾‹ä¸“ä¸šçŸ¥è¯†æ‹“å±•â€¦ (çŸ¥è¯†å’Œæå‡æ­é…ä¸æ˜¯éå¸¸å¥½ï¼Œæ­é…çŸ¥è¯†æ‹“å±•å¯èƒ½ä¼šæ›´å¥½)</p>
<h3 id="ä¸‰å®¾è¯­æ®‹ç¼º">ä¸‰ã€å®¾è¯­æ®‹ç¼º</h3>
<hr>
<ul>
<li><strong>åŠ¨å®¾ç¼ºå®¾</strong></li>
</ul>
<blockquote>
<p>å­¦æ ¡å®¿èˆã€æ•™å­¦æ¥¼ç­‰äººç¾¤å¯†é›†åŒºï¼Œä¸€ä¸”å‘ç”Ÿç«ç¾ï¼Œåæœä¸å ªè®¾æƒ³ï¼Œå› æ­¤å­¦ç”ŸæŒæ¡ç«ç¾ä¸­è‡ªæ•‘äº’æ•™ç›¸å½“é‡è¦ã€‚</p>
</blockquote>
<p>æŒæ¡â€¦æŠ€èƒ½</p>
<ul>
<li><strong>ä»‹å®¾ç¼ºå®¾</strong></li>
</ul>
<blockquote>
<p>è¿™éƒ¨ç”µå½±åœ¨å¡‘é€ äººç‰©å½¢è±¡æ‰€æä¾›çš„ç»éªŒæ˜¯éå¸¸å®è´µçš„ï¼Œ</p>
</blockquote>
<p>åœ¨â€¦æ–¹é¢</p>
<ul>
<li><strong>è¯¯å°†å®šè¯­å½“å®¾è¯­</strong></li>
</ul>
<blockquote>
<p>æ¡ƒèŠ±ä¹¡èµ°å¯æŒç»­å‘å±•ä¹‹è·¯ï¼ŒæŒ‰ç…§å»ºæˆç”Ÿæ€ç¯å¢ƒå’Œè°ä¼˜ç¾ã€èµ„æºé›†çº¦èŠ‚çº¦åˆ©ç”¨ã€ç»æµå’Œç¤¾ä¼šåè°ƒå‘å±•çš„ç”Ÿæ€ä¹¡ï¼Œåˆ¶å®šäº†äº”å¹´å‘å±•å»ºè®¾è§„åˆ’ã€‚</p>
</blockquote>
<p>æŒ‰ç…§â€¦ç›®æ ‡ï¼Œè§„åˆ’</p>
<h3 id="å››è™šè¯æ®‹ç¼º">å››ã€è™šè¯æ®‹ç¼º</h3>
<hr>
<ul>
<li><strong>ä»‹å®¾ç¼ºä»‹</strong></li>
</ul>
<blockquote>
<p>2014å¹´åº•ï¼Œæˆ‘å›½æ¢æœˆå·¥ç¨‹ä¸‰æœŸâ€œå†å…¥è¿”å›é£è¡Œâ€è¯•éªŒè·å¾—æˆåŠŸï¼Œç¡®ä¿å«¦å¨¥äº”å·ä»»åŠ¡é¡ºåˆ©å®æ–½å’Œæ¢æœˆå·¥ç¨‹æŒç»­æ¨è¿›è«å®šåšå®åŸºç¡€ï¼Œ</p>
</blockquote>
<p>ä¸ºâ€¦å¥ å®šåšå®åŸºç¡€</p>
<ul>
<li><strong>è¢«åŠ¨ç¼ºè¢«</strong></li>
</ul>
<blockquote>
<p>è¿™æœ¬ä¹¦éå¸¸æœ‰ä»·å€¼ï¼Œå¸¸å¸¸å›¾ä¹¦é¦†æ”¶è—ã€‚</p>
</blockquote>
<p>å¸¸å¸¸è¢«å›¾ä¹¦é¦†æ”¶è—</p>
<ul>
<li><strong>å¯¹è±¡ç¼ºå¯¹</strong></li>
</ul>
<blockquote>
<p>ç°ä»£å¥³æ€§è¶Šæ¥è¶Šç‹¬ç«‹ï¼Œå¥¹ä»¬é™¤äº†è‡ªå·±ç‹¬ç«‹æŒ£é’±å¤–ï¼Œå¯¹è‡ªèº«çš„ä»·å€¼ã€ç”Ÿæ´»ç¯å¢ƒä¹Ÿè¶Šå‘é‡è§†ï¼Œé‚£äº›ä»·å€¼å‰¥å‰Šã€æ€§éªšæ‰°ï¼Œå¥¹ä»¬å°†è¯´ä¸ã€‚</p>
</blockquote>
<p>å¯¹é‚£äº›ä»·å€¼å‰¥å‰Šã€æ€§éªšæ‰°ï¼Œå¥¹ä»¬å°†è¯´ä¸ã€‚</p>
<!-- raw HTML omitted -->
<h2 id="æ­å»ºyolov5ç¯å¢ƒ">æ­å»ºyolov5ç¯å¢ƒ</h2>
<hr>
<p>è¯¦ç»†å‚ç…§upä¸»ï¼š<a href="https://space.bilibili.com/456667721"><strong>æ€ç»ªäº¦æ— é™</strong></a>çš„ä»‹ç»ï¼š</p>
<p><a href="https://www.bilibili.com/video/BV1Hg4y1t78v/?spm_id_from=333.999.0.0&amp;vd_source=237e295a40d7aaea043ead8c0d2c78ab"><strong>Win11ä¸­ä»å¤´å®‰è£…è½¯ä»¶å’Œé…ç½®ç¯å¢ƒè¿è¡Œæ·±åº¦å­¦ä¹ é¡¹ç›®</strong></a></p>
<p>ç„¶åæœ€ä¸»è¦çš„è¿˜éœ€è¦å¼•å…¥è‹±ä¼Ÿè¾¾çš„CUDAï¼Œå¯ä»¥ç°åœ¨æœ¬åœ°è£…ï¼Œä½†æˆ‘è¿˜æ˜¯å€¾å‘äºé€‰æ‹©<a href="https://www.autodl.com/home">autodl</a>ï¼Œå› ä¸ºè¿™é‡Œå·²ç»é¢„è£…äº†cudaç¯å¢ƒã€‚</p>
<p>è¿™é‡Œç»†èŠ‚å¾ˆå¤šï¼Œä½†ç°åœ¨åˆè¿‡äº†å¥½ä¹…äº†ï¼Œ<strong>æœ‰ç‚¹å¿˜äº†</strong>ï¼Œåœ¨é€‰æ‹©åŸºç¡€é•œåƒçš„æ—¶å€™å°±åº”è¯¥è¦æ³¨æ„é€‰æ‹©åˆé€‚çš„ç‰ˆæœ¬ï¼Œä¸ç„¶åé¢é…ç½®cudaä¼šéº»çƒ¦æ­»ã€‚ï¼ˆçœ‹æ¥æ—¥å¿—è¿˜æ˜¯è¦åŠæ—¶è®°å½•ï¼Œå½“æ—¶è´¹äº†ä¸€ä¸‹åˆçš„åŠ²ï¼ŒçœŸæ˜¯æœäº†ï¼‰</p>
<h2 id="æ•°æ®é›†çš„é¢„å¤„ç†">æ•°æ®é›†çš„é¢„å¤„ç†</h2>
<hr>
<p>è¯¾é¢˜ä¸­yolov5çš„æ•°æ®é›†æ˜¯é‡‡ç”¨çš„èˆªæ‹è§†è§’ï¼Œåœ¨è‚‰çœ¼è¯†åˆ«å­˜åœ¨å›°éš¾ï¼Œè¿˜æœ‰å¾ˆå¤šå¹²æ‰°ã€‚æ‰€ä»¥éœ€è¦é¢„å…ˆå¯¹æ•°æ®é›†è¿›è¡Œåˆ‡ç‰‡å¤„ç†ã€‚ç„¶åæŒ‘å‡ºåˆ‡ç‰‡å®ŒååŒ…å«é»‘åŒ£å­çš„å›¾ç‰‡ï¼Œå†è¿›è¡Œæ ‡æ³¨ã€‚</p>
<p>ä»¥ä¸‹æ˜¯åˆ‡ç‰‡ç¨‹åºï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> PIL <span style="color:#f92672">import</span> Image
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> random
</span></span><span style="display:flex;"><span><span style="color:#75715e">#from PIL import Image: å¯¼å…¥Python Imaging Library (PIL) ä¸­çš„ Image æ¨¡å—ï¼Œç”¨äºå›¾åƒå¤„ç†ã€‚</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#import os: å¯¼å…¥ os æ¨¡å—ï¼Œç”¨äºå¤„ç†æ–‡ä»¶å’Œç›®å½•ã€‚</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#import random: å¯¼å…¥ random æ¨¡å—ï¼Œç”¨äºç”Ÿæˆéšæœºæ•°ã€‚</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">slice_and_save_images</span>(input_folder, output_folder, random_size<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, fixed_size<span style="color:#f92672">=</span>(<span style="color:#ae81ff">640</span>, <span style="color:#ae81ff">640</span>), overlap_ratio<span style="color:#f92672">=</span><span style="color:#ae81ff">0.2</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#å‡½æ•°çš„å®šä¹‰ï¼Œå®ƒæ¥æ”¶å‡ ä¸ªå‚æ•°ï¼ŒåŒ…æ‹¬è¾“å…¥è¾“å‡ºæ–‡ä»¶å¤¹è·¯å¾„ã€æ˜¯å¦éšæœºåˆ‡ç‰‡å¤§å°ã€å›ºå®šåˆ‡ç‰‡å¤§å°ä»¥åŠé‡å æ¯”ç‡ã€‚</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># è·å–è¾“å…¥æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>    image_files <span style="color:#f92672">=</span> [f <span style="color:#66d9ef">for</span> f <span style="color:#f92672">in</span> os<span style="color:#f92672">.</span>listdir(input_folder) <span style="color:#66d9ef">if</span> f<span style="color:#f92672">.</span>lower()<span style="color:#f92672">.</span>endswith((<span style="color:#e6db74">&#39;.png&#39;</span>, <span style="color:#e6db74">&#39;.jpg&#39;</span>, <span style="color:#e6db74">&#39;.jpeg&#39;</span>, <span style="color:#e6db74">&#39;.bmp&#39;</span>))]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># åˆ›å»ºè¾“å‡ºæ–‡ä»¶å¤¹</span>
</span></span><span style="display:flex;"><span>    os<span style="color:#f92672">.</span>makedirs(output_folder, exist_ok<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># å¾ªç¯å¤„ç†æ¯å¼ å›¾åƒ</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> image_file <span style="color:#f92672">in</span> image_files:
</span></span><span style="display:flex;"><span>        input_path <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(input_folder, image_file)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># æ‰“å¼€å›¾åƒ</span>
</span></span><span style="display:flex;"><span>        original_image <span style="color:#f92672">=</span> Image<span style="color:#f92672">.</span>open(input_path)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># è·å–å›¾åƒå¤§å°</span>
</span></span><span style="display:flex;"><span>        width, height <span style="color:#f92672">=</span> original_image<span style="color:#f92672">.</span>size
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># éšæœºç”Ÿæˆæˆ–æ‰‹åŠ¨æŒ‡å®šåˆ‡ç‰‡å¤§å°</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#æ ¹æ® random_size å‚æ•°å†³å®šæ˜¯éšæœºç”Ÿæˆåˆ‡ç‰‡å¤§å°è¿˜æ˜¯ä½¿ç”¨å›ºå®šå¤§å°ã€‚éšæœºå¤§å°åœ¨å›ºå®šå¤§å°çš„ä¸€åŠåˆ°å›ºå®šå¤§å°ä¹‹é—´ã€‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> random_size:
</span></span><span style="display:flex;"><span>            slice_width <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>randint(fixed_size[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">//</span> <span style="color:#ae81ff">2</span>, fixed_size[<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>            slice_height <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>randint(fixed_size[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">//</span> <span style="color:#ae81ff">2</span>, fixed_size[<span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            slice_width, slice_height <span style="color:#f92672">=</span> fixed_size
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># è®¡ç®—é‡å åŒºåŸŸå¤§å°,ç”± overlap_ratio å‚æ•°å†³å®šçš„ã€‚</span>
</span></span><span style="display:flex;"><span>        overlap_width <span style="color:#f92672">=</span> int(slice_width <span style="color:#f92672">*</span> overlap_ratio)
</span></span><span style="display:flex;"><span>        overlap_height <span style="color:#f92672">=</span> int(slice_height <span style="color:#f92672">*</span> overlap_ratio)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># è®¡ç®—åˆ‡ç‰‡æ•°é‡</span>
</span></span><span style="display:flex;"><span>        num_slices_horizontal <span style="color:#f92672">=</span> (width <span style="color:#f92672">-</span> overlap_width) <span style="color:#f92672">//</span> (slice_width <span style="color:#f92672">-</span> overlap_width)
</span></span><span style="display:flex;"><span>        num_slices_vertical <span style="color:#f92672">=</span> (height <span style="color:#f92672">-</span> overlap_height) <span style="color:#f92672">//</span> (slice_height <span style="color:#f92672">-</span> overlap_height)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ç”¨äºä¿å­˜åˆ‡ç‰‡åçš„å°å›¾ç‰‡</span>
</span></span><span style="display:flex;"><span>        output_subfolder <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(output_folder, os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>splitext(image_file)[<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>        os<span style="color:#f92672">.</span>makedirs(output_subfolder, exist_ok<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># åˆ‡ç‰‡å¹¶ä¿å­˜</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(num_slices_horizontal):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(num_slices_vertical):
</span></span><span style="display:flex;"><span>                left <span style="color:#f92672">=</span> i <span style="color:#f92672">*</span> (slice_width <span style="color:#f92672">-</span> overlap_width)
</span></span><span style="display:flex;"><span>                upper <span style="color:#f92672">=</span> j <span style="color:#f92672">*</span> (slice_height <span style="color:#f92672">-</span> overlap_height)
</span></span><span style="display:flex;"><span>                right <span style="color:#f92672">=</span> left <span style="color:#f92672">+</span> slice_width
</span></span><span style="display:flex;"><span>                lower <span style="color:#f92672">=</span> upper <span style="color:#f92672">+</span> slice_height
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># åˆ‡ç‰‡</span>
</span></span><span style="display:flex;"><span>                slice_image <span style="color:#f92672">=</span> original_image<span style="color:#f92672">.</span>crop((left, upper, right, lower))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># ç”Ÿæˆå”¯ä¸€çš„åˆ‡ç‰‡æ–‡ä»¶å</span>
</span></span><span style="display:flex;"><span>                slice_filename <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>splitext(image_file)[<span style="color:#ae81ff">0</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">_slice_</span><span style="color:#e6db74">{</span>j<span style="color:#e6db74">}</span><span style="color:#e6db74">_</span><span style="color:#e6db74">{</span>i<span style="color:#e6db74">}</span><span style="color:#e6db74">.jpg&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># ä¿å­˜åˆ‡ç‰‡</span>
</span></span><span style="display:flex;"><span>                slice_image<span style="color:#f92672">.</span>save(os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(output_subfolder, slice_filename))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è°ƒç”¨å‡½æ•°ï¼Œä¼ å…¥è¾“å…¥å›¾åƒæ–‡ä»¶å¤¹è·¯å¾„å’Œè¾“å‡ºæ–‡ä»¶å¤¹è·¯å¾„,æ›´æ¢ä¸ºè‡ªå·±çš„æ–‡ä»¶å¤¹</span>
</span></span><span style="display:flex;"><span>slice_and_save_images(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;C:\Users\Raj\Desktop\bbox&#34;</span>, <span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;C:\Users\Raj\Desktop\bboxå…¨éƒ¨åˆ‡ç‰‡&#34;</span>,
</span></span><span style="display:flex;"><span>                      random_size<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>, fixed_size<span style="color:#f92672">=</span>(<span style="color:#ae81ff">640</span>, <span style="color:#ae81ff">640</span>))
</span></span></code></pre></div><p>åˆ‡ç‰‡å®Œæˆä¹‹åï¼Œéœ€è¦æŒ‘å‡ºåŒ…å«åˆ‡ç‰‡ä¸­åŒ…å«ç›®æ ‡å¯¹è±¡çš„å›¾ç‰‡ï¼Œä¹‹åä½œä¸ºè®­ç»ƒé›†ã€‚</p>
<p><img src="https://bu.dusays.com/2024/04/23/6627b038d4b62.jpeg" alt="6627b038d4b62.jpeg"></p>
<h2 id="éªŒè¯é›†">éªŒè¯é›†</h2>
<hr>
<p>æœ€å¼€å§‹éªŒè¯é›†æ˜¯ç”¨çš„æ•°æ®é›†çš„ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯åé¢é‡‡ç”¨æ–°çš„éªŒè¯é›†ï¼Œéš¾åº¦ç¬é—´å°±ä¸Šæ¥äº†ï¼Œæµ‹è¯•ç²¾åº¦ä»0.996ç¬é—´è·Œåˆ°éƒ½åˆ°ä¸äº†0.7ã€‚ä¸€æ–¹é¢éœ€è¦æ‰©å……æ•°æ®é›†ï¼Œå¦ä¸€æ–¹é¢éœ€è¦é€‰æ‹©åˆé€‚çš„æ¨¡å‹å¯¹ç½‘ç»œå‚æ•°è¿›è¡Œè°ƒæ•´ã€‚</p>
<p><img src="https://bu.dusays.com/2024/04/23/6627b05fe4519.jpeg" alt="6627b05fe4519.jpeg"></p>
<h2 id="æ‰©å……è®­ç»ƒé›†">æ‰©å……è®­ç»ƒé›†</h2>
<hr>
<p>æ„Ÿè°¢CSDNåšä¸»ï¼š<a href="https://blog.csdn.net/qq_44421796"><strong>æˆ‘è¦å˜èƒ–å“‡</strong></a><strong>ã€</strong><a href="https://blog.csdn.net/weixin_43334693"><strong>è·¯äººè´¾&rsquo;Ï‰&rsquo;</strong></a></p>
<p>å‚è€ƒæ–‡ç« ï¼š<a href="https://blog.csdn.net/weixin_43334693/article/details/131744918"><strong>YOLOæ•°æ®é›†å®ç°æ•°æ®å¢å¼ºçš„æ–¹æ³•ï¼ˆè£å‰ªã€å¹³ç§» ã€æ—‹è½¬ã€æ”¹å˜äº®åº¦ã€åŠ å™ªå£°ç­‰ï¼‰</strong></a></p>
<h3 id="æ•°æ®å¢å¼ºçš„æ¦‚å¿µå’Œä½œç”¨">æ•°æ®å¢å¼ºçš„æ¦‚å¿µå’Œä½œç”¨</h3>
<hr>
<p><strong>æ•°æ®å¢å¼º</strong>æ˜¯ä¸€ç§é‡è¦çš„æœºå™¨å­¦ä¹ æ–¹æ³•ä¹‹ä¸€ï¼Œæ˜¯<strong>åŸºäºå·²æœ‰çš„è®­ç»ƒæ ·æœ¬æ•°æ®æ¥ç”Ÿæˆæ›´å¤šçš„è®­ç»ƒæ•°æ®</strong>ï¼Œå…¶ç›®çš„å°±æ˜¯<strong>ä¸ºäº†ä½¿æ‰©å¢çš„è®­ç»ƒæ•°æ®å°½å¯èƒ½æ¥è¿‘çœŸå®åˆ†å¸ƒçš„æ•°æ®ï¼Œä»è€Œæé«˜æ£€æµ‹ç²¾åº¦</strong>ã€‚æ­¤å¤–ï¼Œæ•°æ®å¢å¼ºèƒ½å¤Ÿè¿«ä½¿æ¨¡å‹<strong>å­¦ä¹ åˆ°æ›´å¤šé²æ£’æ€§çš„ç‰¹å¾ï¼Œä»è€Œæœ‰æ•ˆæé«˜æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›</strong>ã€‚</p>
<h3 id="å¸¸è§çš„æ•°æ®å¢å¼ºçš„åŠæ³•">å¸¸è§çš„æ•°æ®å¢å¼ºçš„åŠæ³•</h3>
<hr>
<p>ï¼ˆ1ï¼‰æ¯”è¾ƒå¸¸ç”¨çš„<strong>å‡ ä½•å˜æ¢</strong>æ–¹æ³•ä¸»è¦æœ‰ï¼š
ç¿»è½¬ã€æ—‹è½¬ã€è£å‰ªã€ç¼©æ”¾ã€å¹³ç§»ã€æŠ–åŠ¨
ï¼ˆ2ï¼‰æ¯”è¾ƒå¸¸ç”¨çš„<strong>åƒç´ å˜æ¢</strong>æ–¹æ³•ä¸»è¦æœ‰ï¼š
åŠ æ¤’ç›å™ªå£°ã€é«˜æ–¯å™ªå£°ã€è¿›è¡Œé«˜æ–¯æ¨¡ç³Šã€è°ƒæ•´HSVå¯¹æ¯”åº¦ã€è°ƒèŠ‚äº®åº¦ã€é¥±å’Œåº¦ã€ç›´æ–¹å›¾å‡è¡¡åŒ–ã€è°ƒæ•´ç™½å¹³è¡¡ç­‰</p>
<p>å…·ä½“è§£é‡Šå¦‚ä¸‹ï¼š</p>
<ul>
<li>éšæœºè£å‰ªï¼šä»åŸå§‹å›¾åƒä¸­éšæœºè£å‰ªå‡ºä¸€éƒ¨åˆ†ï¼Œä¾‹å¦‚è£å‰ªå››è§’ã€ä¸­å¿ƒæˆ–è€…ä¸Šä¸‹éƒ¨åˆ†ç­‰ã€‚è¿™ç§æ–¹æ³•èƒ½å¤Ÿå¢åŠ æ¨¡å‹çš„é²æ£’æ€§ï¼Œä½¿å…¶å¯¹å›¾åƒçš„ä¸åŒéƒ¨åˆ†éƒ½èƒ½è¿›è¡Œæœ‰æ•ˆçš„ç‰¹å¾æå–ã€‚</li>
<li>ç¿»è½¬æˆ–é•œåƒï¼šå¯ä»¥æ°´å¹³ç¿»è½¬æˆ–å‚ç›´ç¿»è½¬å›¾åƒã€‚è¿™ç§æ–¹æ³•èƒ½å¤Ÿæ¨¡æ‹Ÿå›¾åƒåœ¨ä¸åŒè§†è§’ä¸‹çš„æƒ…å†µï¼Œå¸®åŠ©æ¨¡å‹å­¦ä¹ åˆ°æ›´å¤šçš„ç‰¹å¾ã€‚</li>
<li>æ—‹è½¬ï¼šå°†åŸå›¾åƒæ—‹è½¬ä¸åŒçš„è§’åº¦æ¥ç”Ÿæˆæ–°çš„æ ·æœ¬ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ—‹è½¬åå›¾åƒçš„ç»´åº¦å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œå› æ­¤åœ¨å¤„ç†æ—¶éœ€è¦ç¡®ä¿å›¾åƒå°ºå¯¸çš„åˆç†æ€§ã€‚</li>
<li>äº®åº¦æˆ–å¯¹æ¯”åº¦è°ƒèŠ‚ï¼šé€šè¿‡æ”¹å˜å›¾åƒçš„äº®åº¦å’Œå¯¹æ¯”åº¦ï¼Œå¯ä»¥æ¨¡æ‹Ÿä¸åŒå…‰ç…§æ¡ä»¶ä¸‹çš„å›¾åƒæƒ…å†µï¼Œæé«˜æ¨¡å‹çš„é€‚åº”æ€§ã€‚</li>
<li>è‰²åº¦è°ƒèŠ‚ï¼šæ”¹å˜å›¾åƒä¸­Rã€Gã€Bé¢œè‰²åˆ†é‡çš„æ¯”ä¾‹ï¼Œä»è€Œç”Ÿæˆå…·æœ‰ä¸åŒé¢œè‰²ç‰¹å¾çš„æ ·æœ¬ã€‚
é¥±å’Œåº¦è°ƒèŠ‚ï¼šè°ƒèŠ‚å›¾åƒçš„é¥±å’Œåº¦ï¼Œå³æ”¹å˜è‰²å½©çš„çº¯åº¦ã€‚è¿™å¯ä»¥æ¨¡æ‹Ÿä¸åŒé¢œè‰²é²œè‰³ç¨‹åº¦çš„å›¾åƒï¼Œå¢åŠ æ ·æœ¬çš„å¤šæ ·æ€§ã€‚</li>
<li>é«˜æ–¯æ¨¡ç³Šã€é”åŒ–ã€æ·»åŠ å™ªå£°ï¼šå¯¹å›¾åƒè¿›è¡Œè¿™äº›å¤„ç†å¯ä»¥æ¨¡æ‹Ÿå›¾åƒåœ¨é‡‡é›†å’Œä¼ è¾“è¿‡ç¨‹ä¸­å¯èƒ½å‡ºç°çš„å¤±çœŸæƒ…å†µï¼Œæœ‰åŠ©äºæé«˜æ¨¡å‹çš„é²æ£’æ€§ã€‚
ç°åº¦åŒ–ï¼šå°†å½©è‰²å›¾åƒè½¬æ¢ä¸ºç°åº¦å›¾åƒï¼Œå¯ä»¥è¿›ä¸€æ­¥å¢åŠ æ ·æœ¬çš„å¤šæ ·æ€§</li>
</ul>
<h3 id="txtè½¬xml">txtè½¬xml</h3>
<hr>
<p>åœ¨æ•°æ®å¢å¼ºçš„æ—¶å€™ï¼Œä»£ç æ˜¯å¯¹xmlè¿›è¡Œæ“ä½œçš„ï¼Œæ‰€ä»¥éœ€è¦å…ˆç»å†ä¸€æ­¥ï¼Œä»txtåˆ°xmlçš„è¿‡ç¨‹ã€‚</p>
<p><strong>æ ¸å¿ƒåŸç†è§£é‡Š</strong>ï¼šå°† YOLO æ ¼å¼ä¸­çš„å½’ä¸€åŒ–åæ ‡è½¬æ¢ä¸ºåƒç´ åæ ‡ã€‚</p>
<ol>
<li>ä» YOLO æ ¼å¼çš„æ–‡æœ¬æ–‡ä»¶ä¸­è¯»å–æ¯ä¸ªç›®æ ‡çš„ç±»åˆ«ç´¢å¼•å’Œå½’ä¸€åŒ–çš„è¾¹ç•Œæ¡†åæ ‡Â <code>(class_index, x_center_norm, y_center_norm, width_norm, height_norm)</code>ã€‚</li>
<li>å°†å½’ä¸€åŒ–çš„ä¸­å¿ƒç‚¹åæ ‡Â <code>(x_center_norm, y_center_norm)</code>Â å’Œå®½åº¦ã€é«˜åº¦Â <code>(width_norm, height_norm)</code>Â è½¬æ¢ä¸ºåƒç´ åæ ‡ã€‚</li>
<li>ä½¿ç”¨åƒç´ åæ ‡æ¥è®¡ç®— PASCAL VOC æ ¼å¼çš„è¾¹ç•Œæ¡†Â <code>(xmin, ymin, xmax, ymax)</code></li>
</ol>
<p><strong>æ ¸å¿ƒè½¬æ¢é€»è¾‘ï¼š</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># è®¡ç®— PASCAL VOC çš„ (xmin, ymin, xmax, ymax)</span>
</span></span><span style="display:flex;"><span>xmin <span style="color:#f92672">=</span> int(round(x_center <span style="color:#f92672">-</span> (width <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>)))
</span></span><span style="display:flex;"><span>ymin <span style="color:#f92672">=</span> int(round(y_center <span style="color:#f92672">-</span> (height <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>)))
</span></span><span style="display:flex;"><span>xmax <span style="color:#f92672">=</span> int(round(x_center <span style="color:#f92672">+</span> (width <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>)))
</span></span><span style="display:flex;"><span>ymax <span style="color:#f92672">=</span> int(round(y_center <span style="color:#f92672">+</span> (height <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>)))
</span></span></code></pre></div><p><strong>è½¬æ¢ä»£ç ï¼š</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># -*- coding: utf-8 -*-</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> cv2
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> lxml.etree <span style="color:#f92672">import</span> Element, SubElement, tostring
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">txt_xml</span>(img_path, img_name, txt_path, img_txt, xml_path, img_xml):
</span></span><span style="display:flex;"><span>    clas <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># è¯»å–txtçš„ä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>    txt_img <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(txt_path, img_txt)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># å›¾åƒçš„å®½åº¦å’Œé«˜åº¦</span>
</span></span><span style="display:flex;"><span>    imw <span style="color:#f92672">=</span> <span style="color:#ae81ff">640</span>  <span style="color:#75715e"># åº”å½“æ ¹æ®å®é™…å›¾ç‰‡å¤§å°è¿›è¡Œè°ƒæ•´</span>
</span></span><span style="display:flex;"><span>    imh <span style="color:#f92672">=</span> <span style="color:#ae81ff">640</span>  <span style="color:#75715e"># åº”å½“æ ¹æ®å®é™…å›¾ç‰‡å¤§å°è¿›è¡Œè°ƒæ•´</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> open(txt_img, <span style="color:#e6db74">&#34;r&#34;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> line <span style="color:#f92672">in</span> f<span style="color:#f92672">.</span>readlines():
</span></span><span style="display:flex;"><span>            line <span style="color:#f92672">=</span> line<span style="color:#f92672">.</span>strip(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>            list <span style="color:#f92672">=</span> line<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#34; &#34;</span>)
</span></span><span style="display:flex;"><span>            print(list)
</span></span><span style="display:flex;"><span>            clas<span style="color:#f92672">.</span>append(list)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># åˆ›å»ºXMLæ–‡æ¡£çš„æ ¹èŠ‚ç‚¹å’Œç›¸å…³å­èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># åˆ›å»ºXMLæ–‡æ¡£çš„æ ¹èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>        node_root <span style="color:#f92672">=</span> Element(<span style="color:#e6db74">&#39;annotation&#39;</span>)
</span></span><span style="display:flex;"><span>        node_folder <span style="color:#f92672">=</span> SubElement(node_root, <span style="color:#e6db74">&#39;folder&#39;</span>)
</span></span><span style="display:flex;"><span>        node_folder<span style="color:#f92672">.</span>text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;1&#39;</span>
</span></span><span style="display:flex;"><span>        node_filename <span style="color:#f92672">=</span> SubElement(node_root, <span style="color:#e6db74">&#39;filename&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># å›¾åƒåç§°</span>
</span></span><span style="display:flex;"><span>        node_filename<span style="color:#f92672">.</span>text <span style="color:#f92672">=</span> img_name
</span></span><span style="display:flex;"><span>        node_size <span style="color:#f92672">=</span> SubElement(node_root, <span style="color:#e6db74">&#39;size&#39;</span>)
</span></span><span style="display:flex;"><span>        node_width <span style="color:#f92672">=</span> SubElement(node_size, <span style="color:#e6db74">&#39;width&#39;</span>)
</span></span><span style="display:flex;"><span>        node_width<span style="color:#f92672">.</span>text <span style="color:#f92672">=</span> str(imw)
</span></span><span style="display:flex;"><span>        node_height <span style="color:#f92672">=</span> SubElement(node_size, <span style="color:#e6db74">&#39;height&#39;</span>)
</span></span><span style="display:flex;"><span>        node_height<span style="color:#f92672">.</span>text <span style="color:#f92672">=</span> str(imh)
</span></span><span style="display:flex;"><span>        node_depth <span style="color:#f92672">=</span> SubElement(node_size, <span style="color:#e6db74">&#39;depth&#39;</span>)
</span></span><span style="display:flex;"><span>        node_depth<span style="color:#f92672">.</span>text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;3&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># éå†æ‰€æœ‰çš„æ ‡æ³¨ä¿¡æ¯å¹¶æ·»åŠ åˆ°XMLä¸­</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># éå†æ‰€æœ‰çš„æ ‡æ³¨ä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(clas)):
</span></span><span style="display:flex;"><span>            x_center_norm <span style="color:#f92672">=</span> float(clas[i][<span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span>            y_center_norm <span style="color:#f92672">=</span> float(clas[i][<span style="color:#ae81ff">2</span>])
</span></span><span style="display:flex;"><span>            width_norm <span style="color:#f92672">=</span> float(clas[i][<span style="color:#ae81ff">3</span>])
</span></span><span style="display:flex;"><span>            height_norm <span style="color:#f92672">=</span> float(clas[i][<span style="color:#ae81ff">4</span>])
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># è½¬æ¢å½’ä¸€åŒ–åæ ‡åˆ°åƒç´ åæ ‡</span>
</span></span><span style="display:flex;"><span>            x_center <span style="color:#f92672">=</span> x_center_norm <span style="color:#f92672">*</span> imw
</span></span><span style="display:flex;"><span>            y_center <span style="color:#f92672">=</span> y_center_norm <span style="color:#f92672">*</span> imh
</span></span><span style="display:flex;"><span>            width <span style="color:#f92672">=</span> width_norm <span style="color:#f92672">*</span> imw
</span></span><span style="display:flex;"><span>            height <span style="color:#f92672">=</span> height_norm <span style="color:#f92672">*</span> imh
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># è®¡ç®—å¹¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²</span>
</span></span><span style="display:flex;"><span>            xmin <span style="color:#f92672">=</span> str(int(round(x_center <span style="color:#f92672">-</span> (width <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>))))
</span></span><span style="display:flex;"><span>            ymin <span style="color:#f92672">=</span> str(int(round(y_center <span style="color:#f92672">-</span> (height <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>))))
</span></span><span style="display:flex;"><span>            xmax <span style="color:#f92672">=</span> str(int(round(x_center <span style="color:#f92672">+</span> (width <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>))))
</span></span><span style="display:flex;"><span>            ymax <span style="color:#f92672">=</span> str(int(round(y_center <span style="color:#f92672">+</span> (height <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># åˆ›å»ºXMLèŠ‚ç‚¹å¹¶èµ‹å€¼</span>
</span></span><span style="display:flex;"><span>            node_object <span style="color:#f92672">=</span> SubElement(node_root, <span style="color:#e6db74">&#39;object&#39;</span>)
</span></span><span style="display:flex;"><span>            node_name <span style="color:#f92672">=</span> SubElement(node_object, <span style="color:#e6db74">&#39;name&#39;</span>)
</span></span><span style="display:flex;"><span>            node_name<span style="color:#f92672">.</span>text <span style="color:#f92672">=</span> str(clas[i][<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>            node_pose <span style="color:#f92672">=</span> SubElement(node_object, <span style="color:#e6db74">&#39;pose&#39;</span>)
</span></span><span style="display:flex;"><span>            node_pose<span style="color:#f92672">.</span>text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Unspecified&#34;</span>
</span></span><span style="display:flex;"><span>            node_truncated <span style="color:#f92672">=</span> SubElement(node_object, <span style="color:#e6db74">&#39;truncated&#39;</span>)
</span></span><span style="display:flex;"><span>            node_truncated<span style="color:#f92672">.</span>text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;0&#34;</span>
</span></span><span style="display:flex;"><span>            node_difficult <span style="color:#f92672">=</span> SubElement(node_object, <span style="color:#e6db74">&#39;difficult&#39;</span>)
</span></span><span style="display:flex;"><span>            node_difficult<span style="color:#f92672">.</span>text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;0&#39;</span>
</span></span><span style="display:flex;"><span>            node_bndbox <span style="color:#f92672">=</span> SubElement(node_object, <span style="color:#e6db74">&#39;bndbox&#39;</span>)
</span></span><span style="display:flex;"><span>            node_xmin <span style="color:#f92672">=</span> SubElement(node_bndbox, <span style="color:#e6db74">&#39;xmin&#39;</span>)
</span></span><span style="display:flex;"><span>            node_xmin<span style="color:#f92672">.</span>text <span style="color:#f92672">=</span> xmin
</span></span><span style="display:flex;"><span>            node_ymin <span style="color:#f92672">=</span> SubElement(node_bndbox, <span style="color:#e6db74">&#39;ymin&#39;</span>)
</span></span><span style="display:flex;"><span>            node_ymin<span style="color:#f92672">.</span>text <span style="color:#f92672">=</span> ymin
</span></span><span style="display:flex;"><span>            node_xmax <span style="color:#f92672">=</span> SubElement(node_bndbox, <span style="color:#e6db74">&#39;xmax&#39;</span>)
</span></span><span style="display:flex;"><span>            node_xmax<span style="color:#f92672">.</span>text <span style="color:#f92672">=</span> xmax
</span></span><span style="display:flex;"><span>            node_ymax <span style="color:#f92672">=</span> SubElement(node_bndbox, <span style="color:#e6db74">&#39;ymax&#39;</span>)
</span></span><span style="display:flex;"><span>            node_ymax<span style="color:#f92672">.</span>text <span style="color:#f92672">=</span> ymax
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># å°†XMLå†…å®¹å†™å…¥æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>    xml <span style="color:#f92672">=</span> tostring(node_root, pretty_print<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>    img_newxml <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(xml_path, img_xml)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> open(img_newxml, <span style="color:#e6db74">&#39;wb&#39;</span>) <span style="color:#66d9ef">as</span> file_object:
</span></span><span style="display:flex;"><span>        file_object<span style="color:#f92672">.</span>write(xml)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># å›¾åƒã€æ ‡æ³¨å’ŒXMLæ–‡ä»¶å¤¹æ‰€åœ¨ä½ç½®ã€æ›´æ¢è‡ªå·±çš„ç»å¯¹è·¯å¾„</span>
</span></span><span style="display:flex;"><span>    img_path <span style="color:#f92672">=</span> <span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;D:\@Graduation\enhance\data\images\train&#34;</span>
</span></span><span style="display:flex;"><span>    txt_path <span style="color:#f92672">=</span> <span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;D:\@Graduation\enhance\data\labels\train&#34;</span>
</span></span><span style="display:flex;"><span>    xml_path <span style="color:#f92672">=</span> <span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;D:\@Graduation\enhance\data\labels\xml&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> img_name <span style="color:#f92672">in</span> os<span style="color:#f92672">.</span>listdir(img_path):
</span></span><span style="display:flex;"><span>        img_base_name <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>splitext(img_name)[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>        img_xml <span style="color:#f92672">=</span> img_base_name <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;.xml&#34;</span>
</span></span><span style="display:flex;"><span>        img_txt <span style="color:#f92672">=</span> img_base_name <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;.txt&#34;</span>
</span></span><span style="display:flex;"><span>        txt_xml(img_path, img_name, txt_path, img_txt, xml_path, img_xml)
</span></span></code></pre></div><p>ä¾‹å¦‚ï¼Œè¿™å°±æ˜¯æ ‡æ³¨åçš„å½’ä¸€åŒ–åæ ‡</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>0 0.719594 0.901037 0.108083 0.091896 
</span></span></code></pre></div><p>è¿™å°±æ˜¯è½¬æ¢åçš„xmlåæ ‡å’Œå…¶ä»–çš„ä¸€äº›å…ƒç´ ï¼Œè½¬æ¢å®Œå¯ä»¥ç”¨labelimgéªŒè¯ä¸€ä¸‹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">annotation</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">folder</span>&gt;1&lt;/<span style="color:#f92672">folder</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">filename</span>&gt;000000_slice_2_2.jpg&lt;/<span style="color:#f92672">filename</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">size</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">width</span>&gt;640&lt;/<span style="color:#f92672">width</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">height</span>&gt;640&lt;/<span style="color:#f92672">height</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">depth</span>&gt;3&lt;/<span style="color:#f92672">depth</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">size</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">object</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">name</span>&gt;0&lt;/<span style="color:#f92672">name</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">pose</span>&gt;Unspecified&lt;/<span style="color:#f92672">pose</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">truncated</span>&gt;0&lt;/<span style="color:#f92672">truncated</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">difficult</span>&gt;0&lt;/<span style="color:#f92672">difficult</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">bndbox</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">xmin</span>&gt;426&lt;/<span style="color:#f92672">xmin</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">ymin</span>&gt;547&lt;/<span style="color:#f92672">ymin</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">xmax</span>&gt;495&lt;/<span style="color:#f92672">xmax</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">ymax</span>&gt;606&lt;/<span style="color:#f92672">ymax</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">bndbox</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">object</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">annotation</span>&gt;
</span></span></code></pre></div><h3 id="æ•°æ®é›†æ‰©å……">æ•°æ®é›†æ‰©å……</h3>
<hr>
<p>æ ¹æ®ä¸Šè¿°åˆ†æçš„æ–¹å¼è¿›è¡Œæ•°æ®é›†æ‰©å……</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># -*- coding=utf-8 -*-</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> random
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> copy
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> cv2
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> math
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> skimage.util <span style="color:#f92672">import</span> random_noise
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> lxml <span style="color:#f92672">import</span> etree, objectify
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> xml.etree.ElementTree <span style="color:#66d9ef">as</span> ET
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> argparse
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ˜¾ç¤ºå›¾ç‰‡</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">show_pic</span>(img, bboxes<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    è¾“å…¥:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        img:å›¾åƒarray
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        bboxes:å›¾åƒçš„æ‰€æœ‰boudning box list, æ ¼å¼ä¸º[[x_min, y_min, x_max, y_max]....]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        names:æ¯ä¸ªboxå¯¹åº”çš„åç§°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(bboxes)):
</span></span><span style="display:flex;"><span>        bbox <span style="color:#f92672">=</span> bboxes[i]
</span></span><span style="display:flex;"><span>        x_min <span style="color:#f92672">=</span> bbox[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>        y_min <span style="color:#f92672">=</span> bbox[<span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>        x_max <span style="color:#f92672">=</span> bbox[<span style="color:#ae81ff">2</span>]
</span></span><span style="display:flex;"><span>        y_max <span style="color:#f92672">=</span> bbox[<span style="color:#ae81ff">3</span>]
</span></span><span style="display:flex;"><span>        cv2<span style="color:#f92672">.</span>rectangle(img, (int(x_min), int(y_min)), (int(x_max), int(y_max)), (<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">255</span>, <span style="color:#ae81ff">0</span>), <span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>    cv2<span style="color:#f92672">.</span>namedWindow(<span style="color:#e6db74">&#39;pic&#39;</span>, <span style="color:#ae81ff">0</span>)  <span style="color:#75715e"># 1è¡¨ç¤ºåŸå›¾</span>
</span></span><span style="display:flex;"><span>    cv2<span style="color:#f92672">.</span>moveWindow(<span style="color:#e6db74">&#39;pic&#39;</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>    cv2<span style="color:#f92672">.</span>resizeWindow(<span style="color:#e6db74">&#39;pic&#39;</span>, <span style="color:#ae81ff">1200</span>, <span style="color:#ae81ff">800</span>)  <span style="color:#75715e"># å¯è§†åŒ–çš„å›¾ç‰‡å¤§å°</span>
</span></span><span style="display:flex;"><span>    cv2<span style="color:#f92672">.</span>imshow(<span style="color:#e6db74">&#39;pic&#39;</span>, img)
</span></span><span style="display:flex;"><span>    cv2<span style="color:#f92672">.</span>waitKey(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>    cv2<span style="color:#f92672">.</span>destroyAllWindows()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å›¾åƒå‡ä¸ºcv2è¯»å–</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DataAugmentForObjectDetection</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self, rotation_rate<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>, max_rotation_angle<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>,
</span></span><span style="display:flex;"><span>                 crop_rate<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>, shift_rate<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>, change_light_rate<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>,
</span></span><span style="display:flex;"><span>                 add_noise_rate<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>, flip_rate<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>,
</span></span><span style="display:flex;"><span>                 cutout_rate<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>, cut_out_length<span style="color:#f92672">=</span><span style="color:#ae81ff">50</span>, cut_out_holes<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, cut_out_threshold<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>,
</span></span><span style="display:flex;"><span>                 is_addNoise<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, is_changeLight<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, is_cutout<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, is_rotate_img_bbox<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>                 is_crop_img_bboxes<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, is_shift_pic_bboxes<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, is_filp_pic_bboxes<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># é…ç½®å„ä¸ªæ“ä½œçš„å±æ€§</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>rotation_rate <span style="color:#f92672">=</span> rotation_rate
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>max_rotation_angle <span style="color:#f92672">=</span> max_rotation_angle
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>crop_rate <span style="color:#f92672">=</span> crop_rate
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>shift_rate <span style="color:#f92672">=</span> shift_rate
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>change_light_rate <span style="color:#f92672">=</span> change_light_rate
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>add_noise_rate <span style="color:#f92672">=</span> add_noise_rate
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>flip_rate <span style="color:#f92672">=</span> flip_rate
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>cutout_rate <span style="color:#f92672">=</span> cutout_rate
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>cut_out_length <span style="color:#f92672">=</span> cut_out_length
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>cut_out_holes <span style="color:#f92672">=</span> cut_out_holes
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>cut_out_threshold <span style="color:#f92672">=</span> cut_out_threshold
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># æ˜¯å¦ä½¿ç”¨æŸç§å¢å¼ºæ–¹å¼</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>is_addNoise <span style="color:#f92672">=</span> is_addNoise
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>is_changeLight <span style="color:#f92672">=</span> is_changeLight
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>is_cutout <span style="color:#f92672">=</span> is_cutout
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>is_rotate_img_bbox <span style="color:#f92672">=</span> is_rotate_img_bbox
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>is_crop_img_bboxes <span style="color:#f92672">=</span> is_crop_img_bboxes
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>is_shift_pic_bboxes <span style="color:#f92672">=</span> is_shift_pic_bboxes
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>is_filp_pic_bboxes <span style="color:#f92672">=</span> is_filp_pic_bboxes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ----1.åŠ å™ªå£°---- #</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_addNoise</span>(self, img):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        è¾“å…¥:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            img:å›¾åƒarray
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        è¾“å‡º:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            åŠ å™ªå£°åçš„å›¾åƒarray,ç”±äºè¾“å‡ºçš„åƒç´ æ˜¯åœ¨[0,1]ä¹‹é—´,æ‰€ä»¥å¾—ä¹˜ä»¥255
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># return cv2.GaussianBlur(img, (11, 11), 0)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> random_noise(img, mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;gaussian&#39;</span>, seed<span style="color:#f92672">=</span>int(time<span style="color:#f92672">.</span>time()), clip<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>) <span style="color:#f92672">*</span> <span style="color:#ae81ff">255</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ---2.è°ƒæ•´äº®åº¦--- #</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_changeLight</span>(self, img):
</span></span><span style="display:flex;"><span>        alpha <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>uniform(<span style="color:#ae81ff">0.35</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        blank <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>zeros(img<span style="color:#f92672">.</span>shape, img<span style="color:#f92672">.</span>dtype)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> cv2<span style="color:#f92672">.</span>addWeighted(img, alpha, blank, <span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> alpha, <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ---3.cutout--- #</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_cutout</span>(self, img, bboxes, length<span style="color:#f92672">=</span><span style="color:#ae81ff">100</span>, n_holes<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, threshold<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        åŸç‰ˆæœ¬ï¼šhttps://github.com/uoguelph-mlrg/Cutout/blob/master/util/cutout.py
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Randomly mask out one or more patches from an image.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Args:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            img : a 3D numpy array,(h,w,c)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            bboxes : æ¡†çš„åæ ‡
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            n_holes (int): Number of patches to cut out of each image.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            length (int): The length (in pixels) of each square patch.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">cal_iou</span>(boxA, boxB):
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            boxA, boxBä¸ºä¸¤ä¸ªæ¡†ï¼Œè¿”å›iou
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            boxBä¸ºbouding box
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># determine the (x, y)-coordinates of the intersection rectangle</span>
</span></span><span style="display:flex;"><span>            xA <span style="color:#f92672">=</span> max(boxA[<span style="color:#ae81ff">0</span>], boxB[<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>            yA <span style="color:#f92672">=</span> max(boxA[<span style="color:#ae81ff">1</span>], boxB[<span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span>            xB <span style="color:#f92672">=</span> min(boxA[<span style="color:#ae81ff">2</span>], boxB[<span style="color:#ae81ff">2</span>])
</span></span><span style="display:flex;"><span>            yB <span style="color:#f92672">=</span> min(boxA[<span style="color:#ae81ff">3</span>], boxB[<span style="color:#ae81ff">3</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> xB <span style="color:#f92672">&lt;=</span> xA <span style="color:#f92672">or</span> yB <span style="color:#f92672">&lt;=</span> yA:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># compute the area of intersection rectangle</span>
</span></span><span style="display:flex;"><span>            interArea <span style="color:#f92672">=</span> (xB <span style="color:#f92672">-</span> xA <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> (yB <span style="color:#f92672">-</span> yA <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># compute the area of both the prediction and ground-truth</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># rectangles</span>
</span></span><span style="display:flex;"><span>            boxAArea <span style="color:#f92672">=</span> (boxA[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">-</span> boxA[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> (boxA[<span style="color:#ae81ff">3</span>] <span style="color:#f92672">-</span> boxA[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>            boxBArea <span style="color:#f92672">=</span> (boxB[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">-</span> boxB[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> (boxB[<span style="color:#ae81ff">3</span>] <span style="color:#f92672">-</span> boxB[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>            iou <span style="color:#f92672">=</span> interArea <span style="color:#f92672">/</span> float(boxBArea)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> iou
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># å¾—åˆ°hå’Œw</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> img<span style="color:#f92672">.</span>ndim <span style="color:#f92672">==</span> <span style="color:#ae81ff">3</span>:
</span></span><span style="display:flex;"><span>            h, w, c <span style="color:#f92672">=</span> img<span style="color:#f92672">.</span>shape
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            _, h, w, c <span style="color:#f92672">=</span> img<span style="color:#f92672">.</span>shape
</span></span><span style="display:flex;"><span>        mask <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>ones((h, w, c), np<span style="color:#f92672">.</span>float32)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> n <span style="color:#f92672">in</span> range(n_holes):
</span></span><span style="display:flex;"><span>            chongdie <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>  <span style="color:#75715e"># çœ‹åˆ‡å‰²çš„åŒºåŸŸæ˜¯å¦ä¸boxé‡å å¤ªå¤š</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">while</span> chongdie:
</span></span><span style="display:flex;"><span>                y <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>randint(h)
</span></span><span style="display:flex;"><span>                x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>randint(w)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                y1 <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>clip(y <span style="color:#f92672">-</span> length <span style="color:#f92672">//</span> <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                             h)  <span style="color:#75715e"># numpy.clip(a, a_min, a_max, out=None), clipè¿™ä¸ªå‡½æ•°å°†å°†æ•°ç»„ä¸­çš„å…ƒç´ é™åˆ¶åœ¨a_min, a_maxä¹‹é—´ï¼Œå¤§äºa_maxçš„å°±ä½¿å¾—å®ƒç­‰äº a_maxï¼Œå°äºa_min,çš„å°±ä½¿å¾—å®ƒç­‰äºa_min</span>
</span></span><span style="display:flex;"><span>                y2 <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>clip(y <span style="color:#f92672">+</span> length <span style="color:#f92672">//</span> <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">0</span>, h)
</span></span><span style="display:flex;"><span>                x1 <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>clip(x <span style="color:#f92672">-</span> length <span style="color:#f92672">//</span> <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">0</span>, w)
</span></span><span style="display:flex;"><span>                x2 <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>clip(x <span style="color:#f92672">+</span> length <span style="color:#f92672">//</span> <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">0</span>, w)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                chongdie <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">for</span> box <span style="color:#f92672">in</span> bboxes:
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> cal_iou([x1, y1, x2, y2], box) <span style="color:#f92672">&gt;</span> threshold:
</span></span><span style="display:flex;"><span>                        chongdie <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>            mask[y1: y2, x1: x2, :] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.</span>
</span></span><span style="display:flex;"><span>        img <span style="color:#f92672">=</span> img <span style="color:#f92672">*</span> mask
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> img
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ---4.æ—‹è½¬--- #</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_rotate_img_bbox</span>(self, img, bboxes, angle<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>, scale<span style="color:#f92672">=</span><span style="color:#ae81ff">1.</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        å‚è€ƒ:https://blog.csdn.net/u014540717/article/details/53301195crop_rate
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        è¾“å…¥:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            img:å›¾åƒarray,(h,w,c)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            bboxes:è¯¥å›¾åƒåŒ…å«çš„æ‰€æœ‰boundingboxs,ä¸€ä¸ªlist,æ¯ä¸ªå…ƒç´ ä¸º[x_min, y_min, x_max, y_max],è¦ç¡®ä¿æ˜¯æ•°å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            angle:æ—‹è½¬è§’åº¦
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            scale:é»˜è®¤1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        è¾“å‡º:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            rot_img:æ—‹è½¬åçš„å›¾åƒarray
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            rot_bboxes:æ—‹è½¬åçš„boundingboxåæ ‡list
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># æ—‹è½¬å›¾åƒ</span>
</span></span><span style="display:flex;"><span>        w <span style="color:#f92672">=</span> img<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>        h <span style="color:#f92672">=</span> img<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># è§’åº¦å˜å¼§åº¦</span>
</span></span><span style="display:flex;"><span>        rangle <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>deg2rad(angle)  <span style="color:#75715e"># angle in radians</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># now calculate new image width and height</span>
</span></span><span style="display:flex;"><span>        nw <span style="color:#f92672">=</span> (abs(np<span style="color:#f92672">.</span>sin(rangle) <span style="color:#f92672">*</span> h) <span style="color:#f92672">+</span> abs(np<span style="color:#f92672">.</span>cos(rangle) <span style="color:#f92672">*</span> w)) <span style="color:#f92672">*</span> scale
</span></span><span style="display:flex;"><span>        nh <span style="color:#f92672">=</span> (abs(np<span style="color:#f92672">.</span>cos(rangle) <span style="color:#f92672">*</span> h) <span style="color:#f92672">+</span> abs(np<span style="color:#f92672">.</span>sin(rangle) <span style="color:#f92672">*</span> w)) <span style="color:#f92672">*</span> scale
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># ask OpenCV for the rotation matrix</span>
</span></span><span style="display:flex;"><span>        rot_mat <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>getRotationMatrix2D((nw <span style="color:#f92672">*</span> <span style="color:#ae81ff">0.5</span>, nh <span style="color:#f92672">*</span> <span style="color:#ae81ff">0.5</span>), angle, scale)
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># calculate the move from the old center to the new center combined</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># with the rotation</span>
</span></span><span style="display:flex;"><span>        rot_move <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>dot(rot_mat, np<span style="color:#f92672">.</span>array([(nw <span style="color:#f92672">-</span> w) <span style="color:#f92672">*</span> <span style="color:#ae81ff">0.5</span>, (nh <span style="color:#f92672">-</span> h) <span style="color:#f92672">*</span> <span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">0</span>]))
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># the move only affects the translation, so update the translation</span>
</span></span><span style="display:flex;"><span>        rot_mat[<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>] <span style="color:#f92672">+=</span> rot_move[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>        rot_mat[<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>] <span style="color:#f92672">+=</span> rot_move[<span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># ä»¿å°„å˜æ¢</span>
</span></span><span style="display:flex;"><span>        rot_img <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>warpAffine(img, rot_mat, (int(math<span style="color:#f92672">.</span>ceil(nw)), int(math<span style="color:#f92672">.</span>ceil(nh))), flags<span style="color:#f92672">=</span>cv2<span style="color:#f92672">.</span>INTER_LANCZOS4)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># çŸ«æ­£bboxåæ ‡</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># rot_matæ˜¯æœ€ç»ˆçš„æ—‹è½¬çŸ©é˜µ</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># è·å–åŸå§‹bboxçš„å››ä¸ªä¸­ç‚¹ï¼Œç„¶åå°†è¿™å››ä¸ªç‚¹è½¬æ¢åˆ°æ—‹è½¬åçš„åæ ‡ç³»ä¸‹</span>
</span></span><span style="display:flex;"><span>        rot_bboxes <span style="color:#f92672">=</span> list()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> bbox <span style="color:#f92672">in</span> bboxes:
</span></span><span style="display:flex;"><span>            xmin <span style="color:#f92672">=</span> bbox[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>            ymin <span style="color:#f92672">=</span> bbox[<span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>            xmax <span style="color:#f92672">=</span> bbox[<span style="color:#ae81ff">2</span>]
</span></span><span style="display:flex;"><span>            ymax <span style="color:#f92672">=</span> bbox[<span style="color:#ae81ff">3</span>]
</span></span><span style="display:flex;"><span>            point1 <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>dot(rot_mat, np<span style="color:#f92672">.</span>array([(xmin <span style="color:#f92672">+</span> xmax) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>, ymin, <span style="color:#ae81ff">1</span>]))
</span></span><span style="display:flex;"><span>            point2 <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>dot(rot_mat, np<span style="color:#f92672">.</span>array([xmax, (ymin <span style="color:#f92672">+</span> ymax) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>]))
</span></span><span style="display:flex;"><span>            point3 <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>dot(rot_mat, np<span style="color:#f92672">.</span>array([(xmin <span style="color:#f92672">+</span> xmax) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>, ymax, <span style="color:#ae81ff">1</span>]))
</span></span><span style="display:flex;"><span>            point4 <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>dot(rot_mat, np<span style="color:#f92672">.</span>array([xmin, (ymin <span style="color:#f92672">+</span> ymax) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>]))
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># åˆå¹¶np.array</span>
</span></span><span style="display:flex;"><span>            concat <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>vstack((point1, point2, point3, point4))
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># æ”¹å˜arrayç±»å‹</span>
</span></span><span style="display:flex;"><span>            concat <span style="color:#f92672">=</span> concat<span style="color:#f92672">.</span>astype(np<span style="color:#f92672">.</span>int32)
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># å¾—åˆ°æ—‹è½¬åçš„åæ ‡</span>
</span></span><span style="display:flex;"><span>            rx, ry, rw, rh <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>boundingRect(concat)
</span></span><span style="display:flex;"><span>            rx_min <span style="color:#f92672">=</span> rx
</span></span><span style="display:flex;"><span>            ry_min <span style="color:#f92672">=</span> ry
</span></span><span style="display:flex;"><span>            rx_max <span style="color:#f92672">=</span> rx <span style="color:#f92672">+</span> rw
</span></span><span style="display:flex;"><span>            ry_max <span style="color:#f92672">=</span> ry <span style="color:#f92672">+</span> rh
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># åŠ å…¥listä¸­</span>
</span></span><span style="display:flex;"><span>            rot_bboxes<span style="color:#f92672">.</span>append([rx_min, ry_min, rx_max, ry_max])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> rot_img, rot_bboxes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ---5.è£å‰ª--- #</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_crop_img_bboxes</span>(self, img, bboxes):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        è£å‰ªåçš„å›¾ç‰‡è¦åŒ…å«æ‰€æœ‰çš„æ¡†
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        è¾“å…¥:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            img:å›¾åƒarray
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            bboxes:è¯¥å›¾åƒåŒ…å«çš„æ‰€æœ‰boundingboxs,ä¸€ä¸ªlist,æ¯ä¸ªå…ƒç´ ä¸º[x_min, y_min, x_max, y_max],è¦ç¡®ä¿æ˜¯æ•°å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        è¾“å‡º:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            crop_img:è£å‰ªåçš„å›¾åƒarray
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            crop_bboxes:è£å‰ªåçš„bounding boxçš„åæ ‡list
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># è£å‰ªå›¾åƒ</span>
</span></span><span style="display:flex;"><span>        w <span style="color:#f92672">=</span> img<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>        h <span style="color:#f92672">=</span> img<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>        x_min <span style="color:#f92672">=</span> w  <span style="color:#75715e"># è£å‰ªåçš„åŒ…å«æ‰€æœ‰ç›®æ ‡æ¡†çš„æœ€å°çš„æ¡†</span>
</span></span><span style="display:flex;"><span>        x_max <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        y_min <span style="color:#f92672">=</span> h
</span></span><span style="display:flex;"><span>        y_max <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> bbox <span style="color:#f92672">in</span> bboxes:
</span></span><span style="display:flex;"><span>            x_min <span style="color:#f92672">=</span> min(x_min, bbox[<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>            y_min <span style="color:#f92672">=</span> min(y_min, bbox[<span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span>            x_max <span style="color:#f92672">=</span> max(x_max, bbox[<span style="color:#ae81ff">2</span>])
</span></span><span style="display:flex;"><span>            y_max <span style="color:#f92672">=</span> max(y_max, bbox[<span style="color:#ae81ff">3</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        d_to_left <span style="color:#f92672">=</span> x_min  <span style="color:#75715e"># åŒ…å«æ‰€æœ‰ç›®æ ‡æ¡†çš„æœ€å°æ¡†åˆ°å·¦è¾¹çš„è·ç¦»</span>
</span></span><span style="display:flex;"><span>        d_to_right <span style="color:#f92672">=</span> w <span style="color:#f92672">-</span> x_max  <span style="color:#75715e"># åŒ…å«æ‰€æœ‰ç›®æ ‡æ¡†çš„æœ€å°æ¡†åˆ°å³è¾¹çš„è·ç¦»</span>
</span></span><span style="display:flex;"><span>        d_to_top <span style="color:#f92672">=</span> y_min  <span style="color:#75715e"># åŒ…å«æ‰€æœ‰ç›®æ ‡æ¡†çš„æœ€å°æ¡†åˆ°é¡¶ç«¯çš„è·ç¦»</span>
</span></span><span style="display:flex;"><span>        d_to_bottom <span style="color:#f92672">=</span> h <span style="color:#f92672">-</span> y_max  <span style="color:#75715e"># åŒ…å«æ‰€æœ‰ç›®æ ‡æ¡†çš„æœ€å°æ¡†åˆ°åº•éƒ¨çš„è·ç¦»</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># éšæœºæ‰©å±•è¿™ä¸ªæœ€å°æ¡†</span>
</span></span><span style="display:flex;"><span>        crop_x_min <span style="color:#f92672">=</span> int(x_min <span style="color:#f92672">-</span> random<span style="color:#f92672">.</span>uniform(<span style="color:#ae81ff">0</span>, d_to_left))
</span></span><span style="display:flex;"><span>        crop_y_min <span style="color:#f92672">=</span> int(y_min <span style="color:#f92672">-</span> random<span style="color:#f92672">.</span>uniform(<span style="color:#ae81ff">0</span>, d_to_top))
</span></span><span style="display:flex;"><span>        crop_x_max <span style="color:#f92672">=</span> int(x_max <span style="color:#f92672">+</span> random<span style="color:#f92672">.</span>uniform(<span style="color:#ae81ff">0</span>, d_to_right))
</span></span><span style="display:flex;"><span>        crop_y_max <span style="color:#f92672">=</span> int(y_max <span style="color:#f92672">+</span> random<span style="color:#f92672">.</span>uniform(<span style="color:#ae81ff">0</span>, d_to_bottom))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># éšæœºæ‰©å±•è¿™ä¸ªæœ€å°æ¡† , é˜²æ­¢åˆ«è£çš„å¤ªå°</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># crop_x_min = int(x_min - random.uniform(d_to_left//2, d_to_left))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># crop_y_min = int(y_min - random.uniform(d_to_top//2, d_to_top))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># crop_x_max = int(x_max + random.uniform(d_to_right//2, d_to_right))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># crop_y_max = int(y_max + random.uniform(d_to_bottom//2, d_to_bottom))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># ç¡®ä¿ä¸è¦è¶Šç•Œ</span>
</span></span><span style="display:flex;"><span>        crop_x_min <span style="color:#f92672">=</span> max(<span style="color:#ae81ff">0</span>, crop_x_min)
</span></span><span style="display:flex;"><span>        crop_y_min <span style="color:#f92672">=</span> max(<span style="color:#ae81ff">0</span>, crop_y_min)
</span></span><span style="display:flex;"><span>        crop_x_max <span style="color:#f92672">=</span> min(w, crop_x_max)
</span></span><span style="display:flex;"><span>        crop_y_max <span style="color:#f92672">=</span> min(h, crop_y_max)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        crop_img <span style="color:#f92672">=</span> img[crop_y_min:crop_y_max, crop_x_min:crop_x_max]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># è£å‰ªboundingbox</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># è£å‰ªåçš„boundingboxåæ ‡è®¡ç®—</span>
</span></span><span style="display:flex;"><span>        crop_bboxes <span style="color:#f92672">=</span> list()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> bbox <span style="color:#f92672">in</span> bboxes:
</span></span><span style="display:flex;"><span>            crop_bboxes<span style="color:#f92672">.</span>append([bbox[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">-</span> crop_x_min, bbox[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> crop_y_min, bbox[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">-</span> crop_x_min, bbox[<span style="color:#ae81ff">3</span>] <span style="color:#f92672">-</span> crop_y_min])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> crop_img, crop_bboxes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ---6.å¹³ç§»--- #</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_shift_pic_bboxes</span>(self, img, bboxes):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        å¹³ç§»åçš„å›¾ç‰‡è¦åŒ…å«æ‰€æœ‰çš„æ¡†
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        è¾“å…¥:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            img:å›¾åƒarray
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            bboxes:è¯¥å›¾åƒåŒ…å«çš„æ‰€æœ‰boundingboxs,ä¸€ä¸ªlist,æ¯ä¸ªå…ƒç´ ä¸º[x_min, y_min, x_max, y_max],è¦ç¡®ä¿æ˜¯æ•°å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        è¾“å‡º:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            shift_img:å¹³ç§»åçš„å›¾åƒarray
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            shift_bboxes:å¹³ç§»åçš„bounding boxçš„åæ ‡list
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># å¹³ç§»å›¾åƒ</span>
</span></span><span style="display:flex;"><span>        w <span style="color:#f92672">=</span> img<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>        h <span style="color:#f92672">=</span> img<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>        x_min <span style="color:#f92672">=</span> w  <span style="color:#75715e"># è£å‰ªåçš„åŒ…å«æ‰€æœ‰ç›®æ ‡æ¡†çš„æœ€å°çš„æ¡†</span>
</span></span><span style="display:flex;"><span>        x_max <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        y_min <span style="color:#f92672">=</span> h
</span></span><span style="display:flex;"><span>        y_max <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> bbox <span style="color:#f92672">in</span> bboxes:
</span></span><span style="display:flex;"><span>            x_min <span style="color:#f92672">=</span> min(x_min, bbox[<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>            y_min <span style="color:#f92672">=</span> min(y_min, bbox[<span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span>            x_max <span style="color:#f92672">=</span> max(x_max, bbox[<span style="color:#ae81ff">2</span>])
</span></span><span style="display:flex;"><span>            y_max <span style="color:#f92672">=</span> max(y_max, bbox[<span style="color:#ae81ff">3</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        d_to_left <span style="color:#f92672">=</span> x_min  <span style="color:#75715e"># åŒ…å«æ‰€æœ‰ç›®æ ‡æ¡†çš„æœ€å¤§å·¦ç§»åŠ¨è·ç¦»</span>
</span></span><span style="display:flex;"><span>        d_to_right <span style="color:#f92672">=</span> w <span style="color:#f92672">-</span> x_max  <span style="color:#75715e"># åŒ…å«æ‰€æœ‰ç›®æ ‡æ¡†çš„æœ€å¤§å³ç§»åŠ¨è·ç¦»</span>
</span></span><span style="display:flex;"><span>        d_to_top <span style="color:#f92672">=</span> y_min  <span style="color:#75715e"># åŒ…å«æ‰€æœ‰ç›®æ ‡æ¡†çš„æœ€å¤§ä¸Šç§»åŠ¨è·ç¦»</span>
</span></span><span style="display:flex;"><span>        d_to_bottom <span style="color:#f92672">=</span> h <span style="color:#f92672">-</span> y_max  <span style="color:#75715e"># åŒ…å«æ‰€æœ‰ç›®æ ‡æ¡†çš„æœ€å¤§ä¸‹ç§»åŠ¨è·ç¦»</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        x <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>uniform(<span style="color:#f92672">-</span>(d_to_left <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">/</span> <span style="color:#ae81ff">3</span>, (d_to_right <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">/</span> <span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>        y <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>uniform(<span style="color:#f92672">-</span>(d_to_top <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">/</span> <span style="color:#ae81ff">3</span>, (d_to_bottom <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">/</span> <span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        M <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>float32([[<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, x], [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, y]])  <span style="color:#75715e"># xä¸ºå‘å·¦æˆ–å³ç§»åŠ¨çš„åƒç´ å€¼,æ­£ä¸ºå‘å³è´Ÿä¸ºå‘å·¦; yä¸ºå‘ä¸Šæˆ–è€…å‘ä¸‹ç§»åŠ¨çš„åƒç´ å€¼,æ­£ä¸ºå‘ä¸‹è´Ÿä¸ºå‘ä¸Š</span>
</span></span><span style="display:flex;"><span>        shift_img <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>warpAffine(img, M, (img<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">1</span>], img<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>]))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#  å¹³ç§»boundingbox</span>
</span></span><span style="display:flex;"><span>        shift_bboxes <span style="color:#f92672">=</span> list()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> bbox <span style="color:#f92672">in</span> bboxes:
</span></span><span style="display:flex;"><span>            shift_bboxes<span style="color:#f92672">.</span>append([bbox[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">+</span> x, bbox[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> y, bbox[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">+</span> x, bbox[<span style="color:#ae81ff">3</span>] <span style="color:#f92672">+</span> y])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> shift_img, shift_bboxes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ---7.é•œåƒ--- #</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_filp_pic_bboxes</span>(self, img, bboxes):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            å¹³ç§»åçš„å›¾ç‰‡è¦åŒ…å«æ‰€æœ‰çš„æ¡†
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            è¾“å…¥:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                img:å›¾åƒarray
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                bboxes:è¯¥å›¾åƒåŒ…å«çš„æ‰€æœ‰boundingboxs,ä¸€ä¸ªlist,æ¯ä¸ªå…ƒç´ ä¸º[x_min, y_min, x_max, y_max],è¦ç¡®ä¿æ˜¯æ•°å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            è¾“å‡º:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                flip_img:å¹³ç§»åçš„å›¾åƒarray
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                flip_bboxes:å¹³ç§»åçš„bounding boxçš„åæ ‡list
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># ç¿»è½¬å›¾åƒ</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        flip_img <span style="color:#f92672">=</span> copy<span style="color:#f92672">.</span>deepcopy(img)
</span></span><span style="display:flex;"><span>        h, w, _ <span style="color:#f92672">=</span> img<span style="color:#f92672">.</span>shape
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        sed <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>random()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&lt;</span> sed <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0.33</span>:  <span style="color:#75715e"># 0.33çš„æ¦‚ç‡æ°´å¹³ç¿»è½¬ï¼Œ0.33çš„æ¦‚ç‡å‚ç›´ç¿»è½¬,0.33æ˜¯å¯¹è§’åè½¬</span>
</span></span><span style="display:flex;"><span>            flip_img <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>flip(flip_img, <span style="color:#ae81ff">0</span>)  <span style="color:#75715e"># _flip_x</span>
</span></span><span style="display:flex;"><span>            inver <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">elif</span> <span style="color:#ae81ff">0.33</span> <span style="color:#f92672">&lt;</span> sed <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0.66</span>:
</span></span><span style="display:flex;"><span>            flip_img <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>flip(flip_img, <span style="color:#ae81ff">1</span>)  <span style="color:#75715e"># _flip_y</span>
</span></span><span style="display:flex;"><span>            inver <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            flip_img <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>flip(flip_img, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)  <span style="color:#75715e"># flip_x_y</span>
</span></span><span style="display:flex;"><span>            inver <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># è°ƒæ•´boundingbox</span>
</span></span><span style="display:flex;"><span>        flip_bboxes <span style="color:#f92672">=</span> list()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> box <span style="color:#f92672">in</span> bboxes:
</span></span><span style="display:flex;"><span>            x_min <span style="color:#f92672">=</span> box[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>            y_min <span style="color:#f92672">=</span> box[<span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>            x_max <span style="color:#f92672">=</span> box[<span style="color:#ae81ff">2</span>]
</span></span><span style="display:flex;"><span>            y_max <span style="color:#f92672">=</span> box[<span style="color:#ae81ff">3</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> inver <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># 0ï¼šå‚ç›´ç¿»è½¬</span>
</span></span><span style="display:flex;"><span>                flip_bboxes<span style="color:#f92672">.</span>append([x_min, h <span style="color:#f92672">-</span> y_max, x_max, h <span style="color:#f92672">-</span> y_min])
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">elif</span> inver <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># 1ï¼šæ°´å¹³ç¿»è½¬</span>
</span></span><span style="display:flex;"><span>                flip_bboxes<span style="color:#f92672">.</span>append([w <span style="color:#f92672">-</span> x_max, y_min, w <span style="color:#f92672">-</span> x_min, y_max])
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">elif</span> inver <span style="color:#f92672">==</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># -1ï¼šæ°´å¹³å‚ç›´ç¿»è½¬</span>
</span></span><span style="display:flex;"><span>                flip_bboxes<span style="color:#f92672">.</span>append([w <span style="color:#f92672">-</span> x_max, h <span style="color:#f92672">-</span> y_max, w <span style="color:#f92672">-</span> x_min, h <span style="color:#f92672">-</span> y_min])
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> flip_img, flip_bboxes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># å›¾åƒå¢å¼ºæ–¹æ³•</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">dataAugment</span>(self, img, bboxes):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        å›¾åƒå¢å¼º
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        è¾“å…¥:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            img:å›¾åƒarray
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            bboxes:è¯¥å›¾åƒçš„æ‰€æœ‰æ¡†åæ ‡
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        è¾“å‡º:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            img:å¢å¼ºåçš„å›¾åƒ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            bboxes:å¢å¼ºåå›¾ç‰‡å¯¹åº”çš„box
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>        change_num <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>  <span style="color:#75715e"># æ”¹å˜çš„æ¬¡æ•°</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># print(&#39;------&#39;)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> change_num <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">1</span>:  <span style="color:#75715e"># é»˜è®¤è‡³å°‘æœ‰ä¸€ç§æ•°æ®å¢å¼ºç”Ÿæ•ˆ</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>is_rotate_img_bbox:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> random<span style="color:#f92672">.</span>random() <span style="color:#f92672">&gt;</span> self<span style="color:#f92672">.</span>rotation_rate:  <span style="color:#75715e"># æ—‹è½¬</span>
</span></span><span style="display:flex;"><span>                    change_num <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>                    angle <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>uniform(<span style="color:#f92672">-</span>self<span style="color:#f92672">.</span>max_rotation_angle, self<span style="color:#f92672">.</span>max_rotation_angle)
</span></span><span style="display:flex;"><span>                    scale <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>uniform(<span style="color:#ae81ff">0.7</span>, <span style="color:#ae81ff">0.8</span>)
</span></span><span style="display:flex;"><span>                    img, bboxes <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_rotate_img_bbox(img, bboxes, angle, scale)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>is_shift_pic_bboxes:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> random<span style="color:#f92672">.</span>random() <span style="color:#f92672">&lt;</span> self<span style="color:#f92672">.</span>shift_rate:  <span style="color:#75715e"># å¹³ç§»</span>
</span></span><span style="display:flex;"><span>                    change_num <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>                    img, bboxes <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_shift_pic_bboxes(img, bboxes)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>is_changeLight:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> random<span style="color:#f92672">.</span>random() <span style="color:#f92672">&gt;</span> self<span style="color:#f92672">.</span>change_light_rate:  <span style="color:#75715e"># æ”¹å˜äº®åº¦</span>
</span></span><span style="display:flex;"><span>                    change_num <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>                    img <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_changeLight(img)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>is_addNoise:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> random<span style="color:#f92672">.</span>random() <span style="color:#f92672">&lt;</span> self<span style="color:#f92672">.</span>add_noise_rate:  <span style="color:#75715e"># åŠ å™ªå£°</span>
</span></span><span style="display:flex;"><span>                    change_num <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>                    img <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_addNoise(img)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>is_cutout:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> random<span style="color:#f92672">.</span>random() <span style="color:#f92672">&lt;</span> self<span style="color:#f92672">.</span>cutout_rate:  <span style="color:#75715e"># cutout</span>
</span></span><span style="display:flex;"><span>                    change_num <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>                    img <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_cutout(img, bboxes, length<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>cut_out_length, n_holes<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>cut_out_holes,
</span></span><span style="display:flex;"><span>                                       threshold<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>cut_out_threshold)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>is_filp_pic_bboxes:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> random<span style="color:#f92672">.</span>random() <span style="color:#f92672">&lt;</span> self<span style="color:#f92672">.</span>flip_rate:  <span style="color:#75715e"># ç¿»è½¬</span>
</span></span><span style="display:flex;"><span>                    change_num <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>                    img, bboxes <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_filp_pic_bboxes(img, bboxes)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> img, bboxes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># xmlè§£æå·¥å…·</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ToolHelper</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ä»xmlæ–‡ä»¶ä¸­æå–bounding boxä¿¡æ¯, æ ¼å¼ä¸º[[x_min, y_min, x_max, y_max, name]]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">parse_xml</span>(self, path):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        è¾“å…¥ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            xml_path: xmlçš„æ–‡ä»¶è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        è¾“å‡ºï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            ä»xmlæ–‡ä»¶ä¸­æå–bounding boxä¿¡æ¯, æ ¼å¼ä¸º[[x_min, y_min, x_max, y_max, name]]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>        tree <span style="color:#f92672">=</span> ET<span style="color:#f92672">.</span>parse(path)
</span></span><span style="display:flex;"><span>        root <span style="color:#f92672">=</span> tree<span style="color:#f92672">.</span>getroot()
</span></span><span style="display:flex;"><span>        objs <span style="color:#f92672">=</span> root<span style="color:#f92672">.</span>findall(<span style="color:#e6db74">&#39;object&#39;</span>)
</span></span><span style="display:flex;"><span>        coords <span style="color:#f92672">=</span> list()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> ix, obj <span style="color:#f92672">in</span> enumerate(objs):
</span></span><span style="display:flex;"><span>            name <span style="color:#f92672">=</span> obj<span style="color:#f92672">.</span>find(<span style="color:#e6db74">&#39;name&#39;</span>)<span style="color:#f92672">.</span>text
</span></span><span style="display:flex;"><span>            box <span style="color:#f92672">=</span> obj<span style="color:#f92672">.</span>find(<span style="color:#e6db74">&#39;bndbox&#39;</span>)
</span></span><span style="display:flex;"><span>            x_min <span style="color:#f92672">=</span> int(box[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>text)
</span></span><span style="display:flex;"><span>            y_min <span style="color:#f92672">=</span> int(box[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>text)
</span></span><span style="display:flex;"><span>            x_max <span style="color:#f92672">=</span> int(box[<span style="color:#ae81ff">2</span>]<span style="color:#f92672">.</span>text)
</span></span><span style="display:flex;"><span>            y_max <span style="color:#f92672">=</span> int(box[<span style="color:#ae81ff">3</span>]<span style="color:#f92672">.</span>text)
</span></span><span style="display:flex;"><span>            coords<span style="color:#f92672">.</span>append([x_min, y_min, x_max, y_max, name])
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> coords
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ä¿å­˜å›¾ç‰‡ç»“æœ</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">save_img</span>(self, file_name, save_folder, img):
</span></span><span style="display:flex;"><span>        cv2<span style="color:#f92672">.</span>imwrite(os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(save_folder, file_name), img)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ä¿æŒxmlç»“æœ</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">save_xml</span>(self, file_name, save_folder, img_info, height, width, channel, bboxs_info):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        :param file_name:æ–‡ä»¶å
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        :param save_folder:#ä¿å­˜çš„xmlæ–‡ä»¶çš„ç»“æœ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        :param height:å›¾ç‰‡çš„ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        :param width:å›¾ç‰‡çš„å®½åº¦
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        :param channel:é€šé“
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        :return:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>        folder_name, img_name <span style="color:#f92672">=</span> img_info  <span style="color:#75715e"># å¾—åˆ°å›¾ç‰‡çš„ä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        E <span style="color:#f92672">=</span> objectify<span style="color:#f92672">.</span>ElementMaker(annotate<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        anno_tree <span style="color:#f92672">=</span> E<span style="color:#f92672">.</span>annotation(
</span></span><span style="display:flex;"><span>            E<span style="color:#f92672">.</span>folder(folder_name),
</span></span><span style="display:flex;"><span>            E<span style="color:#f92672">.</span>filename(img_name),
</span></span><span style="display:flex;"><span>            E<span style="color:#f92672">.</span>path(os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(folder_name, img_name)),
</span></span><span style="display:flex;"><span>            E<span style="color:#f92672">.</span>source(
</span></span><span style="display:flex;"><span>                E<span style="color:#f92672">.</span>database(<span style="color:#e6db74">&#39;Unknown&#39;</span>),
</span></span><span style="display:flex;"><span>            ),
</span></span><span style="display:flex;"><span>            E<span style="color:#f92672">.</span>size(
</span></span><span style="display:flex;"><span>                E<span style="color:#f92672">.</span>width(width),
</span></span><span style="display:flex;"><span>                E<span style="color:#f92672">.</span>height(height),
</span></span><span style="display:flex;"><span>                E<span style="color:#f92672">.</span>depth(channel)
</span></span><span style="display:flex;"><span>            ),
</span></span><span style="display:flex;"><span>            E<span style="color:#f92672">.</span>segmented(<span style="color:#ae81ff">0</span>),
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        labels, bboxs <span style="color:#f92672">=</span> bboxs_info  <span style="color:#75715e"># å¾—åˆ°è¾¹æ¡†å’Œæ ‡ç­¾ä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> label, box <span style="color:#f92672">in</span> zip(labels, bboxs):
</span></span><span style="display:flex;"><span>            anno_tree<span style="color:#f92672">.</span>append(
</span></span><span style="display:flex;"><span>                E<span style="color:#f92672">.</span>object(
</span></span><span style="display:flex;"><span>                    E<span style="color:#f92672">.</span>name(label),
</span></span><span style="display:flex;"><span>                    E<span style="color:#f92672">.</span>pose(<span style="color:#e6db74">&#39;Unspecified&#39;</span>),
</span></span><span style="display:flex;"><span>                    E<span style="color:#f92672">.</span>truncated(<span style="color:#e6db74">&#39;0&#39;</span>),
</span></span><span style="display:flex;"><span>                    E<span style="color:#f92672">.</span>difficult(<span style="color:#e6db74">&#39;0&#39;</span>),
</span></span><span style="display:flex;"><span>                    E<span style="color:#f92672">.</span>bndbox(
</span></span><span style="display:flex;"><span>                        E<span style="color:#f92672">.</span>xmin(box[<span style="color:#ae81ff">0</span>]),
</span></span><span style="display:flex;"><span>                        E<span style="color:#f92672">.</span>ymin(box[<span style="color:#ae81ff">1</span>]),
</span></span><span style="display:flex;"><span>                        E<span style="color:#f92672">.</span>xmax(box[<span style="color:#ae81ff">2</span>]),
</span></span><span style="display:flex;"><span>                        E<span style="color:#f92672">.</span>ymax(box[<span style="color:#ae81ff">3</span>])
</span></span><span style="display:flex;"><span>                    )
</span></span><span style="display:flex;"><span>                ))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        etree<span style="color:#f92672">.</span>ElementTree(anno_tree)<span style="color:#f92672">.</span>write(os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(save_folder, file_name), pretty_print<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    need_aug_num <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>  <span style="color:#75715e"># æ¯å¼ å›¾ç‰‡éœ€è¦å¢å¼ºçš„æ¬¡æ•°</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    is_endwidth_dot <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>  <span style="color:#75715e"># æ–‡ä»¶æ˜¯å¦ä»¥.jpgæˆ–è€…pngç»“å°¾</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    dataAug <span style="color:#f92672">=</span> DataAugmentForObjectDetection()  <span style="color:#75715e"># æ•°æ®å¢å¼ºå·¥å…·ç±»</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    toolhelper <span style="color:#f92672">=</span> ToolHelper()  <span style="color:#75715e"># å·¥å…·</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># è·å–ç›¸å…³å‚æ•°</span>
</span></span><span style="display:flex;"><span>    parser <span style="color:#f92672">=</span> argparse<span style="color:#f92672">.</span>ArgumentParser()
</span></span><span style="display:flex;"><span>    parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--source_img_path&#39;</span>, type<span style="color:#f92672">=</span>str, default<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;D:\@Graduation\enhance\images&#39;</span>)
</span></span><span style="display:flex;"><span>    parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--source_xml_path&#39;</span>, type<span style="color:#f92672">=</span>str, default<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;D:\@Graduation\enhance\labels&#39;</span>)
</span></span><span style="display:flex;"><span>    parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--save_img_path&#39;</span>, type<span style="color:#f92672">=</span>str, default<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;D:\@Graduation\enhance\images2&#39;</span>)
</span></span><span style="display:flex;"><span>    parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--save_xml_path&#39;</span>, type<span style="color:#f92672">=</span>str, default<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;D:\@Graduation\enhance\Annotations2&#39;</span>)
</span></span><span style="display:flex;"><span>    args <span style="color:#f92672">=</span> parser<span style="color:#f92672">.</span>parse_args()
</span></span><span style="display:flex;"><span>    source_img_path <span style="color:#f92672">=</span> args<span style="color:#f92672">.</span>source_img_path  <span style="color:#75715e"># å›¾ç‰‡åŸå§‹ä½ç½®</span>
</span></span><span style="display:flex;"><span>    source_xml_path <span style="color:#f92672">=</span> args<span style="color:#f92672">.</span>source_xml_path  <span style="color:#75715e"># xmlçš„åŸå§‹ä½ç½®</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    save_img_path <span style="color:#f92672">=</span> args<span style="color:#f92672">.</span>save_img_path  <span style="color:#75715e"># å›¾ç‰‡å¢å¼ºç»“æœä¿å­˜æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>    save_xml_path <span style="color:#f92672">=</span> args<span style="color:#f92672">.</span>save_xml_path  <span style="color:#75715e"># xmlå¢å¼ºç»“æœä¿å­˜æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># å¦‚æœä¿å­˜æ–‡ä»¶å¤¹ä¸å­˜åœ¨å°±åˆ›å»º</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>exists(save_img_path):
</span></span><span style="display:flex;"><span>        os<span style="color:#f92672">.</span>mkdir(save_img_path)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>exists(save_xml_path):
</span></span><span style="display:flex;"><span>        os<span style="color:#f92672">.</span>mkdir(save_xml_path)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> parent, _, files <span style="color:#f92672">in</span> os<span style="color:#f92672">.</span>walk(source_img_path):
</span></span><span style="display:flex;"><span>        files<span style="color:#f92672">.</span>sort()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> file <span style="color:#f92672">in</span> files:
</span></span><span style="display:flex;"><span>            cnt <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>            pic_path <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(parent, file)
</span></span><span style="display:flex;"><span>            xml_path <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(source_xml_path, file[:<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>] <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;.xml&#39;</span>)
</span></span><span style="display:flex;"><span>            values <span style="color:#f92672">=</span> toolhelper<span style="color:#f92672">.</span>parse_xml(xml_path)  <span style="color:#75715e"># è§£æå¾—åˆ°boxä¿¡æ¯ï¼Œæ ¼å¼ä¸º[[x_min,y_min,x_max,y_max,name]]</span>
</span></span><span style="display:flex;"><span>            coords <span style="color:#f92672">=</span> [v[:<span style="color:#ae81ff">4</span>] <span style="color:#66d9ef">for</span> v <span style="color:#f92672">in</span> values]  <span style="color:#75715e"># å¾—åˆ°æ¡†</span>
</span></span><span style="display:flex;"><span>            labels <span style="color:#f92672">=</span> [v[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#66d9ef">for</span> v <span style="color:#f92672">in</span> values]  <span style="color:#75715e"># å¯¹è±¡çš„æ ‡ç­¾</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># å¦‚æœå›¾ç‰‡æ˜¯æœ‰åç¼€çš„</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> is_endwidth_dot:
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># æ‰¾åˆ°æ–‡ä»¶çš„æœ€ååå­—</span>
</span></span><span style="display:flex;"><span>                dot_index <span style="color:#f92672">=</span> file<span style="color:#f92672">.</span>rfind(<span style="color:#e6db74">&#39;.&#39;</span>)
</span></span><span style="display:flex;"><span>                _file_prefix <span style="color:#f92672">=</span> file[:dot_index]  <span style="color:#75715e"># æ–‡ä»¶åçš„å‰ç¼€</span>
</span></span><span style="display:flex;"><span>                _file_suffix <span style="color:#f92672">=</span> file[dot_index:]  <span style="color:#75715e"># æ–‡ä»¶åçš„åç¼€</span>
</span></span><span style="display:flex;"><span>            img <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>imread(pic_path)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># show_pic(img, coords)  # æ˜¾ç¤ºåŸå›¾</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">while</span> cnt <span style="color:#f92672">&lt;</span> need_aug_num:  <span style="color:#75715e"># ç»§ç»­å¢å¼º</span>
</span></span><span style="display:flex;"><span>                auged_img, auged_bboxes <span style="color:#f92672">=</span> dataAug<span style="color:#f92672">.</span>dataAugment(img, coords)
</span></span><span style="display:flex;"><span>                auged_bboxes_int <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(auged_bboxes)<span style="color:#f92672">.</span>astype(np<span style="color:#f92672">.</span>int32)
</span></span><span style="display:flex;"><span>                height, width, channel <span style="color:#f92672">=</span> auged_img<span style="color:#f92672">.</span>shape  <span style="color:#75715e"># å¾—åˆ°å›¾ç‰‡çš„å±æ€§</span>
</span></span><span style="display:flex;"><span>                img_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">_</span><span style="color:#e6db74">{}{}</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>format(_file_prefix, cnt <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, _file_suffix)  <span style="color:#75715e"># å›¾ç‰‡ä¿å­˜çš„ä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>                toolhelper<span style="color:#f92672">.</span>save_img(img_name, save_img_path,
</span></span><span style="display:flex;"><span>                                    auged_img)  <span style="color:#75715e"># ä¿å­˜å¢å¼ºå›¾ç‰‡</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                toolhelper<span style="color:#f92672">.</span>save_xml(<span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">_</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">.xml&#39;</span><span style="color:#f92672">.</span>format(_file_prefix, cnt <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>),
</span></span><span style="display:flex;"><span>                                    save_xml_path, (save_img_path, img_name), height, width, channel,
</span></span><span style="display:flex;"><span>                                    (labels, auged_bboxes_int))  <span style="color:#75715e"># ä¿å­˜xmlæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># show_pic(auged_img, auged_bboxes)  # å¼ºåŒ–åçš„å›¾</span>
</span></span><span style="display:flex;"><span>                print(img_name)
</span></span><span style="display:flex;"><span>                cnt <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>  <span style="color:#75715e"># ç»§ç»­å¢å¼ºä¸‹ä¸€å¼ </span>
</span></span></code></pre></div><p><strong>è¿™æ˜¯æ‰©å……æ•°æ®é›†åçš„æ•ˆæœå›¾ï¼š</strong></p>
<p><img src="https://bu.dusays.com/2024/04/23/6627b07a28fd0.jpeg" alt="6627b07a28fd0.jpeg"></p>
<p><strong>æ¥ä¸‹æ¥éœ€è¦å¯¹æ‰©å……å¥½çš„æ•°æ®é›†è¿›è¡Œxmlè½¬txtï¼š</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> xml.etree.ElementTree <span style="color:#66d9ef">as</span> ET
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> os <span style="color:#f92672">import</span> getcwd
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> glob
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è‡ªå·±åˆ›å»ºæ–‡ä»¶å¤¹,ä¾‹å¦‚ï¼šlabel_mal label_txt  ä¹Ÿå¯ä»¥ä¿®æ”¹åˆ«çš„</span>
</span></span><span style="display:flex;"><span>image_set <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;xml&#39;</span>  <span style="color:#75715e"># éœ€è¦è½¬æ¢çš„æ–‡ä»¶å¤¹åç§°ï¼ˆæ–‡ä»¶å¤¹å†…æ”¾xmlæ ‡ç­¾æ–‡ä»¶ï¼‰</span>
</span></span><span style="display:flex;"><span>imageset2 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;labels2&#39;</span>  <span style="color:#75715e"># ä¿å­˜txtçš„æ–‡ä»¶å¤¹</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ¢æˆä½ çš„ç±»åˆ« å½“å‰çš„é¡ºåºï¼Œå°±txt 0,1,2,3 å››ä¸ªç±»åˆ«</span>
</span></span><span style="display:flex;"><span>classes <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;0&#39;</span>]  <span style="color:#75715e"># æ ‡æ³¨æ—¶çš„æ ‡ç­¾ æ³¨æ„é¡ºåºä¸€å®šä¸è¦é”™ã€‚</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 3.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># # è½¬æ¢æ–‡ä»¶å¤¹çš„ç»å¯¹è·¯å¾„</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># data_dir = &#39;D:/detectAuto_/data&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æˆ–è€… è¯»å–å½“å‰è·¯å¾„</span>
</span></span><span style="display:flex;"><span>data_dir <span style="color:#f92672">=</span> getcwd()  <span style="color:#75715e"># å½“å‰è·¯å¾„</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">xmlä¸­æ¡†çš„å·¦ä¸Šè§’åæ ‡å’Œå³ä¸‹è§’åæ ‡(x1,y1,x2,y2)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ã€‹ã€‹txtä¸­çš„ä¸­å¿ƒç‚¹åæ ‡å’Œå®½å’Œé«˜(x,y,w,h)ï¼Œå¹¶ä¸”å½’ä¸€åŒ–
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">convert</span>(size, box):
</span></span><span style="display:flex;"><span>    dw <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.</span> <span style="color:#f92672">/</span> size[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>    dh <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.</span> <span style="color:#f92672">/</span> size[<span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>    x <span style="color:#f92672">=</span> (box[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">+</span> box[<span style="color:#ae81ff">1</span>]) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2.0</span>
</span></span><span style="display:flex;"><span>    y <span style="color:#f92672">=</span> (box[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">+</span> box[<span style="color:#ae81ff">3</span>]) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2.0</span>
</span></span><span style="display:flex;"><span>    w <span style="color:#f92672">=</span> box[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> box[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>    h <span style="color:#f92672">=</span> box[<span style="color:#ae81ff">3</span>] <span style="color:#f92672">-</span> box[<span style="color:#ae81ff">2</span>]
</span></span><span style="display:flex;"><span>    x <span style="color:#f92672">=</span> x <span style="color:#f92672">*</span> dw
</span></span><span style="display:flex;"><span>    w <span style="color:#f92672">=</span> w <span style="color:#f92672">*</span> dw
</span></span><span style="display:flex;"><span>    y <span style="color:#f92672">=</span> y <span style="color:#f92672">*</span> dh
</span></span><span style="display:flex;"><span>    h <span style="color:#f92672">=</span> h <span style="color:#f92672">*</span> dh
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> (x, y, w, h)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">convert_annotation</span>(data_dir, imageset1, imageset2, image_id):
</span></span><span style="display:flex;"><span>    in_file <span style="color:#f92672">=</span> open(data_dir <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;/</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">/</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">.xml&#39;</span> <span style="color:#f92672">%</span> (imageset1, image_id),encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;UTF-8&#39;</span>)  <span style="color:#75715e"># è¯»å–xml</span>
</span></span><span style="display:flex;"><span>    out_file <span style="color:#f92672">=</span> open(data_dir <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;/</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">/</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">.txt&#39;</span> <span style="color:#f92672">%</span> (imageset2, image_id), <span style="color:#e6db74">&#39;w&#39;</span>,encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;UTF-8&#39;</span>)  <span style="color:#75715e"># ä¿å­˜txt</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    tree <span style="color:#f92672">=</span> ET<span style="color:#f92672">.</span>parse(in_file)
</span></span><span style="display:flex;"><span>    root <span style="color:#f92672">=</span> tree<span style="color:#f92672">.</span>getroot()
</span></span><span style="display:flex;"><span>    size <span style="color:#f92672">=</span> root<span style="color:#f92672">.</span>find(<span style="color:#e6db74">&#39;size&#39;</span>)
</span></span><span style="display:flex;"><span>    w <span style="color:#f92672">=</span> int(size<span style="color:#f92672">.</span>find(<span style="color:#e6db74">&#39;width&#39;</span>)<span style="color:#f92672">.</span>text)
</span></span><span style="display:flex;"><span>    h <span style="color:#f92672">=</span> int(size<span style="color:#f92672">.</span>find(<span style="color:#e6db74">&#39;height&#39;</span>)<span style="color:#f92672">.</span>text)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> obj <span style="color:#f92672">in</span> root<span style="color:#f92672">.</span>iter(<span style="color:#e6db74">&#39;object&#39;</span>):
</span></span><span style="display:flex;"><span>        difficult <span style="color:#f92672">=</span> obj<span style="color:#f92672">.</span>find(<span style="color:#e6db74">&#39;difficult&#39;</span>)<span style="color:#f92672">.</span>text
</span></span><span style="display:flex;"><span>        cls <span style="color:#f92672">=</span> obj<span style="color:#f92672">.</span>find(<span style="color:#e6db74">&#39;name&#39;</span>)<span style="color:#f92672">.</span>text
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> cls <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> classes <span style="color:#f92672">or</span> int(difficult) <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>        cls_id <span style="color:#f92672">=</span> classes<span style="color:#f92672">.</span>index(cls)  <span style="color:#75715e"># è·å–ç±»åˆ«ç´¢å¼•</span>
</span></span><span style="display:flex;"><span>        xmlbox <span style="color:#f92672">=</span> obj<span style="color:#f92672">.</span>find(<span style="color:#e6db74">&#39;bndbox&#39;</span>)
</span></span><span style="display:flex;"><span>        b <span style="color:#f92672">=</span> (float(xmlbox<span style="color:#f92672">.</span>find(<span style="color:#e6db74">&#39;xmin&#39;</span>)<span style="color:#f92672">.</span>text), float(xmlbox<span style="color:#f92672">.</span>find(<span style="color:#e6db74">&#39;xmax&#39;</span>)<span style="color:#f92672">.</span>text), float(xmlbox<span style="color:#f92672">.</span>find(<span style="color:#e6db74">&#39;ymin&#39;</span>)<span style="color:#f92672">.</span>text),
</span></span><span style="display:flex;"><span>             float(xmlbox<span style="color:#f92672">.</span>find(<span style="color:#e6db74">&#39;ymax&#39;</span>)<span style="color:#f92672">.</span>text))
</span></span><span style="display:flex;"><span>        bb <span style="color:#f92672">=</span> convert((w, h), b)
</span></span><span style="display:flex;"><span>        out_file<span style="color:#f92672">.</span>write(str(cls_id) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; &#34;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; &#34;</span><span style="color:#f92672">.</span>join([str(<span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%.6f</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> a) <span style="color:#66d9ef">for</span> a <span style="color:#f92672">in</span> bb]) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>image_ids <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> glob<span style="color:#f92672">.</span>glob(data_dir <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;/</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> image_set <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;/*.xml&#39;</span>):
</span></span><span style="display:flex;"><span>    image_ids<span style="color:#f92672">.</span>append(os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>basename(x)[:<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>])
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">æ•°é‡:&#39;</span> <span style="color:#f92672">%</span> image_set, len(image_ids))  <span style="color:#75715e"># ç¡®è®¤æ•°é‡</span>
</span></span><span style="display:flex;"><span>i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> image_id <span style="color:#f92672">in</span> image_ids:
</span></span><span style="display:flex;"><span>    i <span style="color:#f92672">=</span> i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    convert_annotation(data_dir, image_set, imageset2, image_id)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74"> æ•°æ®:</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">/</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">æ–‡ä»¶å®Œæˆï¼&#34;</span> <span style="color:#f92672">%</span> (image_set, i, len(image_ids)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;Done!!!&#34;</span>)
</span></span></code></pre></div><p>ç„¶åæ‰“åŒ…å¥½æ•°æ®é›†ä¸Šä¼ æœåŠ¡å™¨</p>
<h2 id="autodlè®­ç»ƒæ•ˆæœ">Autodlè®­ç»ƒæ•ˆæœ</h2>
<hr>
<p>ç”±äºå¼•å…¥äº†æ•°æ®é›†è¿›è¡Œæ‰©å……åï¼Œå›¾ç‰‡çš„æ•°é‡å¢å¤šï¼Œè®­ç»ƒæ—¶é—´ä¹Ÿæ›´é•¿ã€‚</p>
<p><strong>50è½®è®­ç»ƒçš„æ•ˆæœå›¾ï¼š</strong></p>
<p><img src="https://bu.dusays.com/2024/04/23/6627b0cfc7a18.jpeg" alt="6627b0cfc7a18.jpeg"></p>
<p><img src="https://bu.dusays.com/2024/04/23/6627b0e219483.jpeg" alt="6627b0e219483.jpeg"></p>
<p><strong>60è½®è®­ç»ƒçš„æ•ˆæœå›¾ï¼š</strong></p>
<p><img src="https://bu.dusays.com/2024/04/23/6627b0f6ba6c8.jpeg" alt="6627b0f6ba6c8.jpeg"></p>
<p><img src="https://bu.dusays.com/2024/04/23/6627b11e00ddd.jpeg" alt="6627b11e00ddd.jpeg"></p>
<p><strong>100è½®è®­ç»ƒçš„æ•ˆæœå›¾ï¼š</strong></p>
<p><img src="https://bu.dusays.com/2024/04/23/6627b1f607e8a.jpeg" alt="6627b1f607e8a.jpeg"></p>
<p><img src="https://bu.dusays.com/2024/04/23/6627b22dea65c.jpeg" alt="6627b22dea65c.jpeg"></p>
<p>åº”è¯¥è¿˜æ˜¯æ•°æ®é›†çš„é—®é¢˜ï¼Œå‡ºç°äº†è¿‡æ‹Ÿåˆçš„ç°è±¡ã€‚ä¹‹åè‚¯å®šè¿˜éœ€è¦å¯¹æ•°æ®é›†è¿›è¡Œè°ƒæ•´ï¼Œå¦å¤–ç”±äºé‡‡ç”¨çš„æ˜¯æœ€å¿«çš„è®­ç»ƒæ¨¡å‹ï¼Œåœ¨è®­ç»ƒç²¾åº¦ä¸Šè‚¯å®šè¿˜æœ‰æå‡çš„ç©ºé—´ã€‚ä½†ä¹‹å‰åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œè¿˜å‡ºç°äº†ä¸€äº›æŠ¥é”™çš„æƒ…å†µï¼Œéœ€è¦å†èŠ±æ—¶é—´ç ”ç©¶ç ”ç©¶ã€‚</p>
<h2 id="æµ‹è¯•æ¨¡å—çš„ç¼–å†™">æµ‹è¯•æ¨¡å—çš„ç¼–å†™</h2>
<hr>
<p>åœ¨è®¾è®¡GUIä¹‹å‰ï¼Œéœ€è¦åˆæ­¥å®Œæˆå›¾ç‰‡å’Œè§†é¢‘æ£€æµ‹çš„ç¨‹åºç¼–å†™</p>
<p><strong>1.å›¾ç‰‡æ£€æµ‹æµ‹è¯•-æ ¸å¿ƒä»£ç æ‘˜å½•</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">predict</span>(img):
</span></span><span style="display:flex;"><span>    img <span style="color:#f92672">=</span> torch<span style="color:#f92672">.</span>from_numpy(img)<span style="color:#f92672">.</span>to(device)
</span></span><span style="display:flex;"><span>    img <span style="color:#f92672">=</span> img<span style="color:#f92672">.</span>half() <span style="color:#66d9ef">if</span> half <span style="color:#66d9ef">else</span> img<span style="color:#f92672">.</span>float()
</span></span><span style="display:flex;"><span>    img <span style="color:#f92672">/=</span> <span style="color:#ae81ff">255.0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> img<span style="color:#f92672">.</span>ndimension() <span style="color:#f92672">==</span> <span style="color:#ae81ff">3</span>:
</span></span><span style="display:flex;"><span>        img <span style="color:#f92672">=</span> img<span style="color:#f92672">.</span>unsqueeze(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    t1 <span style="color:#f92672">=</span> time_synchronized()
</span></span><span style="display:flex;"><span>    pred <span style="color:#f92672">=</span> model(img, augment<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>    pred <span style="color:#f92672">=</span> non_max_suppression(pred, opt<span style="color:#f92672">.</span>conf_thres, opt<span style="color:#f92672">.</span>iou_thres, classes<span style="color:#f92672">=</span>opt<span style="color:#f92672">.</span>classes,
</span></span><span style="display:flex;"><span>                               agnostic<span style="color:#f92672">=</span>opt<span style="color:#f92672">.</span>agnostic_nms)
</span></span><span style="display:flex;"><span>    t2 <span style="color:#f92672">=</span> time_synchronized()
</span></span><span style="display:flex;"><span>    InferNms <span style="color:#f92672">=</span> round((t2 <span style="color:#f92672">-</span> t1), <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> pred, InferNms
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">cv_imread</span>(filePath):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># è¯»å–å›¾ç‰‡</span>
</span></span><span style="display:flex;"><span>    cv_img <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>imdecode(np<span style="color:#f92672">.</span>fromfile(filePath, dtype<span style="color:#f92672">=</span>np<span style="color:#f92672">.</span>uint8), <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> len(cv_img<span style="color:#f92672">.</span>shape) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">2</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> cv_img<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">3</span>:
</span></span><span style="display:flex;"><span>            cv_img <span style="color:#f92672">=</span> cv_img[:, :, :<span style="color:#ae81ff">3</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> cv_img
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">plot_one_box</span>(img, x, color<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, label<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, line_thickness<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Plots one bounding box on image img</span>
</span></span><span style="display:flex;"><span>    tl <span style="color:#f92672">=</span> line_thickness <span style="color:#f92672">or</span> round(<span style="color:#ae81ff">0.002</span> <span style="color:#f92672">*</span> (img<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">+</span> img<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">1</span>]) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>  <span style="color:#75715e"># line/font thickness</span>
</span></span><span style="display:flex;"><span>    color <span style="color:#f92672">=</span> color <span style="color:#f92672">or</span> [random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">255</span>) <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">3</span>)]
</span></span><span style="display:flex;"><span>    c1, c2 <span style="color:#f92672">=</span> (int(x[<span style="color:#ae81ff">0</span>]), int(x[<span style="color:#ae81ff">1</span>])), (int(x[<span style="color:#ae81ff">2</span>]), int(x[<span style="color:#ae81ff">3</span>]))
</span></span><span style="display:flex;"><span>    cv2<span style="color:#f92672">.</span>rectangle(img, c1, c2, color, thickness<span style="color:#f92672">=</span>tl, lineType<span style="color:#f92672">=</span>cv2<span style="color:#f92672">.</span>LINE_AA)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> label:
</span></span><span style="display:flex;"><span>        tf <span style="color:#f92672">=</span> max(tl <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>)  <span style="color:#75715e"># font thickness</span>
</span></span><span style="display:flex;"><span>        t_size <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>getTextSize(label, <span style="color:#ae81ff">0</span>, fontScale<span style="color:#f92672">=</span>tl <span style="color:#f92672">/</span> <span style="color:#ae81ff">3</span>, thickness<span style="color:#f92672">=</span>tf)[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>        c2 <span style="color:#f92672">=</span> c1[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">+</span> t_size[<span style="color:#ae81ff">0</span>], c1[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> t_size[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>        cv2<span style="color:#f92672">.</span>rectangle(img, c1, c2, color, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, cv2<span style="color:#f92672">.</span>LINE_AA)  <span style="color:#75715e"># filled</span>
</span></span><span style="display:flex;"><span>        cv2<span style="color:#f92672">.</span>putText(img, label, (c1[<span style="color:#ae81ff">0</span>], c1[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span>), <span style="color:#ae81ff">0</span>, tl <span style="color:#f92672">/</span> <span style="color:#ae81ff">3</span>, [<span style="color:#ae81ff">225</span>, <span style="color:#ae81ff">255</span>, <span style="color:#ae81ff">255</span>], thickness<span style="color:#f92672">=</span>tf, lineType<span style="color:#f92672">=</span>cv2<span style="color:#f92672">.</span>LINE_AA)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    img_path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;./UI_rec/testpicture/000743_slice_3_5.jpg&#34;</span>
</span></span><span style="display:flex;"><span>    image <span style="color:#f92672">=</span> cv_imread(img_path)
</span></span><span style="display:flex;"><span>    image <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>resize(image, (<span style="color:#ae81ff">640</span>, <span style="color:#ae81ff">640</span>))
</span></span><span style="display:flex;"><span>    img0 <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>copy()
</span></span><span style="display:flex;"><span>    img <span style="color:#f92672">=</span> letterbox(img0, new_shape<span style="color:#f92672">=</span>imgsz)[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>    img <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>stack(img, <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>    img <span style="color:#f92672">=</span> img[:, :, ::<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>transpose(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>)  <span style="color:#75715e"># BGR to RGB, to 3x416x416</span>
</span></span><span style="display:flex;"><span>    img <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>ascontiguousarray(img)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    pred, useTime <span style="color:#f92672">=</span> predict(img)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    det <span style="color:#f92672">=</span> pred[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>    p, s, im0 <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>, <span style="color:#e6db74">&#39;&#39;</span>, img0
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> det <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span> <span style="color:#f92672">and</span> len(det):  <span style="color:#75715e"># å¦‚æœæœ‰æ£€æµ‹ä¿¡æ¯åˆ™è¿›å…¥</span>
</span></span><span style="display:flex;"><span>        det[:, :<span style="color:#ae81ff">4</span>] <span style="color:#f92672">=</span> scale_coords(img<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">1</span>:], det[:, :<span style="color:#ae81ff">4</span>], im0<span style="color:#f92672">.</span>shape)<span style="color:#f92672">.</span>round()  <span style="color:#75715e"># æŠŠå›¾åƒç¼©æ”¾è‡³im0çš„å°ºå¯¸</span>
</span></span><span style="display:flex;"><span>        number_i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>  <span style="color:#75715e"># ç±»åˆ«é¢„ç¼–å·</span>
</span></span><span style="display:flex;"><span>        detInfo <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> <span style="color:#f92672">*</span>xyxy, conf, cls <span style="color:#f92672">in</span> reversed(det):  <span style="color:#75715e"># éå†æ£€æµ‹ä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>            c1, c2 <span style="color:#f92672">=</span> (int(xyxy[<span style="color:#ae81ff">0</span>]), int(xyxy[<span style="color:#ae81ff">1</span>])), (int(xyxy[<span style="color:#ae81ff">2</span>]), int(xyxy[<span style="color:#ae81ff">3</span>]))
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># å°†æ£€æµ‹ä¿¡æ¯æ·»åŠ åˆ°å­—å…¸ä¸­</span>
</span></span><span style="display:flex;"><span>            detInfo<span style="color:#f92672">.</span>append([names[int(cls)], [c1[<span style="color:#ae81ff">0</span>], c1[<span style="color:#ae81ff">1</span>], c2[<span style="color:#ae81ff">0</span>], c2[<span style="color:#ae81ff">1</span>]], <span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%.2f</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> conf])
</span></span><span style="display:flex;"><span>            number_i <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>  <span style="color:#75715e"># ç¼–å·æ•°+1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            label <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74"> </span><span style="color:#e6db74">%.2f</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> (names[int(cls)], conf)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># ç”»å‡ºæ£€æµ‹åˆ°çš„ç›®æ ‡ç‰©</span>
</span></span><span style="display:flex;"><span>            plot_one_box(image, xyxy, label<span style="color:#f92672">=</span>label, color<span style="color:#f92672">=</span>colors[int(cls)])
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># å®æ—¶æ˜¾ç¤ºæ£€æµ‹ç”»é¢</span>
</span></span><span style="display:flex;"><span>    cv2<span style="color:#f92672">.</span>imshow(<span style="color:#e6db74">&#39;Stream&#39;</span>, image)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># if cv2.waitKey(1) &amp; 0xFF == ord(&#39;q&#39;):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#     break</span>
</span></span><span style="display:flex;"><span>    c <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>waitKey(<span style="color:#ae81ff">0</span>) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xff</span>
</span></span></code></pre></div><p><img src="https://bu.dusays.com/2024/04/23/6627b25442ff4.jpeg" alt="6627b25442ff4.jpeg"></p>
<p>2.<strong>è§†é¢‘æ£€æµ‹æµ‹è¯•-æ ¸å¿ƒä»£ç æ‘˜å½•</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">predict</span>(img):
</span></span><span style="display:flex;"><span>    img <span style="color:#f92672">=</span> torch<span style="color:#f92672">.</span>from_numpy(img)<span style="color:#f92672">.</span>to(device)
</span></span><span style="display:flex;"><span>    img <span style="color:#f92672">=</span> img<span style="color:#f92672">.</span>half() <span style="color:#66d9ef">if</span> half <span style="color:#66d9ef">else</span> img<span style="color:#f92672">.</span>float()
</span></span><span style="display:flex;"><span>    img <span style="color:#f92672">/=</span> <span style="color:#ae81ff">255.0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> img<span style="color:#f92672">.</span>ndimension() <span style="color:#f92672">==</span> <span style="color:#ae81ff">3</span>:
</span></span><span style="display:flex;"><span>        img <span style="color:#f92672">=</span> img<span style="color:#f92672">.</span>unsqueeze(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    t1 <span style="color:#f92672">=</span> time_synchronized()
</span></span><span style="display:flex;"><span>    pred <span style="color:#f92672">=</span> model(img, augment<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>    pred <span style="color:#f92672">=</span> non_max_suppression(pred, opt<span style="color:#f92672">.</span>conf_thres, opt<span style="color:#f92672">.</span>iou_thres, classes<span style="color:#f92672">=</span>opt<span style="color:#f92672">.</span>classes,
</span></span><span style="display:flex;"><span>                               agnostic<span style="color:#f92672">=</span>opt<span style="color:#f92672">.</span>agnostic_nms)
</span></span><span style="display:flex;"><span>    t2 <span style="color:#f92672">=</span> time_synchronized()
</span></span><span style="display:flex;"><span>    InferNms <span style="color:#f92672">=</span> round((t2 <span style="color:#f92672">-</span> t1), <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> pred, InferNms
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">plot_one_box</span>(img, x, color<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, label<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, line_thickness<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Plots one bounding box on image img</span>
</span></span><span style="display:flex;"><span>    tl <span style="color:#f92672">=</span> line_thickness <span style="color:#f92672">or</span> round(<span style="color:#ae81ff">0.002</span> <span style="color:#f92672">*</span> (img<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">+</span> img<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">1</span>]) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>  <span style="color:#75715e"># line/font thickness</span>
</span></span><span style="display:flex;"><span>    color <span style="color:#f92672">=</span> color <span style="color:#f92672">or</span> [random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">255</span>) <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">3</span>)]
</span></span><span style="display:flex;"><span>    c1, c2 <span style="color:#f92672">=</span> (int(x[<span style="color:#ae81ff">0</span>]), int(x[<span style="color:#ae81ff">1</span>])), (int(x[<span style="color:#ae81ff">2</span>]), int(x[<span style="color:#ae81ff">3</span>]))
</span></span><span style="display:flex;"><span>    cv2<span style="color:#f92672">.</span>rectangle(img, c1, c2, color, thickness<span style="color:#f92672">=</span>tl, lineType<span style="color:#f92672">=</span>cv2<span style="color:#f92672">.</span>LINE_AA)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> label:
</span></span><span style="display:flex;"><span>        tf <span style="color:#f92672">=</span> max(tl <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>)  <span style="color:#75715e"># font thickness</span>
</span></span><span style="display:flex;"><span>        t_size <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>getTextSize(label, <span style="color:#ae81ff">0</span>, fontScale<span style="color:#f92672">=</span>tl <span style="color:#f92672">/</span> <span style="color:#ae81ff">3</span>, thickness<span style="color:#f92672">=</span>tf)[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>        c2 <span style="color:#f92672">=</span> c1[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">+</span> t_size[<span style="color:#ae81ff">0</span>], c1[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> t_size[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>        cv2<span style="color:#f92672">.</span>rectangle(img, c1, c2, color, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, cv2<span style="color:#f92672">.</span>LINE_AA)  <span style="color:#75715e"># filled</span>
</span></span><span style="display:flex;"><span>        cv2<span style="color:#f92672">.</span>putText(img, label, (c1[<span style="color:#ae81ff">0</span>], c1[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span>), <span style="color:#ae81ff">0</span>, tl <span style="color:#f92672">/</span> <span style="color:#ae81ff">3</span>, [<span style="color:#ae81ff">225</span>, <span style="color:#ae81ff">255</span>, <span style="color:#ae81ff">255</span>], thickness<span style="color:#f92672">=</span>tf, lineType<span style="color:#f92672">=</span>cv2<span style="color:#f92672">.</span>LINE_AA)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#video_path = 1</span>
</span></span><span style="display:flex;"><span>    video_path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;UI_rec/testvideo/test.mp4&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># åˆå§‹åŒ–è§†é¢‘æµ</span>
</span></span><span style="display:flex;"><span>    vs <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>VideoCapture(video_path)
</span></span><span style="display:flex;"><span>    (W, H) <span style="color:#f92672">=</span> (<span style="color:#66d9ef">None</span>, <span style="color:#66d9ef">None</span>)
</span></span><span style="display:flex;"><span>    frameIndex <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>  <span style="color:#75715e"># è§†é¢‘å¸§æ•°</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        prop <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>CAP_PROP_FRAME_COUNT
</span></span><span style="display:flex;"><span>        total <span style="color:#f92672">=</span> int(vs<span style="color:#f92672">.</span>get(prop))
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># print(&#34;[INFO] è§†é¢‘æ€»å¸§æ•°ï¼š{}&#34;.format(total))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># è‹¥è¯»å–å¤±è´¥ï¼ŒæŠ¥é”™é€€å‡º</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span>:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;[INFO] could not determine # of frames in video&#34;</span>)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;[INFO] no approx. completion time can be provided&#34;</span>)
</span></span><span style="display:flex;"><span>        total <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    fourcc <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>VideoWriter_fourcc(<span style="color:#f92672">*</span><span style="color:#e6db74">&#39;XVID&#39;</span>)
</span></span><span style="display:flex;"><span>    ret, frame <span style="color:#f92672">=</span> vs<span style="color:#f92672">.</span>read()
</span></span><span style="display:flex;"><span>    vw <span style="color:#f92672">=</span> frame<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>    vh <span style="color:#f92672">=</span> frame<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;[INFO] è§†é¢‘å°ºå¯¸ï¼š</span><span style="color:#e6db74">{}</span><span style="color:#e6db74"> * </span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(vw, vh))
</span></span><span style="display:flex;"><span>    output_video <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>VideoWriter(<span style="color:#e6db74">&#34;./UI_rec/result/results.avi&#34;</span>, fourcc, <span style="color:#ae81ff">20.0</span>, (vw, vh))  <span style="color:#75715e"># å¤„ç†åçš„è§†é¢‘å¯¹è±¡</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># éå†è§†é¢‘å¸§è¿›è¡Œæ£€æµ‹</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># ä»è§†é¢‘æ–‡ä»¶ä¸­é€å¸§è¯»å–ç”»é¢</span>
</span></span><span style="display:flex;"><span>        (grabbed, image) <span style="color:#f92672">=</span> vs<span style="color:#f92672">.</span>read()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># è‹¥grabbedä¸ºç©ºï¼Œè¡¨ç¤ºè§†é¢‘åˆ°è¾¾æœ€åä¸€å¸§ï¼Œé€€å‡º</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> grabbed:
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34;[INFO] è¿è¡Œç»“æŸ...&#34;</span>)
</span></span><span style="display:flex;"><span>            output_video<span style="color:#f92672">.</span>release()
</span></span><span style="display:flex;"><span>            vs<span style="color:#f92672">.</span>release()
</span></span><span style="display:flex;"><span>            exit()
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># è·å–ç”»é¢é•¿å®½</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> W <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span> <span style="color:#f92672">or</span> H <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>            (H, W) <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>shape[:<span style="color:#ae81ff">2</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        image <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>resize(image, (<span style="color:#ae81ff">640</span>, <span style="color:#ae81ff">640</span>))
</span></span><span style="display:flex;"><span>        img0 <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>copy()
</span></span><span style="display:flex;"><span>        img <span style="color:#f92672">=</span> letterbox(img0, new_shape<span style="color:#f92672">=</span>imgsz)[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>        img <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>stack(img, <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>        img <span style="color:#f92672">=</span> img[:, :, ::<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>transpose(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>)  <span style="color:#75715e"># BGR to RGB, to 3x416x416</span>
</span></span><span style="display:flex;"><span>        img <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>ascontiguousarray(img)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        pred, useTime <span style="color:#f92672">=</span> predict(img)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        det <span style="color:#f92672">=</span> pred[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>        p, s, im0 <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>, <span style="color:#e6db74">&#39;&#39;</span>, img0
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> det <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span> <span style="color:#f92672">and</span> len(det):  <span style="color:#75715e"># å¦‚æœæœ‰æ£€æµ‹ä¿¡æ¯åˆ™è¿›å…¥</span>
</span></span><span style="display:flex;"><span>            det[:, :<span style="color:#ae81ff">4</span>] <span style="color:#f92672">=</span> scale_coords(img<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">1</span>:], det[:, :<span style="color:#ae81ff">4</span>], im0<span style="color:#f92672">.</span>shape)<span style="color:#f92672">.</span>round()  <span style="color:#75715e"># æŠŠå›¾åƒç¼©æ”¾è‡³im0çš„å°ºå¯¸</span>
</span></span><span style="display:flex;"><span>            number_i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>  <span style="color:#75715e"># ç±»åˆ«é¢„ç¼–å·</span>
</span></span><span style="display:flex;"><span>            detInfo <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> <span style="color:#f92672">*</span>xyxy, conf, cls <span style="color:#f92672">in</span> reversed(det):  <span style="color:#75715e"># éå†æ£€æµ‹ä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>                c1, c2 <span style="color:#f92672">=</span> (int(xyxy[<span style="color:#ae81ff">0</span>]), int(xyxy[<span style="color:#ae81ff">1</span>])), (int(xyxy[<span style="color:#ae81ff">2</span>]), int(xyxy[<span style="color:#ae81ff">3</span>]))
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># å°†æ£€æµ‹ä¿¡æ¯æ·»åŠ åˆ°å­—å…¸ä¸­</span>
</span></span><span style="display:flex;"><span>                detInfo<span style="color:#f92672">.</span>append([names[int(cls)], [c1[<span style="color:#ae81ff">0</span>], c1[<span style="color:#ae81ff">1</span>], c2[<span style="color:#ae81ff">0</span>], c2[<span style="color:#ae81ff">1</span>]], <span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%.2f</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> conf])
</span></span><span style="display:flex;"><span>                number_i <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>  <span style="color:#75715e"># ç¼–å·æ•°+1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                label <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74"> </span><span style="color:#e6db74">%.2f</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> (names[int(cls)], conf)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># ç”»å‡ºæ£€æµ‹åˆ°çš„ç›®æ ‡ç‰©</span>
</span></span><span style="display:flex;"><span>                plot_one_box(image, xyxy, label<span style="color:#f92672">=</span>label, color<span style="color:#f92672">=</span>colors[int(cls)])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># å®æ—¶æ˜¾ç¤ºæ£€æµ‹ç”»é¢</span>
</span></span><span style="display:flex;"><span>        cv2<span style="color:#f92672">.</span>imshow(<span style="color:#e6db74">&#39;Stream&#39;</span>, image)
</span></span><span style="display:flex;"><span>        image <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>resize(image, (vw, vh))
</span></span><span style="display:flex;"><span>        output_video<span style="color:#f92672">.</span>write(image)  <span style="color:#75715e"># ä¿å­˜æ ‡è®°åçš„è§†é¢‘</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> cv2<span style="color:#f92672">.</span>waitKey(<span style="color:#ae81ff">1</span>) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFF</span> <span style="color:#f92672">==</span> ord(<span style="color:#e6db74">&#39;q&#39;</span>):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># print(&#34;FPS:{}&#34;.format(int(0.6/(end-start))))</span>
</span></span><span style="display:flex;"><span>        frameIndex <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># if frameIndex &gt;= total:  # å¯è®¾ç½®æ£€æµ‹çš„æœ€å¤§å¸§æ•°æå‰é€€å‡º</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#     print(&#34;[INFO] è¿è¡Œç»“æŸ...&#34;)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#     output_video.release()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#     vs.release()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#     exit()</span>
</span></span></code></pre></div><p><a href="https://www.bilibili.com/video/BV1Lm421E7M2/?spm_id_from=333.999.0.0&amp;vd_source=237e295a40d7aaea043ead8c0d2c78ab">æ•ˆæœå‘ˆç°</a></p>
<h2 id="guiç•Œé¢">GUIç•Œé¢</h2>
<hr>
<p><strong>ä¸»æ§ç¨‹åºï¼š</strong></p>
<p><img src="https://bu.dusays.com/2024/04/23/6627b273e3d5f.jpeg" alt="6627b273e3d5f.jpeg"></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># -*- coding: utf-8 -*-</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># runMain.py</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> sys <span style="color:#f92672">import</span> argv, exit
</span></span><span style="display:flex;"><span><span style="color:#75715e">#è¿™è¡Œä»£ç ä»sysæ¨¡å—ä¸­å¯¼å…¥äº†ä¸¤ä¸ªå‡½æ•°ï¼šargvå’Œexitã€‚argvæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå‚æ•°çš„åˆ—è¡¨ï¼Œå½“ä»ç»ˆç«¯è¿è¡ŒPythonè„šæœ¬æ—¶ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªåˆ—è¡¨è®¿é—®è¿™äº›å‚æ•°ã€‚exitå‡½æ•°ç”¨äºé€€å‡ºPythonç¨‹åºã€‚</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> PyQt5.QtWidgets <span style="color:#f92672">import</span> QApplication
</span></span><span style="display:flex;"><span><span style="color:#75715e">#è¿™è¡Œä»£ç ä»PyQt5çš„QtWidgetsæ¨¡å—ä¸­å¯¼å…¥äº†QApplicationç±»ã€‚QApplicationç±»ç®¡ç†GUIåº”ç”¨ç¨‹åºçš„æ§åˆ¶æµå’Œä¸»è¦è®¾ç½®ï¼Œæ˜¯æ‰€æœ‰åŸºäºQtçš„GUIåº”ç”¨ç¨‹åºçš„èµ·ç‚¹ã€‚</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> bboxRecognition <span style="color:#f92672">import</span> bbox_MainWindow
</span></span><span style="display:flex;"><span><span style="color:#75715e">#è¿™è¡Œä»£ç ä»bboxRecognitionæ¨¡å—ï¼ˆå¯èƒ½æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰æ¨¡å—ï¼‰ä¸­å¯¼å…¥äº†ä¸€ä¸ªåä¸ºbbox_MainWindowçš„ç±»ã€‚è¿™ä¸ªç±»ç”¨äºè¯†åˆ«é»‘åŒ£å­ã€‚</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span><span style="color:#75715e">#è¿™è¡Œä»£ç æ£€æŸ¥æ˜¯å¦æ˜¯ç›´æ¥è¿è¡Œè¿™ä¸ªè„šæœ¬ï¼Œè€Œä¸æ˜¯ä½œä¸ºæ¨¡å—å¯¼å…¥åˆ°å…¶ä»–è„šæœ¬ä¸­ã€‚å¦‚æœæ˜¯ç›´æ¥è¿è¡Œï¼Œé‚£ä¹ˆä¸‹é¢çš„ä»£ç å—å°†è¢«æ‰§è¡Œ</span>
</span></span><span style="display:flex;"><span>    app <span style="color:#f92672">=</span> QApplication(argv)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#è¿™è¡Œä»£ç åˆ›å»ºäº†ä¸€ä¸ªQApplicationå®ä¾‹ï¼Œå®ƒæ˜¯ä»»ä½•PyQt5åº”ç”¨ç¨‹åºçš„å…¥å£ç‚¹ã€‚argvå‚æ•°ä¼ é€’ç»™QApplicationï¼Œè¿™æ ·å®ƒå°±å¯ä»¥å¤„ç†æ¥è‡ªå‘½ä»¤è¡Œçš„å‚æ•°ã€‚</span>
</span></span><span style="display:flex;"><span>    win <span style="color:#f92672">=</span> bbox_MainWindow()
</span></span><span style="display:flex;"><span><span style="color:#75715e">#è¿™è¡Œä»£ç åˆ›å»ºäº†box_MainWindowç±»çš„ä¸€ä¸ªå®ä¾‹ï¼Œè¿™ä¸ªå®ä¾‹å¾ˆå¯èƒ½æ˜¯åº”ç”¨ç¨‹åºçš„ä¸»çª—å£ã€‚</span>
</span></span><span style="display:flex;"><span>    win<span style="color:#f92672">.</span>showTime()
</span></span><span style="display:flex;"><span><span style="color:#75715e">#ä¸æ—¶é—´ç›¸å…³çš„åŠŸèƒ½ã€‚</span>
</span></span><span style="display:flex;"><span>    exit(app<span style="color:#f92672">.</span>exec_())
</span></span><span style="display:flex;"><span><span style="color:#75715e">#æœ€åï¼Œè¿™è¡Œä»£ç å¯åŠ¨äº†åº”ç”¨ç¨‹åºçš„ä¸»äº‹ä»¶å¾ªç¯ï¼Œé€šè¿‡è°ƒç”¨exec_()æ–¹æ³•ã€‚å½“äº‹ä»¶å¾ªç¯å¼€å§‹åï¼Œåº”ç”¨ç¨‹åºå°†ç­‰å¾…ç”¨æˆ·äº‹ä»¶å¹¶å“åº”ä»–ä»¬ã€‚exitå‡½æ•°ç¡®ä¿åº”ç”¨ç¨‹åºå¯ä»¥å¹²å‡€åœ°é€€å‡ºï¼Œè¿”å›ç å°†ä¼ é€’ç»™exitï¼Œä»¥ä¾¿æ“ä½œç³»ç»Ÿå¯ä»¥çŸ¥é“ç¨‹åºæ˜¯æ­£å¸¸é€€å‡ºè¿˜æ˜¯å‘ç”Ÿäº†é”™è¯¯ã€‚</span>
</span></span></code></pre></div><p><strong>ç®€è¦æ‘˜å½•æ ¸å¿ƒåŠŸèƒ½ä»£ç ï¼š</strong></p>
<p>1.å¯åŠ¨GUIç•Œé¢</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#è¿™æ®µä»£ç å®šä¹‰äº†ä¸€ä¸ªåä¸ºbbox_MainWindowçš„ç±»ï¼Œå®ƒç»§æ‰¿è‡ªQBeautyUIã€‚è¿™ä¸ªç±»æ˜¯ä¸€ä¸ªGUIçª—å£ï¼Œç”¨äºæŸç§ç›®æ ‡æ£€æµ‹æˆ–è€…è§†é¢‘å¤„ç†åº”ç”¨ç¨‹åºã€‚</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">bbox_MainWindow</span>(QBeautyUI):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#è¿™è¡Œä»£ç è°ƒç”¨çˆ¶ç±»QBeautyUIçš„æ„é€ å‡½æ•°ï¼Œç¡®ä¿ç»§æ‰¿çš„åŠŸèƒ½å¾—åˆ°æ­£ç¡®åˆå§‹åŒ–ã€‚</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self, <span style="color:#f92672">*</span>args, obj<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, <span style="color:#f92672">**</span>kwargs):
</span></span><span style="display:flex;"><span>        super(bbox_MainWindow, self)<span style="color:#f92672">.</span>__init__(<span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>setupUi(self)  <span style="color:#75715e"># ç•Œé¢ç”Ÿæˆ</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>retranslateUi(self)  <span style="color:#75715e"># ç•Œé¢æ§ä»¶</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#è¿™ä¸¤è¡Œä»£ç å¯èƒ½è°ƒç”¨äº†åœ¨QBeautyUIä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œç”¨äºåˆå§‹åŒ–å’Œè®¾ç½®ç”¨æˆ·ç•Œé¢ã€‚</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>setUiStyle(window_flag<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, transBack_flag<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)  <span style="color:#75715e"># è®¾ç½®ç•Œé¢æ ·å¼</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#è¿™è¡Œä»£ç è°ƒç”¨setUiStyleæ–¹æ³•æ¥è®¾ç½®çª—å£çš„æ ·å¼ï¼Œæ˜¯ä½¿çª—å£é€æ˜æˆ–è€…åº”ç”¨å…¶ä»–è§†è§‰æ•ˆæœã€‚</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>path <span style="color:#f92672">=</span> getcwd()
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>video_path <span style="color:#f92672">=</span> getcwd()
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#è¿™é‡Œè®¾ç½®äº†ä¸¤ä¸ªè·¯å¾„å˜é‡ï¼Œself.pathå’Œself.video_pathï¼Œå®ƒä»¬éƒ½è¢«åˆå§‹åŒ–ä¸ºå½“å‰å·¥ä½œç›®å½•çš„è·¯å¾„ã€‚</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>timer_camera <span style="color:#f92672">=</span> QtCore<span style="color:#f92672">.</span>QTimer()  <span style="color:#75715e"># å®šæ—¶å™¨</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>timer_video <span style="color:#f92672">=</span> QtCore<span style="color:#f92672">.</span>QTimer()  <span style="color:#75715e"># è§†é¢‘å®šæ—¶å™¨</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>flag_timer <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>  <span style="color:#75715e"># ç”¨äºæ ‡è®°æ­£åœ¨è¿›è¡Œçš„åŠŸèƒ½é¡¹ï¼ˆè§†é¢‘/æ‘„åƒï¼‰</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>LoadModel()  <span style="color:#75715e"># åŠ è½½é¢„è®­ç»ƒæ¨¡å‹</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>slot_init()  <span style="color:#75715e"># å®šä¹‰æ§½å‡½æ•°ï¼Œè¿™æ˜¯Qtä¸­ç”¨äºå¤„ç†ä¿¡å·å’Œæ§½æœºåˆ¶çš„å‡½æ•°ï¼Œç”¨äºå“åº”äº‹ä»¶ã€‚</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>files <span style="color:#f92672">=</span> []  <span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>cap_video <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>  <span style="color:#75715e"># è§†é¢‘æµå¯¹è±¡</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>CAM_NUM <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>  <span style="color:#75715e"># æ‘„åƒå¤´æ ‡å·</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>cap <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>VideoCapture(self<span style="color:#f92672">.</span>CAM_NUM)  <span style="color:#75715e"># å±å¹•ç”»é¢å¯¹è±¡</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#è¿™å‡ è¡Œä»£ç åˆå§‹åŒ–äº†ä¸€äº›å˜é‡ï¼ŒåŒ…æ‹¬ä¸€ä¸ªç©ºåˆ—è¡¨self.filesï¼Œä¸€ä¸ªç©ºçš„è§†é¢‘æµå¯¹è±¡self.cap_videoï¼Œä¸€ä¸ªæ‘„åƒå¤´ç¼–å·self.CAM_NUMï¼Œä»¥åŠä½¿ç”¨cv2.VideoCaptureåˆ›å»ºçš„æ‘„åƒå¤´è§†é¢‘æ•è·å¯¹è±¡self.capã€‚</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>detInfo <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>current_image <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>detected_image <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># self.dataset = None</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>  <span style="color:#75715e"># è¡¨æ ¼è¡Œæ•°ï¼Œç”¨äºè®°å½•è¯†åˆ«è¯†åˆ«æ¡ç›®</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>res_set <span style="color:#f92672">=</span> []  <span style="color:#75715e"># ç”¨äºå†å²ç»“æœè®°å½•çš„åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>c_video <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>count_name <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;é»‘åŒ£å­&#34;</span>]
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>count_table <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#è¿™ä¸€éƒ¨åˆ†åˆå§‹åŒ–äº†æ›´å¤šçš„å˜é‡ï¼ŒåŒ…æ‹¬ç”¨äºå­˜å‚¨æ£€æµ‹ä¿¡æ¯ã€å½“å‰å›¾åƒã€æ£€æµ‹åˆ°çš„å›¾åƒã€ç»“æœé›†å’Œå…¶ä»–ç›¸å…³æ•°æ®çš„åˆ—è¡¨å’Œå˜é‡ã€‚</span>
</span></span></code></pre></div><ol>
<li>è¯»å–é¢„è®­ç»ƒæ¨¡å‹</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">LoadModel</span>(self, model_path<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        è¯»å–é¢„è®­ç»ƒæ¨¡å‹
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        parser <span style="color:#f92672">=</span> argparse<span style="color:#f92672">.</span>ArgumentParser()
</span></span><span style="display:flex;"><span>        parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--weights&#39;</span>, nargs<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;+&#39;</span>, type<span style="color:#f92672">=</span>str, default<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;../weights/best.pt&#39;</span>,
</span></span><span style="display:flex;"><span>                            help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;model.pt path(s)&#39;</span>)  <span style="color:#75715e"># æ¨¡å‹è·¯å¾„ä»…æ”¯æŒ.ptæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>        parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--img-size&#39;</span>, type<span style="color:#f92672">=</span>int, default<span style="color:#f92672">=</span><span style="color:#ae81ff">480</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;inference size (pixels)&#39;</span>)  <span style="color:#75715e"># æ£€æµ‹å›¾åƒå¤§å°ï¼Œä»…æ”¯æŒ480</span>
</span></span><span style="display:flex;"><span>        parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--conf-thres&#39;</span>, type<span style="color:#f92672">=</span>float, default<span style="color:#f92672">=</span><span style="color:#ae81ff">0.25</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;object confidence threshold&#39;</span>)  <span style="color:#75715e"># ç½®ä¿¡åº¦é˜ˆå€¼</span>
</span></span><span style="display:flex;"><span>        parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--iou-thres&#39;</span>, type<span style="color:#f92672">=</span>float, default<span style="color:#f92672">=</span><span style="color:#ae81ff">0.45</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;IOU threshold for NMS&#39;</span>)  <span style="color:#75715e"># NMSé˜ˆå€¼</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># é€‰ä¸­è¿è¡Œæœºå™¨çš„GPUæˆ–è€…cpuï¼Œæœ‰GPUåˆ™GPUï¼Œæ²¡æœ‰åˆ™cpuï¼Œè‹¥æƒ³ä»…ä½¿ç”¨cpuï¼Œå¯ä»¥å¡«cpuå³å¯</span>
</span></span><span style="display:flex;"><span>        parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--device&#39;</span>, default<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;0&#39;</span>,
</span></span><span style="display:flex;"><span>                            help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;cuda device, i.e. 0 or 0,1,2,3 or cpu&#39;</span>)
</span></span><span style="display:flex;"><span>        parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--save-dir&#39;</span>, type<span style="color:#f92672">=</span>str, default<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;inference&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;directory to save results&#39;</span>)  <span style="color:#75715e"># æ–‡ä»¶ä¿å­˜è·¯å¾„</span>
</span></span><span style="display:flex;"><span>        parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--classes&#39;</span>, nargs<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;+&#39;</span>, type<span style="color:#f92672">=</span>int,
</span></span><span style="display:flex;"><span>                            help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;filter by class: --class 0, or --class 0 2 3&#39;</span>)  <span style="color:#75715e"># åˆ†å¼€ç±»åˆ«</span>
</span></span><span style="display:flex;"><span>        parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--agnostic-nms&#39;</span>, action<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;store_true&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;class-agnostic NMS&#39;</span>)  <span style="color:#75715e"># ä½¿ç”¨NMS</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>opt <span style="color:#f92672">=</span> parser<span style="color:#f92672">.</span>parse_args()  <span style="color:#75715e"># optå±€éƒ¨å˜é‡ï¼Œé‡è¦</span>
</span></span><span style="display:flex;"><span>        out, weight, imgsz <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>opt<span style="color:#f92672">.</span>save_dir, self<span style="color:#f92672">.</span>opt<span style="color:#f92672">.</span>weights, self<span style="color:#f92672">.</span>opt<span style="color:#f92672">.</span>img_size  <span style="color:#75715e"># å¾—åˆ°æ–‡ä»¶ä¿å­˜è·¯å¾„ï¼Œæ–‡ä»¶æƒé‡è·¯å¾„ï¼Œå›¾åƒå°ºå¯¸</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>device <span style="color:#f92672">=</span> select_device(self<span style="color:#f92672">.</span>opt<span style="color:#f92672">.</span>device)  <span style="color:#75715e"># æ£€éªŒè®¡ç®—å•å…ƒ,gpuè¿˜æ˜¯cpu</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>half <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>device<span style="color:#f92672">.</span>type <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;0&#39;</span>  <span style="color:#75715e"># å¦‚æœä½¿ç”¨gpuåˆ™è¿›è¡ŒåŠç²¾åº¦æ¨ç†</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> model_path:
</span></span><span style="display:flex;"><span>            weight <span style="color:#f92672">=</span> model_path
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>model <span style="color:#f92672">=</span> attempt_load(weight, map_location<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>device)  <span style="color:#75715e"># è¯»å–æ¨¡å‹</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>imgsz <span style="color:#f92672">=</span> check_img_size(imgsz, s<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>model<span style="color:#f92672">.</span>stride<span style="color:#f92672">.</span>max())  <span style="color:#75715e"># æ£€æŸ¥å›¾åƒå°ºå¯¸</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>half:  <span style="color:#75715e"># å¦‚æœæ˜¯åŠç²¾åº¦æ¨ç†</span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>model<span style="color:#f92672">.</span>half()  <span style="color:#75715e"># è½¬æ¢æ¨¡å‹çš„æ ¼å¼</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>names <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>model<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>names <span style="color:#66d9ef">if</span> hasattr(self<span style="color:#f92672">.</span>model, <span style="color:#e6db74">&#39;module&#39;</span>) <span style="color:#66d9ef">else</span> self<span style="color:#f92672">.</span>model<span style="color:#f92672">.</span>names  <span style="color:#75715e"># å¾—åˆ°æ¨¡å‹è®­ç»ƒçš„ç±»åˆ«å</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    è¿™æ®µä»£ç å®šä¹‰äº†ä¸€ä¸ªåä¸º `LoadModel` çš„æ–¹æ³•ï¼Œå®ƒç”¨äºåŠ è½½é¢„è®­ç»ƒçš„æœºå™¨å­¦ä¹ æ¨¡å‹ï¼Œå¹¶å¯¹æ¨¡å‹è¿›è¡Œä¸€äº›åˆå§‹åŒ–è®¾ç½®ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯ç”¨äºæ·±åº¦å­¦ä¹ æ¨¡å‹çš„æ¨ç†ï¼ˆinferenceï¼‰çš„å‡†å¤‡å·¥ä½œã€‚å…·ä½“æ¥çœ‹ï¼Œæ–¹æ³•çš„åŠŸèƒ½åŒ…æ‹¬ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">1. **å‚æ•°è§£æ**ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   ä½¿ç”¨ `argparse` åº“æ¥è§£æå‘½ä»¤è¡Œå‚æ•°ã€‚è¿™äº›å‚æ•°åŒ…æ‹¬æ¨¡å‹æƒé‡æ–‡ä»¶çš„è·¯å¾„ã€è¾“å…¥å›¾åƒçš„å¤§å°ã€ç½®ä¿¡åº¦é˜ˆå€¼ã€IOUé˜ˆå€¼ã€è®¡ç®—è®¾å¤‡ï¼ˆCPUæˆ–GPUï¼‰ã€ç»“æœä¿å­˜ç›®å½•ã€ç±»åˆ«è¿‡æ»¤ä»¥åŠæ˜¯å¦ä½¿ç”¨ç±»åˆ«æ— å…³çš„éæå¤§å€¼æŠ‘åˆ¶ï¼ˆNMSï¼‰ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">2. **è®¾ç½®é»˜è®¤å‚æ•°**ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   å¦‚æœåœ¨è°ƒç”¨æ–¹æ³•æ—¶æ²¡æœ‰æŒ‡å®š `model_path`ï¼Œå®ƒä¼šä½¿ç”¨é»˜è®¤çš„å‚æ•°è®¾ç½®ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">3. **é€‰æ‹©è®¡ç®—è®¾å¤‡**ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   ä½¿ç”¨ `select_device` å‡½æ•°ï¼ˆè¿™ä¸ªå‡½æ•°åœ¨ä»£ç ä¸­æ²¡æœ‰ç»™å‡ºï¼Œä½†å¯ä»¥æ¨æ–­å®ƒçš„åŠŸèƒ½æ˜¯é€‰æ‹©ä½¿ç”¨CPUè¿˜æ˜¯GPUè¿›è¡Œè®¡ç®—ï¼‰ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">4. **æ¨¡å‹åŠ è½½**ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   ä½¿ç”¨ `attempt_load` å‡½æ•°åŠ è½½æ¨¡å‹ï¼Œè¿™ä¸ªå‡½æ•°å¯èƒ½æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰å‡½æ•°æˆ–è€…æ¥è‡ªæŸä¸ªåº“ï¼Œç”¨äºåŠ è½½æ¨¡å‹å¹¶å°†å…¶æ˜ å°„åˆ°æŒ‡å®šçš„è®¡ç®—è®¾å¤‡ä¸Šã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">5. **å›¾åƒå°ºå¯¸æ£€æŸ¥**ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   ä½¿ç”¨ `check_img_size` å‡½æ•°ç¡®ä¿è¾“å…¥å›¾åƒçš„å°ºå¯¸ä¸æ¨¡å‹çš„æ­¥é•¿å…¼å®¹ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">6. **åŠç²¾åº¦æ¨ç†**ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   å¦‚æœè®¡ç®—è®¾å¤‡æ˜¯GPUï¼Œåˆ™å°†æ¨¡å‹è½¬æ¢ä¸ºåŠç²¾åº¦ï¼ˆfloat16ï¼‰ï¼Œè¿™æ ·å¯ä»¥åŠ å¿«æ¨ç†é€Ÿåº¦å¹¶å‡å°‘å†…å­˜ä½¿ç”¨ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">7. **ç±»åˆ«åç§°å¤„ç†**ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   è·å–æ¨¡å‹è®­ç»ƒæ—¶çš„ç±»åˆ«åç§°ï¼Œå¹¶ä¸”å¦‚æœè¿™äº›åç§°åœ¨ `Chinese_name` å­—å…¸ä¸­æœ‰å¯¹åº”çš„ä¸­æ–‡åç§°ï¼Œå°±æ›¿æ¢ä¸ºä¸­æ–‡åç§°ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">8. **é¢œè‰²åˆ†é…**ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   ä¸ºæ¯ä¸ªç±»åˆ«åˆ†é…ä¸€ä¸ªé¢œè‰²ï¼Œè¿™é€šå¸¸ç”¨äºåœ¨å›¾åƒä¸Šç»˜åˆ¶æ£€æµ‹ç»“æœã€‚å¦‚æœç±»åˆ«çš„æ•°é‡æ²¡æœ‰è¶…è¿‡é¢„å®šä¹‰çš„é¢œè‰²åˆ—è¡¨ `color`ï¼Œå®ƒä¼šä½¿ç”¨è¿™äº›é¢œè‰²ï¼›å¦åˆ™ï¼Œä¼šéšæœºç”Ÿæˆé¢œè‰²ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">9. **é¢„æ¨ç†**ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   åˆ›å»ºä¸€ä¸ªé›¶å›¾åƒå¼ é‡ï¼Œå¹¶é€šè¿‡æ¨¡å‹è¿›è¡Œä¸€æ¬¡å‰å‘ä¼ é€’ï¼Œè¿™é€šå¸¸æ˜¯ä¸ºäº†è®©æ¨¡å‹åœ¨å®é™…æ¨ç†ä¹‹å‰â€œçƒ­èº«â€ï¼Œç¡®ä¿CUDAæ ¸å¿ƒå·²ç»åŠ è½½ï¼Œä»è€Œåœ¨åç»­çš„æ¨ç†ä¸­èƒ½å¤Ÿæ›´å¿«ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">è¿™ä¸ªæ–¹æ³•æ˜¯æ·±åº¦å­¦ä¹ æ¨¡å‹éƒ¨ç½²çš„å¸¸è§æ­¥éª¤çš„é›†åˆï¼Œç”¨äºå‡†å¤‡æ¨¡å‹è¿›è¡Œåç»­çš„å›¾åƒå¤„ç†å’Œå¯¹è±¡æ£€æµ‹ä»»åŠ¡ã€‚ä»£ç ä¸­æåˆ°çš„ä¸€äº›å‡½æ•°å’Œå˜é‡ï¼ˆå¦‚ `select_device`, `attempt_load`, `check_img_size`, `Chinese_name`ï¼‰æ²¡æœ‰åœ¨è¿™æ®µä»£ç ä¸­å®šä¹‰ï¼Œæ‰€ä»¥å®ƒä»¬çš„å…·ä½“å®ç°ç»†èŠ‚æ˜¯æœªçŸ¥çš„ï¼Œä½†ä»ä¸Šä¸‹æ–‡ä¸­å¯ä»¥æ¨æµ‹å®ƒä»¬çš„å¤§è‡´åŠŸèƒ½ã€‚
</span></span></span></code></pre></div><p>3.èåˆæ£€æµ‹ç¨‹åº-å¦‚ä¸Šé¢æ‰€å‘ˆç°</p>
<h2 id="åç»­å¤šæ¨¡æ€çš„èåˆ">åç»­å¤šæ¨¡æ€çš„èåˆ</h2>
<hr>
<p>åç»­å®ŒæˆåŸºç¡€å¯è§å…‰æ¡ä»¶çš„è®­ç»ƒä¹‹åï¼Œè¿˜è¦å°è¯•è¿›è¡Œå¤šå…‰è°±çš„èåˆï¼Œæé«˜æ¨¡å‹çš„ç²¾ç¡®åº¦ã€‚</p>
<h1 id="20240413-ä¼šè®®çºªè¦">20240413 ä¼šè®®çºªè¦</h1>
<hr>
<ul>
<li>æ˜ç¡®å¯æ£€æµ‹çš„å›¾ç‰‡ï¼Œè¿›è¡Œç•Œé™çš„åŒºåˆ†ï¼›</li>
<li>åœ¨å¯è§å…‰æ¡ä»¶ä¸‹ï¼Œç•Œå®šé®æŒ¡æ¯”ä¾‹</li>
<li>é»‘åŒ£å­å‡ºç°æç«¯ä½ç½®ï¼ˆä¾‹å¦‚å‚ç›´æ”¾ç½®æƒ…å†µä¸‹ï¼‰ï¼Œè¯†åˆ«çµæ•åº¦çš„æ§åˆ¶</li>
<li>æ¼æ£€ç‡ä¸èƒ½ä½äº5%</li>
<li>æé«˜éªŒè¯é›†çš„æ•°é‡ï¼Œè¦æœ‰ç»Ÿè®¡ç»“æœï¼Œé…åˆå¯¼å‡ºæ£€æµ‹ç»“æœ</li>
<li>æ›´æ”¹GUIç•Œé¢çš„é…è‰²</li>
<li>ä½¿ç”¨å¤šå…‰è°±ç½‘ç»œæ¨¡å‹</li>
<li>é¢„è®¡äº”æœˆåˆå¼€å§‹è®ºæ–‡çš„æ’°å†™</li>
</ul>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<hr>
<p>è¿™ç¯‡æ–‡ç« éšè¿›åº¦æ›´æ–°ï¼Œç”¨äºè®°å½•åœ¨æ¯•è®¾è¿‡ç¨‹ä¸­é‡åˆ°çš„å¿ƒå¾—å’Œé—®é¢˜ã€‚</p>

</content>
<p>
  
  <a href="https://hugo.matrixcore.life/blog/%E5%AE%9E%E7%94%A8%E6%95%99%E7%A8%8B/">#å®ç”¨æ•™ç¨‹</a>
  
</p>

  </main>
  <footer>Made with <a href="https://github.com/janraasch/hugo-bearblog/">Hugo Ê•â€¢á´¥â€¢Ê” Bear</a>
</footer>

    
</body>

</html>
