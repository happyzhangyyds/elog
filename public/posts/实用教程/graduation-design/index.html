<!DOCTYPE html>
<html lang="zh-CN"><head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta name="description" content="[毕业设计] 基于Yolo的航拍图像黑匣子检测算法设计 - https://hugo.matrixcore.life/posts/%E5%AE%9E%E7%94%A8%E6%95%99%E7%A8%8B/graduation-design/">
    <meta name="author" content="MatrixCore - https://hugo.matrixcore.life/">
    
    <meta name="msvalidate.01" content="B46311949B856F2A7015F366FB3CE878" />
    <title>[毕业设计] 基于Yolo的航拍图像黑匣子检测算法设计</title>
    <link rel="icon" type="image/png" href="/favicon.ico">
    
    <link rel="stylesheet" href="https://hugo.matrixcore.life/style.min.d252ad53a5e6b2ae6b8c6c1661107189be3668e36c8dd61697bbe008595a7e04.css">
    
    <script type="text/javascript" src="/main.js" defer></script>
    
</head>
<body class="active-animate ">
        <div id="header"><div class="container-header">
    <div id="vars" class="container-vars" style="display: none;">
	{
		"isSingleColumnOfPostList": true,
		"hasFoldAllCodeBlocks": false,
		"svgColor": "",
		"en": false,
		"dark": true
	}
</div>
    <h1 class="title">
        
            [毕业设计] 基于Yolo的航拍图像黑匣子检测算法设计
            
        
    </h1>

    <div class="container-breadcrumb-nav">
    
    <div class="breadcrumb-nav-bar">
        <div><a href="/"><svg t="1656411084410" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2954" width="16" height="16"><path d="M947.5 390.6l-377-290c-34.5-26.5-82.6-26.5-117.1 0l-377 290c-14 10.8-16.6 30.9-5.9 44.9 10.8 14 30.9 16.6 44.9 5.9l28.5-21.9V768c0 88.2 71.8 160 160 160h80c35.3 0 64-28.7 64-64V640c0-17.6 14.4-32 32-32h64c17.6 0 32 14.4 32 32v224c0 35.3 28.7 64 64 64h80c88.2 0 160-71.8 160-160V419.4l28.5 21.9c5.8 4.5 12.7 6.6 19.5 6.6 9.6 0 19.1-4.3 25.4-12.5 10.8-13.9 8.2-34-5.8-44.8zM816 768c0 52.9-43.1 96-96 96h-80V640c0-52.9-43.1-96-96-96h-64c-52.9 0-96 43.1-96 96v224h-80c-52.9 0-96-43.1-96-96V370.2l284.5-218.8c11.5-8.8 27.5-8.8 39 0L816 370.2V768z" fill="#6c757d" p-id="2955"></path></svg></a></div>
        <div><a href="/nav"><svg t="1656411531924" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5827" width="16" height="16"><path d="M849.59197473 125.23018519L139.22930586 391.72854662a23.35052669 23.35052669 0 0 0-14.95414244 21.65490745c-0.12257519 9.70384955 5.61801843 18.46795771 14.40255493 22.04306141l318.42928099 129.25528056 119.51057092 320.39047893c3.06437293 8.23295069 10.35758221 13.89182751 18.7335381 14.87242563l2.7170774 0.14300521a22.79893918 22.79893918 0 0 0 21.20546682-15.36272638l259.51158924-729.54564933a23.8612558 23.8612558 0 0 0-5.31158128-24.55584682 22.3290685 22.3290685 0 0 0-23.9021142-5.43415649zM793.65694081 211.64552314l-196.63064161 552.75171747-91.91077952-246.37564122-253.62799211-102.96295445 542.16941324-203.4131218z" p-id="5828" fill="#6c757d"></path></svg></a></div>
        <div><a href="/search"><svg t="1656411627509" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1730" width="14" height="14"><path d="M469.333333 85.333333c211.968 0 384 172.032 384 384s-172.032 384-384 384-384-172.032-384-384 172.032-384 384-384z m0 682.666667c164.992 0 298.666667-133.674667 298.666667-298.666667 0-165.034667-133.674667-298.666667-298.666667-298.666666-165.034667 0-298.666667 133.632-298.666666 298.666666 0 164.992 133.632 298.666667 298.666666 298.666667z m362.026667 3.029333l120.704 120.661334-60.373333 60.373333-120.661334-120.704 60.330667-60.330667z" p-id="1731" fill="#6c757d"></path></svg></a></div>
        <div><a href="/posts"><svg t="1656411724198" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5655" width="12" height="12"><path d="M811.705761 1024H212.294239c-93.1199 0-174.823046-87.570975-174.823046-187.387854V162.322018C37.471193 69.776145 112.604921 0 212.294239 0H596.190595l7.015883 5.93161c111.74388 95.479788 185.857116 170.741078 279.614824 266.093304 29.65805 30.040735 61.165743 62.122454 96.436499 97.393211l7.271006 7.334787v459.859234c-0.063781 99.816879-81.703145 187.387854-174.823046 187.387854zM212.294239 49.94033c-72.391155 0-124.882716 47.261538-124.882716 112.381688v674.290128c0 71.94469 59.507443 137.383743 124.882716 137.383743h599.411522c65.311492 0 124.882716-65.439053 124.882716-137.383743V397.417876c-32.528184-32.464404-61.73977-62.250016-89.356836-90.377328-90.951355-92.418312-163.278729-165.957521-269.601245-257.163999H212.294239z" fill="#6c757d" p-id="5656"></path><path d="M936.588477 449.526752h-212.326129c-99.753099 0-187.324073-81.703145-187.324073-174.823046V49.94033a25.002055 25.002055 0 0 1 49.94033 0v224.763376c0 65.311492 65.502834 124.882716 137.383743 124.882716h212.326129a25.002055 25.002055 0 1 1 0 49.94033z" fill="#6c757d" p-id="5657"></path></svg></a></div>
        <div><a href="/archive"><svg t="1656411795742" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7334" width="12" height="12"><path d="M884.224 522.24H504.32V141.824c0-16.896-13.824-30.72-30.72-30.72-120.32 0-233.472 47.616-317.952 134.144S26.112 445.952 29.184 566.784c2.56 114.688 49.152 222.72 131.072 304.128 81.92 81.408 189.952 128 304.64 130.56h10.24c117.76 0 227.84-45.568 312.32-128.512 86.528-85.504 133.632-199.68 132.608-321.024-0.512-2.048-1.536-29.696-35.84-29.696z m-140.288 307.712c-74.752 73.728-173.056 112.64-277.504 110.592-205.824-4.608-370.688-169.472-375.296-374.784-3.072-104.448 35.84-202.752 108.544-277.504 65.536-67.072 151.552-107.52 243.712-114.688v378.88c0 16.896 13.824 30.72 30.72 30.72 129.024 0 311.296 0 382.976 0.512-6.144 93.184-46.08 179.712-113.152 246.272z" fill="#6c757d" p-id="7335"></path><path d="M603.136 11.264c-8.192-0.512-15.872 3.072-22.016 8.704-5.632 5.632-9.216 13.824-9.216 22.016v378.88c0 16.896 13.824 30.72 30.72 30.72h378.88c16.896 0 30.72-13.824 30.72-30.72 0-223.744-183.808-407.552-409.088-409.6z m30.208 378.88V74.24c167.424 16.384 301.056 150.016 315.904 315.904h-315.904z" fill="#6c757d" p-id="7336"></path></svg></a></div>
        <div id="light-dark" style="cursor: pointer;"><a><svg t="1656411842215" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5086" width="12" height="12"><path d="M1007.492874 384.513055c-8.795694-34.58307-21.189627-67.666874-36.682043-99.05151-2.698679-5.397358-10.894667-3.498287-10.894666 2.598728v0.299853c0 32.484098-6.896624 63.868734-19.890263 92.554691-10.694764 23.488501-25.487523 45.077933-43.978471 64.068635-41.779547 42.679107-99.05151 66.967217-158.722299 67.26707-61.869712 0.299853-119.941284-24.188159-162.920244-68.966238-40.280281-41.979449-62.56937-98.251902-62.269516-156.323473 0.399804-59.270984 23.588452-114.94373 65.567901-156.823229 19.59041-19.59041 42.179351-35.082826 66.667364-46.077443C672.956643 71.166451 704.041426 64.469729 736.125719 64.469729h1.299364c6.097015 0 8.096037-8.096037 2.598728-10.794715C708.739126 37.982696 675.655322 25.488812 641.172203 16.493216 599.492607 5.598549 555.714038-0.098662 510.536154 0.001289 222.37722 0.700947-7.41029 237.38508 0.185992 525.444064c7.096526 271.667008 225.889418 490.559851 497.456474 497.856279 287.559228 7.796183 524.14341-220.891864 525.842579-508.551044 0.299853-44.977981-5.297407-88.656599-15.992171-130.236244z m-83.15929 301.552378c-22.588942 53.27392-54.873137 101.250434-95.953027 142.330323-41.179841 41.179841-89.056403 73.464036-142.330324 95.953027-55.172991 23.288599-113.744317 35.182777-174.314666 35.182777s-119.141675-11.794226-174.314666-35.182777c-53.27392-22.588942-101.250434-54.873137-142.330323-95.953027-41.179841-41.179841-73.464036-89.056403-95.953027-142.330323C75.749001 630.892442 63.954774 572.221164 63.954774 511.750767s11.794226-119.141675 35.182777-174.314666c22.588942-53.27392 54.873137-101.250434 95.953027-142.330323 41.179841-41.179841 89.056403-73.464036 142.330323-95.953027C392.593892 75.7642 451.26517 63.969974 511.735567 63.969974c13.99315 0 27.886348 0.599706 41.679596 1.89907C489.246577 118.643209 448.266638 198.704016 448.266638 288.360126c0 159.022152 128.836929 287.859081 287.859081 287.859081 89.156354 0 168.817357-40.580134 221.691473-104.149015 1.099462 13.09359 1.699168 26.387082 1.699168 39.680575 0 60.470397-11.794226 119.141675-35.182776 174.314666z" p-id="5087" fill="#6c757d"></path></svg></a></div>
        
    </div>

    
</div>

            <div id="toc">📜</div>
        
    
    
</div>
</div>
        <div id="content">















<div class="container-main 
     container-page 
">

    <div class="desc">
        
        <span>
            
            <svg t="1656736000388" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7409" width="12" height="12"><path d="M524.885333 338.986667L200.362667 663.466667c-17.28 15.274667-27.989333 36.693333-29.696 56.234666v133.76l130.730666 0.085334c22.784-1.621333 43.989333-12.245333 61.013334-31.701334l322.688-322.645333-160.213334-160.213333z m60.373334-60.330667l160.170666 160.213333 102.144-102.144a19.712 19.712 0 0 0 0-27.861333L715.093333 176.426667a19.456 19.456 0 0 0-27.605333 0L585.258667 278.613333zM701.312 85.333333c27.946667 0 54.741333 11.136 74.282667 30.848l132.309333 132.309334a105.045333 105.045333 0 0 1 0 148.565333L424.874667 879.957333c-29.824 34.346667-72.106667 55.466667-120.448 58.794667H85.333333v-42.666667l0.128-179.84c3.626667-44.970667 24.576-86.826667 56.448-114.944l485.12-485.034666A104.789333 104.789333 0 0 1 701.269333 85.333333z" p-id="7410" fill="#adb5bd"></path></svg>
            2024-03-01&nbsp;
        </span>
        <span>
            
            <svg t="1656737270708" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="23838" width="11" height="11"><path d="M824.264 95.36c0-23.859 25.043-44.16 48.902-44.16s49.714 20.301 49.714 44.16v190.08c0 23.859-19.054 52.868-42.913 52.868h-190.08c-23.859 0-46.696-25.96-46.696-49.819s22.55-46.249 46.409-46.249h82.025C702.344 175.534 610.22 155.853 512 155.853c-206.775 0-360.398 149.372-360.398 356.147 0 206.775 153.623 358.23 360.398 358.23 206.775 0 357.467-151.455 357.467-358.23 0-23.859 23.634-50.706 53.413-50.706 29.78 0 49.92 26.847 49.92 50.706 0 254.493-206.307 460.8-460.8 460.8-254.493 0-460.8-206.307-460.8-460.8C51.2 257.507 257.507 51.2 512 51.2c122.4 0 226.684 33.296 312.264 117.369 0.358 0.351 0.358-24.052 0-73.209z" p-id="23839" fill="#adb5bd"></path></svg>
            2024-03-01&nbsp;&nbsp;&nbsp;
        </span>
        <span>
            
            <svg t="1656737548689" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="33866" width="12" height="12"><path d="M832.038608 64.662657H192.030028C121.255125 64.662657 63.940169 121.98845 63.940169 192.694717v446.793671C63.940169 710.205493 121.255125 767.643272 192.030028 767.643272h133.353183a63.940169 63.940169 0 0 1 55.219742 31.576328l76.099638 129.83828c12.358154 21.093031 33.790754 31.626903 55.216129 31.626903s42.832688-10.544709 55.198067-31.619678l76.222461-129.870792a63.940169 63.940169 0 0 1 55.212517-31.551041h133.54103c70.576219 0 127.732228-57.289669 127.732227-127.800865V192.391272C959.825022 121.85479 902.643727 64.662657 832.038608 64.662657zM895.884854 639.842407A63.85347 63.85347 0 0 1 832.092795 703.703103h-133.54103a127.753903 127.753903 0 0 0-110.349172 63.09847l-76.222461 129.856342a0.274545 0.274545 0 0 1 0-0.050574h-0.032512s-0.021675 0.061411-0.032512 0.061412l-76.1466-129.85273A127.804477 127.804477 0 0 0 325.383211 703.703103H192.030028A64.207489 64.207489 0 0 1 127.880338 639.488388V192.694717A64.102729 64.102729 0 0 1 192.030028 128.602826h640.00858A63.799284 63.799284 0 0 1 895.884854 192.391272v447.451135z" fill="#adb5bd" p-id="33867"></path><path d="M608.154093 288.092004A31.970084 31.970084 0 0 0 576.184009 320.062089v160.078006l-134.650049-179.278119A31.970084 31.970084 0 0 0 384.002258 320.062089v255.760676a31.970084 31.970084 0 0 0 63.940169 0v-159.958796l134.650048 179.274507a31.970084 31.970084 0 0 0 57.531703-19.200113V320.062089a31.970084 31.970084 0 0 0-31.970085-31.970085z" fill="#adb5bd" p-id="33868"></path></svg>
            12006 字</span>&nbsp;
        <span>
            
            <svg t="1656737462334" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="32892" width="12" height="12"><path d="M512 74.666667C270.933333 74.666667 74.666667 270.933333 74.666667 512S270.933333 949.333333 512 949.333333 949.333333 753.066667 949.333333 512 753.066667 74.666667 512 74.666667z m0 810.666666c-204.8 0-373.333333-168.533333-373.333333-373.333333S307.2 138.666667 512 138.666667 885.333333 307.2 885.333333 512 716.8 885.333333 512 885.333333z" p-id="32893" fill="#adb5bd"></path><path d="M695.466667 567.466667l-151.466667-70.4V277.333333c0-17.066667-14.933333-32-32-32s-32 14.933333-32 32v238.933334c0 12.8 6.4 23.466667 19.2 29.866666l170.666667 81.066667c4.266667 2.133333 8.533333 2.133333 12.8 2.133333 12.8 0 23.466667-6.4 29.866666-19.2 6.4-14.933333 0-34.133333-17.066666-42.666666z" p-id="32894" fill="#adb5bd"></path></svg>
            24 分钟</span>
            <div class="container-ctgtag">
	<div class="taxonomy">
		
		<div class="ctg">
			
			
		</div>
		<div class="tag">
			
			 - 
			
			<a href="/tags/%E5%AE%9E%E7%94%A8%E6%95%99%E7%A8%8B">实用教程</a>
			
		</div>
	</div>
</div>
        
    </div>
    
    <div class="toc">
        
        <div class="page-operation">
            <div><a href="#"><img src="/imgs/icons/arrow-up-circle.svg" alt=""></a></div>
            <div><a href="https://hugo.matrixcore.life/posts/%E6%83%85%E7%BB%AA%E8%A1%A8%E8%BE%BE/240309/"><img src="/imgs/icons/arrow-left-circle.svg" alt=""></a></div>
            <div><a href="https://hugo.matrixcore.life/posts/%E5%AF%B9%E8%AF%9D%E6%9C%AA%E6%9D%A5/note/"><img src="/imgs/icons/arrow-right-circle.svg" alt=""></a></div>
        </div>
        
        <nav id="TableOfContents">
  <ul>
    <li><a href="#word-中-mathtype-公式偏上浮或偏下沉怎么办"><strong>word 中 mathtype 公式偏上浮或偏下沉怎么办</strong></a></li>
    <li><a href="#如何使用图片转-latex">如何使用图片转 latex</a></li>
    <li><a href="#关于语病的修改">关于语病的修改</a>
      <ul>
        <li><a href="#一主语残缺">一、主语残缺</a></li>
        <li><a href="#二谓语残缺">二、谓语残缺</a></li>
        <li><a href="#三宾语残缺">三、宾语残缺</a></li>
        <li><a href="#四虚词残缺">四、虚词残缺</a></li>
      </ul>
    </li>
    <li><a href="#搭建-yolov5-环境">搭建 yolov5 环境</a></li>
    <li><a href="#数据集的预处理">数据集的预处理</a></li>
    <li><a href="#验证集">验证集</a></li>
    <li><a href="#扩充训练集">扩充训练集</a>
      <ul>
        <li><a href="#数据增强的概念和作用">数据增强的概念和作用</a></li>
        <li><a href="#常见的数据增强的办法">常见的数据增强的办法</a></li>
        <li><a href="#txt-转-xml">txt 转 xml</a></li>
        <li><a href="#数据集扩充">数据集扩充</a></li>
      </ul>
    </li>
    <li><a href="#autodl-训练效果">Autodl 训练效果</a></li>
    <li><a href="#测试模块的编写">测试模块的编写</a></li>
    <li><a href="#gui-界面">GUI 界面</a></li>
    <li><a href="#后续多模态的融合">后续多模态的融合</a></li>
  </ul>
</nav>
    </div>

    <div class='content  content '>
        <h1 id="前言">前言</h1>
<hr>
<blockquote>
<p>💡 首先需要感谢学校为我们提供的一个良好的学习平台，让我们通过毕设来了解项目开发的流程，并通过标准化的书写来规范格式。感谢罗老师的耐心指导和帮助，在实际毕设的写作过程中，关注着我们的每一个节点。<br>
同时需要感谢公司<a href="http://www.andawell.com/">Andawell</a>的支持，能为我提供在公司边实习边做毕设的机会。同时能将毕设与项目开发的标准更好地结合。<br>
最后还需要鼓励自己，因为需要付出很多的努力。</p>
</blockquote>
<h1 id="正文">正文</h1>
<hr>
<p>一方面主要是技术上的要求，一方面主要是论文上的排版。然后希望我遇到的问题，也能帮到大家。</p>
<h2 id="word-中-mathtype-公式偏上浮或偏下沉怎么办"><strong>word 中 mathtype 公式偏上浮或偏下沉怎么办</strong></h2>
<hr>
<p>刚才遇到了公式上浮的问题，我使用的是 amath 进行公式的编写，搭配图片转 latex 进行调整。然后找到了这个问题的解决办法。感谢 whu 数码君提供的<a href="https://jingyan.baidu.com/article/09ea3edef9845480aede39a5.html">回答</a>。</p>
<h2 id="如何使用图片转-latex">如何使用图片转 latex</h2>
<hr>
<p>之前有同学问过我这个问题，我今天也再一次遇到了这个问题，看到论文中复杂的公式，一筹莫展怎么办，可以通过图片转 latex 的方式，这是我比较常用的方式，但是现在主流的转 latex 的好的软件不多，在此特别感谢<a href="https://simpletex.cn/ai/latex_ocr">simpletex</a>提供的支持。</p>
<h2 id="关于语病的修改">关于语病的修改</h2>
<hr>
<p>感谢 up 主：<a href="https://space.bilibili.com/26021795">用镜头记录成长</a>，参考<a href="https://www.bilibili.com/video/BV1PB4y1U7JU/?buvid=XYA9A96A2DBF2E51A918ECE55EFA494C98935&amp;is_story_h5=false&amp;mid=nPIoZdTfuXw2Qtcat9xxZw%3D%3D&amp;p=1&amp;plat_id=114&amp;share_from=ugc&amp;share_medium=android&amp;share_plat=android&amp;share_session_id=e1117509-5d59-4fd0-b122-21d23e500899&amp;share_source=WEIXIN&amp;share_tag=s_i&amp;timestamp=1693714483&amp;unique_k=HFqrbnI&amp;up_id=26021795&amp;share_times=1&amp;vd_source=237e295a40d7aaea043ead8c0d2c78ab">论文写作表达语句表达系列课程 一 病句修改 成分残缺_哔哩哔哩_bilibili</a>该视频进行总结。</p>
<details>
  <summary>以下内容是对该视频进行的笔记梳理。</summary>
<h3 id="一主语残缺">一、主语残缺</h3>
<hr>
<ul>
<li><strong>滥用介词</strong></li>
</ul>
<blockquote>
<p>从这件小事，说明一个道理</p>
</blockquote>
<p>应改为，这件小事说明一个道理。上述例子中缺少主语。</p>
<blockquote>
<p>当学生了解了美是什么，就会以美的标准米规范自己的行为和思想。</p>
</blockquote>
<p>应去除“当”字。</p>
<ul>
<li><strong>滥用使令动词</strong></li>
</ul>
<blockquote>
<p>通过这件小事，使我明白了一个道理。</p>
</blockquote>
<p>去除”通过“二字。</p>
<blockquote>
<p>通过对该课题的研究，得出新时代精神的含义。</p>
</blockquote>
<p>需添加主语，例如“笔者得出……”<strong>(另外还需要尽量避免在论文中使用“我”字)</strong></p>
<ul>
<li><strong>偏正短语缺中心语</strong></li>
</ul>
<blockquote>
<p>课堂教学低效，一直未得到解决。</p>
</blockquote>
<p>需在”低效“后面加上”的问题“</p>
<blockquote>
<p>我对经济与生活这本教材感到困感。</p>
</blockquote>
<p>需在“教材”后面加上“的内容”</p>
<ul>
<li><strong>滥用省略</strong></li>
</ul>
<blockquote>
<p>在经历了几千年的封建统治后，人们又开始重视被禁锯的古典文化，并成为人文主义者的武器，用米反对神权。</p>
</blockquote>
<p>应改为”古典文化并成为人文主义者的武器“</p>
<ul>
<li><strong>助词用错</strong></li>
</ul>
<blockquote>
<p>2022 年颁布了《家庭教育指导法》，是我国首部家庭教育法。</p>
</blockquote>
<p>把“了”改成“的”</p>
<h3 id="二谓语残缺">二、谓语残缺</h3>
<hr>
<ul>
<li><strong>句首缺谓另起头</strong></li>
</ul>
<blockquote>
<p>经过几十年的努力，我国己经独立自主地研制、发射、跟踪和测检地球同步通讯卫星的能力。</p>
</blockquote>
<p>具备……的能力</p>
<blockquote>
<p>某大学工商管理学院在课程设置上除了专业课、外语课、政治理论课，还包括演讲与口才、基础写作等课程，以进一步提高说写方面的技能。</p>
</blockquote>
<p>除了设置有…… <strong>(第一句话缺少谓语)</strong></p>
<ul>
<li><strong>动宾缺动</strong></li>
</ul>
<blockquote>
<p>我市最近发动了全面的质量大检查运动，要在这个运动中建立与加强技术管理制度等一系列工作。</p>
</blockquote>
<p>要在这个运动中<strong>完成</strong>建立与加强技术管理制度等一系列<strong>工作</strong></p>
<blockquote>
<p>政府必须严厉打击食品安全违法违规行为的高压态势，及时消除各环节领域的隐患，创新食品安全监管惩处体制机制。</p>
</blockquote>
<p>保持严厉打击…</p>
<blockquote>
<p>教师在法律专业知识和逻辑思维能力提升方面面临困难。</p>
</blockquote>
<p>教师在法律专业知识拓展… (知识和提升搭配不是非常好，搭配知识拓展可能会更好)</p>
<h3 id="三宾语残缺">三、宾语残缺</h3>
<hr>
<ul>
<li><strong>动宾缺宾</strong></li>
</ul>
<blockquote>
<p>学校宿舍、教学楼等人群密集区，一且发生火灾，后果不堪设想，因此学生掌握火灾中自救互教相当重要。</p>
</blockquote>
<p>掌握…技能</p>
<ul>
<li><strong>介宾缺宾</strong></li>
</ul>
<blockquote>
<p>这部电影在塑造人物形象所提供的经验是非常宝贵的，</p>
</blockquote>
<p>在…方面</p>
<ul>
<li><strong>误将定语当宾语</strong></li>
</ul>
<blockquote>
<p>桃花乡走可持续发展之路，按照建成生态环境和谐优美、资源集约节约利用、经济和社会协调发展的生态乡，制定了五年发展建设规划。</p>
</blockquote>
<p>按照…目标，规划</p>
<h3 id="四虚词残缺">四、虚词残缺</h3>
<hr>
<ul>
<li><strong>介宾缺介</strong></li>
</ul>
<blockquote>
<p>2014 年底，我国探月工程三期“再入返回飞行”试验获得成功，确保嫦娥五号任务顺利实施和探月工程持续推进莫定坚实基础，</p>
</blockquote>
<p>为…奠定坚实基础</p>
<ul>
<li><strong>被动缺被</strong></li>
</ul>
<blockquote>
<p>这本书非常有价值，常常图书馆收藏。</p>
</blockquote>
<p>常常被图书馆收藏</p>
<ul>
<li><strong>对象缺对</strong></li>
</ul>
<blockquote>
<p>现代女性越来越独立，她们除了自己独立挣钱外，对自身的价值、生活环境也越发重视，那些价值剥削、性骚扰，她们将说不。</p>
</blockquote>
<p>对那些价值剥削、性骚扰，她们将说不。</p>
  </details>
<h2 id="搭建-yolov5-环境">搭建 yolov5 环境</h2>
<hr>
<p>详细参照 up 主：<a href="https://space.bilibili.com/456667721"><strong>思绪亦无限</strong></a>的介绍：</p>
<p><a href="https://www.bilibili.com/video/BV1Hg4y1t78v/?spm_id_from=333.999.0.0&amp;vd_source=237e295a40d7aaea043ead8c0d2c78ab"><strong>Win11 中从头安装软件和配置环境运行深度学习项目</strong></a></p>
<p>然后最主要的还需要引入英伟达的 CUDA，可以现在本地装，但我还是倾向于选择<a href="https://www.autodl.com/home">autodl</a>，因为这里已经预装了 cuda 环境。</p>
<p>这里细节很多，但现在又过了好久了，<strong>有点忘了</strong>，在选择基础镜像的时候就应该要注意选择合适的版本，不然后面配置 cuda 会麻烦死。（看来日志还是要及时记录，当时费了一下午的劲，真是服了）</p>
<h2 id="数据集的预处理">数据集的预处理</h2>
<hr>
<p>课题中 yolov5 的数据集是采用的航拍视角，在肉眼识别存在困难，还有很多干扰。所以需要预先对数据集进行切片处理。然后挑出切片完后包含黑匣子的图片，再进行标注。</p>
<p>以下是切片程序：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">PIL</span> <span style="color:#000;font-weight:bold">import</span> Image
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">os</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">random</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#from PIL import Image: 导入Python Imaging Library (PIL) 中的 Image 模块，用于图像处理。</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#import os: 导入 os 模块，用于处理文件和目录。</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#import random: 导入 random 模块，用于生成随机数。</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">slice_and_save_images</span>(input_folder, output_folder, random_size<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">True</span>, fixed_size<span style="color:#000;font-weight:bold">=</span>(<span style="color:#099">640</span>, <span style="color:#099">640</span>), overlap_ratio<span style="color:#000;font-weight:bold">=</span><span style="color:#099">0.2</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">#函数的定义，它接收几个参数，包括输入输出文件夹路径、是否随机切片大小、固定切片大小以及重叠比率。</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic"># 获取输入文件夹中的所有文件</span>
</span></span><span style="display:flex;"><span>    image_files <span style="color:#000;font-weight:bold">=</span> [f <span style="color:#000;font-weight:bold">for</span> f <span style="color:#000;font-weight:bold">in</span> os<span style="color:#000;font-weight:bold">.</span>listdir(input_folder) <span style="color:#000;font-weight:bold">if</span> f<span style="color:#000;font-weight:bold">.</span>lower()<span style="color:#000;font-weight:bold">.</span>endswith((<span style="color:#d14">&#39;.png&#39;</span>, <span style="color:#d14">&#39;.jpg&#39;</span>, <span style="color:#d14">&#39;.jpeg&#39;</span>, <span style="color:#d14">&#39;.bmp&#39;</span>))]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic"># 创建输出文件夹</span>
</span></span><span style="display:flex;"><span>    os<span style="color:#000;font-weight:bold">.</span>makedirs(output_folder, exist_ok<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic"># 循环处理每张图像</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">for</span> image_file <span style="color:#000;font-weight:bold">in</span> image_files:
</span></span><span style="display:flex;"><span>        input_path <span style="color:#000;font-weight:bold">=</span> os<span style="color:#000;font-weight:bold">.</span>path<span style="color:#000;font-weight:bold">.</span>join(input_folder, image_file)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># 打开图像</span>
</span></span><span style="display:flex;"><span>        original_image <span style="color:#000;font-weight:bold">=</span> Image<span style="color:#000;font-weight:bold">.</span>open(input_path)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># 获取图像大小</span>
</span></span><span style="display:flex;"><span>        width, height <span style="color:#000;font-weight:bold">=</span> original_image<span style="color:#000;font-weight:bold">.</span>size
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># 随机生成或手动指定切片大小</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">#根据 random_size 参数决定是随机生成切片大小还是使用固定大小。随机大小在固定大小的一半到固定大小之间。</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> random_size:
</span></span><span style="display:flex;"><span>            slice_width <span style="color:#000;font-weight:bold">=</span> random<span style="color:#000;font-weight:bold">.</span>randint(fixed_size[<span style="color:#099">0</span>] <span style="color:#000;font-weight:bold">//</span> <span style="color:#099">2</span>, fixed_size[<span style="color:#099">0</span>])
</span></span><span style="display:flex;"><span>            slice_height <span style="color:#000;font-weight:bold">=</span> random<span style="color:#000;font-weight:bold">.</span>randint(fixed_size[<span style="color:#099">1</span>] <span style="color:#000;font-weight:bold">//</span> <span style="color:#099">2</span>, fixed_size[<span style="color:#099">1</span>])
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>            slice_width, slice_height <span style="color:#000;font-weight:bold">=</span> fixed_size
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># 计算重叠区域大小,由 overlap_ratio 参数决定的。</span>
</span></span><span style="display:flex;"><span>        overlap_width <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">int</span>(slice_width <span style="color:#000;font-weight:bold">*</span> overlap_ratio)
</span></span><span style="display:flex;"><span>        overlap_height <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">int</span>(slice_height <span style="color:#000;font-weight:bold">*</span> overlap_ratio)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># 计算切片数量</span>
</span></span><span style="display:flex;"><span>        num_slices_horizontal <span style="color:#000;font-weight:bold">=</span> (width <span style="color:#000;font-weight:bold">-</span> overlap_width) <span style="color:#000;font-weight:bold">//</span> (slice_width <span style="color:#000;font-weight:bold">-</span> overlap_width)
</span></span><span style="display:flex;"><span>        num_slices_vertical <span style="color:#000;font-weight:bold">=</span> (height <span style="color:#000;font-weight:bold">-</span> overlap_height) <span style="color:#000;font-weight:bold">//</span> (slice_height <span style="color:#000;font-weight:bold">-</span> overlap_height)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># 创建一个文件夹用于保存切片后的小图片</span>
</span></span><span style="display:flex;"><span>        output_subfolder <span style="color:#000;font-weight:bold">=</span> os<span style="color:#000;font-weight:bold">.</span>path<span style="color:#000;font-weight:bold">.</span>join(output_folder, os<span style="color:#000;font-weight:bold">.</span>path<span style="color:#000;font-weight:bold">.</span>splitext(image_file)[<span style="color:#099">0</span>])
</span></span><span style="display:flex;"><span>        os<span style="color:#000;font-weight:bold">.</span>makedirs(output_subfolder, exist_ok<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># 切片并保存</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">for</span> i <span style="color:#000;font-weight:bold">in</span> <span style="color:#0086b3">range</span>(num_slices_horizontal):
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">for</span> j <span style="color:#000;font-weight:bold">in</span> <span style="color:#0086b3">range</span>(num_slices_vertical):
</span></span><span style="display:flex;"><span>                left <span style="color:#000;font-weight:bold">=</span> i <span style="color:#000;font-weight:bold">*</span> (slice_width <span style="color:#000;font-weight:bold">-</span> overlap_width)
</span></span><span style="display:flex;"><span>                upper <span style="color:#000;font-weight:bold">=</span> j <span style="color:#000;font-weight:bold">*</span> (slice_height <span style="color:#000;font-weight:bold">-</span> overlap_height)
</span></span><span style="display:flex;"><span>                right <span style="color:#000;font-weight:bold">=</span> left <span style="color:#000;font-weight:bold">+</span> slice_width
</span></span><span style="display:flex;"><span>                lower <span style="color:#000;font-weight:bold">=</span> upper <span style="color:#000;font-weight:bold">+</span> slice_height
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#998;font-style:italic"># 切片</span>
</span></span><span style="display:flex;"><span>                slice_image <span style="color:#000;font-weight:bold">=</span> original_image<span style="color:#000;font-weight:bold">.</span>crop((left, upper, right, lower))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#998;font-style:italic"># 生成唯一的切片文件名</span>
</span></span><span style="display:flex;"><span>                slice_filename <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">f</span><span style="color:#d14">&#34;</span><span style="color:#d14">{</span>os<span style="color:#000;font-weight:bold">.</span>path<span style="color:#000;font-weight:bold">.</span>splitext(image_file)[<span style="color:#099">0</span>]<span style="color:#d14">}</span><span style="color:#d14">_slice_</span><span style="color:#d14">{</span>j<span style="color:#d14">}</span><span style="color:#d14">_</span><span style="color:#d14">{</span>i<span style="color:#d14">}</span><span style="color:#d14">.jpg&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#998;font-style:italic"># 保存切片</span>
</span></span><span style="display:flex;"><span>                slice_image<span style="color:#000;font-weight:bold">.</span>save(os<span style="color:#000;font-weight:bold">.</span>path<span style="color:#000;font-weight:bold">.</span>join(output_subfolder, slice_filename))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># 调用函数，传入输入图像文件夹路径和输出文件夹路径,更换为自己的文件夹</span>
</span></span><span style="display:flex;"><span>slice_and_save_images(<span style="color:#d14">r</span><span style="color:#d14">&#34;C:\Users\Raj\Desktop\bbox&#34;</span>, <span style="color:#d14">r</span><span style="color:#d14">&#34;C:\Users\Raj\Desktop\bbox全部切片&#34;</span>,
</span></span><span style="display:flex;"><span>                      random_size<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">False</span>, fixed_size<span style="color:#000;font-weight:bold">=</span>(<span style="color:#099">640</span>, <span style="color:#099">640</span>))
</span></span></code></pre></div><p>切片完成之后，需要挑出包含切片中包含目标对象的图片，之后作为训练集。</p>
<p><img src="https://bu.dusays.com/2024/04/23/6627b038d4b62.jpeg" alt=""></p>
<h2 id="验证集">验证集</h2>
<hr>
<p>最开始验证集是用的数据集的一部分，但是后面采用新的验证集，难度瞬间就上来了，测试精度从 0.996 瞬间跌到都到不了 0.7。一方面需要扩充数据集，另一方面需要选择合适的模型对网络参数进行调整。</p>
<p><img src="https://bu.dusays.com/2024/04/23/6627b05fe4519.jpeg" alt=""></p>
<h2 id="扩充训练集">扩充训练集</h2>
<hr>
<p>感谢 CSDN 博主：<a href="https://blog.csdn.net/qq_44421796"><strong>我要变胖哇</strong></a><strong>、</strong><a href="https://blog.csdn.net/weixin_43334693"><strong>路人贾&rsquo;ω&rsquo;</strong></a></p>
<p>参考文章：<a href="https://blog.csdn.net/weixin_43334693/article/details/131744918"><strong>YOLO 数据集实现数据增强的方法（裁剪、平移 、旋转、改变亮度、加噪声等）</strong></a></p>
<h3 id="数据增强的概念和作用">数据增强的概念和作用</h3>
<hr>
<p><strong>数据增强</strong>是一种重要的机器学习方法之一，是<strong>基于已有的训练样本数据来生成更多的训练数据</strong>，其目的就是<strong>为了使扩增的训练数据尽可能接近真实分布的数据，从而提高检测精度</strong>。此外，数据增强能够迫使模型<strong>学习到更多鲁棒性的特征，从而有效提高模型的泛化能力</strong>。</p>
<h3 id="常见的数据增强的办法">常见的数据增强的办法</h3>
<hr>
<p>（1）比较常用的<strong>几何变换</strong>方法主要有：
翻转、旋转、裁剪、缩放、平移、抖动
（2）比较常用的<strong>像素变换</strong>方法主要有：
加椒盐噪声、高斯噪声、进行高斯模糊、调整 HSV 对比度、调节亮度、饱和度、直方图均衡化、调整白平衡等</p>
<p>具体解释如下：</p>
<ul>
<li>随机裁剪：从原始图像中随机裁剪出一部分，例如裁剪四角、中心或者上下部分等。这种方法能够增加模型的鲁棒性，使其对图像的不同部分都能进行有效的特征提取。</li>
<li>翻转或镜像：可以水平翻转或垂直翻转图像。这种方法能够模拟图像在不同视角下的情况，帮助模型学习到更多的特征。</li>
<li>旋转：将原图像旋转不同的角度来生成新的样本。需要注意的是，旋转后图像的维度可能会发生变化，因此在处理时需要确保图像尺寸的合理性。</li>
<li>亮度或对比度调节：通过改变图像的亮度和对比度，可以模拟不同光照条件下的图像情况，提高模型的适应性。</li>
<li>色度调节：改变图像中 R、G、B 颜色分量的比例，从而生成具有不同颜色特征的样本。
饱和度调节：调节图像的饱和度，即改变色彩的纯度。这可以模拟不同颜色鲜艳程度的图像，增加样本的多样性。</li>
<li>高斯模糊、锐化、添加噪声：对图像进行这些处理可以模拟图像在采集和传输过程中可能出现的失真情况，有助于提高模型的鲁棒性。
灰度化：将彩色图像转换为灰度图像，可以进一步增加样本的多样性</li>
</ul>
<h3 id="txt-转-xml">txt 转 xml</h3>
<hr>
<p>在数据增强的时候，代码是对 xml 进行操作的，所以需要先经历一步，从 txt 到 xml 的过程。</p>
<p><strong>核心原理解释</strong>：将 YOLO 格式中的归一化坐标转换为像素坐标。</p>
<ol>
<li>从 YOLO 格式的文本文件中读取每个目标的类别索引和归一化的边界框坐标  <code>(class_index, x_center_norm, y_center_norm, width_norm, height_norm)</code>。</li>
<li>将归一化的中心点坐标  <code>(x_center_norm, y_center_norm)</code>  和宽度、高度  <code>(width_norm, height_norm)</code>  转换为像素坐标。</li>
<li>使用像素坐标来计算 PASCAL VOC 格式的边界框  <code>(xmin, ymin, xmax, ymax)</code></li>
</ol>
<p><strong>核心转换逻辑：</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># 计算 PASCAL VOC 的 (xmin, ymin, xmax, ymax)</span>
</span></span><span style="display:flex;"><span>xmin <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">int</span>(<span style="color:#0086b3">round</span>(x_center <span style="color:#000;font-weight:bold">-</span> (width <span style="color:#000;font-weight:bold">/</span> <span style="color:#099">2</span>)))
</span></span><span style="display:flex;"><span>ymin <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">int</span>(<span style="color:#0086b3">round</span>(y_center <span style="color:#000;font-weight:bold">-</span> (height <span style="color:#000;font-weight:bold">/</span> <span style="color:#099">2</span>)))
</span></span><span style="display:flex;"><span>xmax <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">int</span>(<span style="color:#0086b3">round</span>(x_center <span style="color:#000;font-weight:bold">+</span> (width <span style="color:#000;font-weight:bold">/</span> <span style="color:#099">2</span>)))
</span></span><span style="display:flex;"><span>ymax <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">int</span>(<span style="color:#0086b3">round</span>(y_center <span style="color:#000;font-weight:bold">+</span> (height <span style="color:#000;font-weight:bold">/</span> <span style="color:#099">2</span>)))
</span></span></code></pre></div><p><strong>转换代码：</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># -*- coding: utf-8 -*-</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">os</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">cv2</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">lxml.etree</span> <span style="color:#000;font-weight:bold">import</span> Element, SubElement, tostring
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">txt_xml</span>(img_path, img_name, txt_path, img_txt, xml_path, img_xml):
</span></span><span style="display:flex;"><span>    clas <span style="color:#000;font-weight:bold">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic"># 读取txt的信息</span>
</span></span><span style="display:flex;"><span>    txt_img <span style="color:#000;font-weight:bold">=</span> os<span style="color:#000;font-weight:bold">.</span>path<span style="color:#000;font-weight:bold">.</span>join(txt_path, img_txt)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic"># 图像的宽度和高度</span>
</span></span><span style="display:flex;"><span>    imw <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">640</span>  <span style="color:#998;font-style:italic"># 应当根据实际图片大小进行调整</span>
</span></span><span style="display:flex;"><span>    imh <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">640</span>  <span style="color:#998;font-style:italic"># 应当根据实际图片大小进行调整</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">with</span> <span style="color:#0086b3">open</span>(txt_img, <span style="color:#d14">&#34;r&#34;</span>) <span style="color:#000;font-weight:bold">as</span> f:
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">for</span> line <span style="color:#000;font-weight:bold">in</span> f<span style="color:#000;font-weight:bold">.</span>readlines():
</span></span><span style="display:flex;"><span>            line <span style="color:#000;font-weight:bold">=</span> line<span style="color:#000;font-weight:bold">.</span>strip(<span style="color:#d14">&#39;</span><span style="color:#d14">\n</span><span style="color:#d14">&#39;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#0086b3">list</span> <span style="color:#000;font-weight:bold">=</span> line<span style="color:#000;font-weight:bold">.</span>split(<span style="color:#d14">&#34; &#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#0086b3">print</span>(<span style="color:#0086b3">list</span>)
</span></span><span style="display:flex;"><span>            clas<span style="color:#000;font-weight:bold">.</span>append(<span style="color:#0086b3">list</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic"># 创建XML文档的根节点和相关子节点</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># 创建XML文档的根节点</span>
</span></span><span style="display:flex;"><span>        node_root <span style="color:#000;font-weight:bold">=</span> Element(<span style="color:#d14">&#39;annotation&#39;</span>)
</span></span><span style="display:flex;"><span>        node_folder <span style="color:#000;font-weight:bold">=</span> SubElement(node_root, <span style="color:#d14">&#39;folder&#39;</span>)
</span></span><span style="display:flex;"><span>        node_folder<span style="color:#000;font-weight:bold">.</span>text <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;1&#39;</span>
</span></span><span style="display:flex;"><span>        node_filename <span style="color:#000;font-weight:bold">=</span> SubElement(node_root, <span style="color:#d14">&#39;filename&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># 图像名称</span>
</span></span><span style="display:flex;"><span>        node_filename<span style="color:#000;font-weight:bold">.</span>text <span style="color:#000;font-weight:bold">=</span> img_name
</span></span><span style="display:flex;"><span>        node_size <span style="color:#000;font-weight:bold">=</span> SubElement(node_root, <span style="color:#d14">&#39;size&#39;</span>)
</span></span><span style="display:flex;"><span>        node_width <span style="color:#000;font-weight:bold">=</span> SubElement(node_size, <span style="color:#d14">&#39;width&#39;</span>)
</span></span><span style="display:flex;"><span>        node_width<span style="color:#000;font-weight:bold">.</span>text <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">str</span>(imw)
</span></span><span style="display:flex;"><span>        node_height <span style="color:#000;font-weight:bold">=</span> SubElement(node_size, <span style="color:#d14">&#39;height&#39;</span>)
</span></span><span style="display:flex;"><span>        node_height<span style="color:#000;font-weight:bold">.</span>text <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">str</span>(imh)
</span></span><span style="display:flex;"><span>        node_depth <span style="color:#000;font-weight:bold">=</span> SubElement(node_size, <span style="color:#d14">&#39;depth&#39;</span>)
</span></span><span style="display:flex;"><span>        node_depth<span style="color:#000;font-weight:bold">.</span>text <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;3&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic"># 遍历所有的标注信息并添加到XML中</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># 遍历所有的标注信息</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">for</span> i <span style="color:#000;font-weight:bold">in</span> <span style="color:#0086b3">range</span>(<span style="color:#0086b3">len</span>(clas)):
</span></span><span style="display:flex;"><span>            x_center_norm <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">float</span>(clas[i][<span style="color:#099">1</span>])
</span></span><span style="display:flex;"><span>            y_center_norm <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">float</span>(clas[i][<span style="color:#099">2</span>])
</span></span><span style="display:flex;"><span>            width_norm <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">float</span>(clas[i][<span style="color:#099">3</span>])
</span></span><span style="display:flex;"><span>            height_norm <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">float</span>(clas[i][<span style="color:#099">4</span>])
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic"># 转换归一化坐标到像素坐标</span>
</span></span><span style="display:flex;"><span>            x_center <span style="color:#000;font-weight:bold">=</span> x_center_norm <span style="color:#000;font-weight:bold">*</span> imw
</span></span><span style="display:flex;"><span>            y_center <span style="color:#000;font-weight:bold">=</span> y_center_norm <span style="color:#000;font-weight:bold">*</span> imh
</span></span><span style="display:flex;"><span>            width <span style="color:#000;font-weight:bold">=</span> width_norm <span style="color:#000;font-weight:bold">*</span> imw
</span></span><span style="display:flex;"><span>            height <span style="color:#000;font-weight:bold">=</span> height_norm <span style="color:#000;font-weight:bold">*</span> imh
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic"># 计算并转换为字符串</span>
</span></span><span style="display:flex;"><span>            xmin <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">str</span>(<span style="color:#0086b3">int</span>(<span style="color:#0086b3">round</span>(x_center <span style="color:#000;font-weight:bold">-</span> (width <span style="color:#000;font-weight:bold">/</span> <span style="color:#099">2</span>))))
</span></span><span style="display:flex;"><span>            ymin <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">str</span>(<span style="color:#0086b3">int</span>(<span style="color:#0086b3">round</span>(y_center <span style="color:#000;font-weight:bold">-</span> (height <span style="color:#000;font-weight:bold">/</span> <span style="color:#099">2</span>))))
</span></span><span style="display:flex;"><span>            xmax <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">str</span>(<span style="color:#0086b3">int</span>(<span style="color:#0086b3">round</span>(x_center <span style="color:#000;font-weight:bold">+</span> (width <span style="color:#000;font-weight:bold">/</span> <span style="color:#099">2</span>))))
</span></span><span style="display:flex;"><span>            ymax <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">str</span>(<span style="color:#0086b3">int</span>(<span style="color:#0086b3">round</span>(y_center <span style="color:#000;font-weight:bold">+</span> (height <span style="color:#000;font-weight:bold">/</span> <span style="color:#099">2</span>))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic"># 创建XML节点并赋值</span>
</span></span><span style="display:flex;"><span>            node_object <span style="color:#000;font-weight:bold">=</span> SubElement(node_root, <span style="color:#d14">&#39;object&#39;</span>)
</span></span><span style="display:flex;"><span>            node_name <span style="color:#000;font-weight:bold">=</span> SubElement(node_object, <span style="color:#d14">&#39;name&#39;</span>)
</span></span><span style="display:flex;"><span>            node_name<span style="color:#000;font-weight:bold">.</span>text <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">str</span>(clas[i][<span style="color:#099">0</span>])
</span></span><span style="display:flex;"><span>            node_pose <span style="color:#000;font-weight:bold">=</span> SubElement(node_object, <span style="color:#d14">&#39;pose&#39;</span>)
</span></span><span style="display:flex;"><span>            node_pose<span style="color:#000;font-weight:bold">.</span>text <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Unspecified&#34;</span>
</span></span><span style="display:flex;"><span>            node_truncated <span style="color:#000;font-weight:bold">=</span> SubElement(node_object, <span style="color:#d14">&#39;truncated&#39;</span>)
</span></span><span style="display:flex;"><span>            node_truncated<span style="color:#000;font-weight:bold">.</span>text <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;0&#34;</span>
</span></span><span style="display:flex;"><span>            node_difficult <span style="color:#000;font-weight:bold">=</span> SubElement(node_object, <span style="color:#d14">&#39;difficult&#39;</span>)
</span></span><span style="display:flex;"><span>            node_difficult<span style="color:#000;font-weight:bold">.</span>text <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;0&#39;</span>
</span></span><span style="display:flex;"><span>            node_bndbox <span style="color:#000;font-weight:bold">=</span> SubElement(node_object, <span style="color:#d14">&#39;bndbox&#39;</span>)
</span></span><span style="display:flex;"><span>            node_xmin <span style="color:#000;font-weight:bold">=</span> SubElement(node_bndbox, <span style="color:#d14">&#39;xmin&#39;</span>)
</span></span><span style="display:flex;"><span>            node_xmin<span style="color:#000;font-weight:bold">.</span>text <span style="color:#000;font-weight:bold">=</span> xmin
</span></span><span style="display:flex;"><span>            node_ymin <span style="color:#000;font-weight:bold">=</span> SubElement(node_bndbox, <span style="color:#d14">&#39;ymin&#39;</span>)
</span></span><span style="display:flex;"><span>            node_ymin<span style="color:#000;font-weight:bold">.</span>text <span style="color:#000;font-weight:bold">=</span> ymin
</span></span><span style="display:flex;"><span>            node_xmax <span style="color:#000;font-weight:bold">=</span> SubElement(node_bndbox, <span style="color:#d14">&#39;xmax&#39;</span>)
</span></span><span style="display:flex;"><span>            node_xmax<span style="color:#000;font-weight:bold">.</span>text <span style="color:#000;font-weight:bold">=</span> xmax
</span></span><span style="display:flex;"><span>            node_ymax <span style="color:#000;font-weight:bold">=</span> SubElement(node_bndbox, <span style="color:#d14">&#39;ymax&#39;</span>)
</span></span><span style="display:flex;"><span>            node_ymax<span style="color:#000;font-weight:bold">.</span>text <span style="color:#000;font-weight:bold">=</span> ymax
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic"># 将XML内容写入文件</span>
</span></span><span style="display:flex;"><span>    xml <span style="color:#000;font-weight:bold">=</span> tostring(node_root, pretty_print<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>    img_newxml <span style="color:#000;font-weight:bold">=</span> os<span style="color:#000;font-weight:bold">.</span>path<span style="color:#000;font-weight:bold">.</span>join(xml_path, img_xml)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">with</span> <span style="color:#0086b3">open</span>(img_newxml, <span style="color:#d14">&#39;wb&#39;</span>) <span style="color:#000;font-weight:bold">as</span> file_object:
</span></span><span style="display:flex;"><span>        file_object<span style="color:#000;font-weight:bold">.</span>write(xml)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">if</span> __name__ <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic"># 图像、标注和XML文件夹所在位置、更换自己的绝对路径</span>
</span></span><span style="display:flex;"><span>    img_path <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">r</span><span style="color:#d14">&#34;D:\@Graduation\enhance\data\images\train&#34;</span>
</span></span><span style="display:flex;"><span>    txt_path <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">r</span><span style="color:#d14">&#34;D:\@Graduation\enhance\data\labels\train&#34;</span>
</span></span><span style="display:flex;"><span>    xml_path <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">r</span><span style="color:#d14">&#34;D:\@Graduation\enhance\data\labels\xml&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">for</span> img_name <span style="color:#000;font-weight:bold">in</span> os<span style="color:#000;font-weight:bold">.</span>listdir(img_path):
</span></span><span style="display:flex;"><span>        img_base_name <span style="color:#000;font-weight:bold">=</span> os<span style="color:#000;font-weight:bold">.</span>path<span style="color:#000;font-weight:bold">.</span>splitext(img_name)[<span style="color:#099">0</span>]
</span></span><span style="display:flex;"><span>        img_xml <span style="color:#000;font-weight:bold">=</span> img_base_name <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#34;.xml&#34;</span>
</span></span><span style="display:flex;"><span>        img_txt <span style="color:#000;font-weight:bold">=</span> img_base_name <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#34;.txt&#34;</span>
</span></span><span style="display:flex;"><span>        txt_xml(img_path, img_name, txt_path, img_txt, xml_path, img_xml)
</span></span></code></pre></div><p>例如，这就是标注后的归一化坐标</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>0 0.719594 0.901037 0.108083 0.091896
</span></span></code></pre></div><p>这就是转换后的 xml 坐标和其他的一些元素，转换完可以用 labelimg 验证一下</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#000080">annotation</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#000080">folder</span>&gt;1&lt;/<span style="color:#000080">folder</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#000080">filename</span>&gt;000000_slice_2_2.jpg&lt;/<span style="color:#000080">filename</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#000080">size</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">width</span>&gt;640&lt;/<span style="color:#000080">width</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">height</span>&gt;640&lt;/<span style="color:#000080">height</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">depth</span>&gt;3&lt;/<span style="color:#000080">depth</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#000080">size</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#000080">object</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">name</span>&gt;0&lt;/<span style="color:#000080">name</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">pose</span>&gt;Unspecified&lt;/<span style="color:#000080">pose</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">truncated</span>&gt;0&lt;/<span style="color:#000080">truncated</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">difficult</span>&gt;0&lt;/<span style="color:#000080">difficult</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">bndbox</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#000080">xmin</span>&gt;426&lt;/<span style="color:#000080">xmin</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#000080">ymin</span>&gt;547&lt;/<span style="color:#000080">ymin</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#000080">xmax</span>&gt;495&lt;/<span style="color:#000080">xmax</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#000080">ymax</span>&gt;606&lt;/<span style="color:#000080">ymax</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#000080">bndbox</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#000080">object</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#000080">annotation</span>&gt;
</span></span></code></pre></div><h3 id="数据集扩充">数据集扩充</h3>
<hr>
<p>根据上述分析的方式进行数据集扩充</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># -*- coding=utf-8 -*-</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">time</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">random</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">copy</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">cv2</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">os</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">math</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">numpy</span> <span style="color:#000;font-weight:bold">as</span> <span style="color:#555">np</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">skimage.util</span> <span style="color:#000;font-weight:bold">import</span> random_noise
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">lxml</span> <span style="color:#000;font-weight:bold">import</span> etree, objectify
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">xml.etree.ElementTree</span> <span style="color:#000;font-weight:bold">as</span> <span style="color:#555">ET</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">argparse</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># 显示图片</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">show_pic</span>(img, bboxes<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">None</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    输入:
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        img:图像array
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        bboxes:图像的所有boudning box list, 格式为[[x_min, y_min, x_max, y_max]....]
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        names:每个box对应的名称
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">for</span> i <span style="color:#000;font-weight:bold">in</span> <span style="color:#0086b3">range</span>(<span style="color:#0086b3">len</span>(bboxes)):
</span></span><span style="display:flex;"><span>        bbox <span style="color:#000;font-weight:bold">=</span> bboxes[i]
</span></span><span style="display:flex;"><span>        x_min <span style="color:#000;font-weight:bold">=</span> bbox[<span style="color:#099">0</span>]
</span></span><span style="display:flex;"><span>        y_min <span style="color:#000;font-weight:bold">=</span> bbox[<span style="color:#099">1</span>]
</span></span><span style="display:flex;"><span>        x_max <span style="color:#000;font-weight:bold">=</span> bbox[<span style="color:#099">2</span>]
</span></span><span style="display:flex;"><span>        y_max <span style="color:#000;font-weight:bold">=</span> bbox[<span style="color:#099">3</span>]
</span></span><span style="display:flex;"><span>        cv2<span style="color:#000;font-weight:bold">.</span>rectangle(img, (<span style="color:#0086b3">int</span>(x_min), <span style="color:#0086b3">int</span>(y_min)), (<span style="color:#0086b3">int</span>(x_max), <span style="color:#0086b3">int</span>(y_max)), (<span style="color:#099">0</span>, <span style="color:#099">255</span>, <span style="color:#099">0</span>), <span style="color:#099">3</span>)
</span></span><span style="display:flex;"><span>    cv2<span style="color:#000;font-weight:bold">.</span>namedWindow(<span style="color:#d14">&#39;pic&#39;</span>, <span style="color:#099">0</span>)  <span style="color:#998;font-style:italic"># 1表示原图</span>
</span></span><span style="display:flex;"><span>    cv2<span style="color:#000;font-weight:bold">.</span>moveWindow(<span style="color:#d14">&#39;pic&#39;</span>, <span style="color:#099">0</span>, <span style="color:#099">0</span>)
</span></span><span style="display:flex;"><span>    cv2<span style="color:#000;font-weight:bold">.</span>resizeWindow(<span style="color:#d14">&#39;pic&#39;</span>, <span style="color:#099">1200</span>, <span style="color:#099">800</span>)  <span style="color:#998;font-style:italic"># 可视化的图片大小</span>
</span></span><span style="display:flex;"><span>    cv2<span style="color:#000;font-weight:bold">.</span>imshow(<span style="color:#d14">&#39;pic&#39;</span>, img)
</span></span><span style="display:flex;"><span>    cv2<span style="color:#000;font-weight:bold">.</span>waitKey(<span style="color:#099">0</span>)
</span></span><span style="display:flex;"><span>    cv2<span style="color:#000;font-weight:bold">.</span>destroyAllWindows()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># 图像均为cv2读取</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">DataAugmentForObjectDetection</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> __init__(<span style="color:#999">self</span>, rotation_rate<span style="color:#000;font-weight:bold">=</span><span style="color:#099">0.5</span>, max_rotation_angle<span style="color:#000;font-weight:bold">=</span><span style="color:#099">5</span>,
</span></span><span style="display:flex;"><span>                 crop_rate<span style="color:#000;font-weight:bold">=</span><span style="color:#099">0.5</span>, shift_rate<span style="color:#000;font-weight:bold">=</span><span style="color:#099">0.5</span>, change_light_rate<span style="color:#000;font-weight:bold">=</span><span style="color:#099">0.5</span>,
</span></span><span style="display:flex;"><span>                 add_noise_rate<span style="color:#000;font-weight:bold">=</span><span style="color:#099">0.5</span>, flip_rate<span style="color:#000;font-weight:bold">=</span><span style="color:#099">0.5</span>,
</span></span><span style="display:flex;"><span>                 cutout_rate<span style="color:#000;font-weight:bold">=</span><span style="color:#099">0.5</span>, cut_out_length<span style="color:#000;font-weight:bold">=</span><span style="color:#099">50</span>, cut_out_holes<span style="color:#000;font-weight:bold">=</span><span style="color:#099">1</span>, cut_out_threshold<span style="color:#000;font-weight:bold">=</span><span style="color:#099">0.5</span>,
</span></span><span style="display:flex;"><span>                 is_addNoise<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">True</span>, is_changeLight<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">True</span>, is_cutout<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">True</span>, is_rotate_img_bbox<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">True</span>,
</span></span><span style="display:flex;"><span>                 is_crop_img_bboxes<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">True</span>, is_shift_pic_bboxes<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">True</span>, is_filp_pic_bboxes<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">True</span>):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># 配置各个操作的属性</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>rotation_rate <span style="color:#000;font-weight:bold">=</span> rotation_rate
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>max_rotation_angle <span style="color:#000;font-weight:bold">=</span> max_rotation_angle
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>crop_rate <span style="color:#000;font-weight:bold">=</span> crop_rate
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>shift_rate <span style="color:#000;font-weight:bold">=</span> shift_rate
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>change_light_rate <span style="color:#000;font-weight:bold">=</span> change_light_rate
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>add_noise_rate <span style="color:#000;font-weight:bold">=</span> add_noise_rate
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>flip_rate <span style="color:#000;font-weight:bold">=</span> flip_rate
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>cutout_rate <span style="color:#000;font-weight:bold">=</span> cutout_rate
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>cut_out_length <span style="color:#000;font-weight:bold">=</span> cut_out_length
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>cut_out_holes <span style="color:#000;font-weight:bold">=</span> cut_out_holes
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>cut_out_threshold <span style="color:#000;font-weight:bold">=</span> cut_out_threshold
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># 是否使用某种增强方式</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>is_addNoise <span style="color:#000;font-weight:bold">=</span> is_addNoise
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>is_changeLight <span style="color:#000;font-weight:bold">=</span> is_changeLight
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>is_cutout <span style="color:#000;font-weight:bold">=</span> is_cutout
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>is_rotate_img_bbox <span style="color:#000;font-weight:bold">=</span> is_rotate_img_bbox
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>is_crop_img_bboxes <span style="color:#000;font-weight:bold">=</span> is_crop_img_bboxes
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>is_shift_pic_bboxes <span style="color:#000;font-weight:bold">=</span> is_shift_pic_bboxes
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>is_filp_pic_bboxes <span style="color:#000;font-weight:bold">=</span> is_filp_pic_bboxes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic"># ----1.加噪声---- #</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_addNoise</span>(<span style="color:#999">self</span>, img):
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        输入:
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            img:图像array
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        输出:
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            加噪声后的图像array,由于输出的像素是在[0,1]之间,所以得乘以255
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># return cv2.GaussianBlur(img, (11, 11), 0)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> random_noise(img, mode<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;gaussian&#39;</span>, seed<span style="color:#000;font-weight:bold">=</span><span style="color:#0086b3">int</span>(time<span style="color:#000;font-weight:bold">.</span>time()), clip<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">True</span>) <span style="color:#000;font-weight:bold">*</span> <span style="color:#099">255</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic"># ---2.调整亮度--- #</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_changeLight</span>(<span style="color:#999">self</span>, img):
</span></span><span style="display:flex;"><span>        alpha <span style="color:#000;font-weight:bold">=</span> random<span style="color:#000;font-weight:bold">.</span>uniform(<span style="color:#099">0.35</span>, <span style="color:#099">1</span>)
</span></span><span style="display:flex;"><span>        blank <span style="color:#000;font-weight:bold">=</span> np<span style="color:#000;font-weight:bold">.</span>zeros(img<span style="color:#000;font-weight:bold">.</span>shape, img<span style="color:#000;font-weight:bold">.</span>dtype)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> cv2<span style="color:#000;font-weight:bold">.</span>addWeighted(img, alpha, blank, <span style="color:#099">1</span> <span style="color:#000;font-weight:bold">-</span> alpha, <span style="color:#099">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic"># ---3.cutout--- #</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_cutout</span>(<span style="color:#999">self</span>, img, bboxes, length<span style="color:#000;font-weight:bold">=</span><span style="color:#099">100</span>, n_holes<span style="color:#000;font-weight:bold">=</span><span style="color:#099">1</span>, threshold<span style="color:#000;font-weight:bold">=</span><span style="color:#099">0.5</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        原版本：https://github.com/uoguelph-mlrg/Cutout/blob/master/util/cutout.py
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        Randomly mask out one or more patches from an image.
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        Args:
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            img : a 3D numpy array,(h,w,c)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            bboxes : 框的坐标
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            n_holes (int): Number of patches to cut out of each image.
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            length (int): The length (in pixels) of each square patch.
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">cal_iou</span>(boxA, boxB):
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            boxA, boxB为两个框，返回iou
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            boxB为bouding box
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic"># determine the (x, y)-coordinates of the intersection rectangle</span>
</span></span><span style="display:flex;"><span>            xA <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">max</span>(boxA[<span style="color:#099">0</span>], boxB[<span style="color:#099">0</span>])
</span></span><span style="display:flex;"><span>            yA <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">max</span>(boxA[<span style="color:#099">1</span>], boxB[<span style="color:#099">1</span>])
</span></span><span style="display:flex;"><span>            xB <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">min</span>(boxA[<span style="color:#099">2</span>], boxB[<span style="color:#099">2</span>])
</span></span><span style="display:flex;"><span>            yB <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">min</span>(boxA[<span style="color:#099">3</span>], boxB[<span style="color:#099">3</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">if</span> xB <span style="color:#000;font-weight:bold">&lt;=</span> xA <span style="color:#000;font-weight:bold">or</span> yB <span style="color:#000;font-weight:bold">&lt;=</span> yA:
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">return</span> <span style="color:#099">0.0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic"># compute the area of intersection rectangle</span>
</span></span><span style="display:flex;"><span>            interArea <span style="color:#000;font-weight:bold">=</span> (xB <span style="color:#000;font-weight:bold">-</span> xA <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">1</span>) <span style="color:#000;font-weight:bold">*</span> (yB <span style="color:#000;font-weight:bold">-</span> yA <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic"># compute the area of both the prediction and ground-truth</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic"># rectangles</span>
</span></span><span style="display:flex;"><span>            boxAArea <span style="color:#000;font-weight:bold">=</span> (boxA[<span style="color:#099">2</span>] <span style="color:#000;font-weight:bold">-</span> boxA[<span style="color:#099">0</span>] <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">1</span>) <span style="color:#000;font-weight:bold">*</span> (boxA[<span style="color:#099">3</span>] <span style="color:#000;font-weight:bold">-</span> boxA[<span style="color:#099">1</span>] <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">1</span>)
</span></span><span style="display:flex;"><span>            boxBArea <span style="color:#000;font-weight:bold">=</span> (boxB[<span style="color:#099">2</span>] <span style="color:#000;font-weight:bold">-</span> boxB[<span style="color:#099">0</span>] <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">1</span>) <span style="color:#000;font-weight:bold">*</span> (boxB[<span style="color:#099">3</span>] <span style="color:#000;font-weight:bold">-</span> boxB[<span style="color:#099">1</span>] <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">1</span>)
</span></span><span style="display:flex;"><span>            iou <span style="color:#000;font-weight:bold">=</span> interArea <span style="color:#000;font-weight:bold">/</span> <span style="color:#0086b3">float</span>(boxBArea)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">return</span> iou
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># 得到h和w</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> img<span style="color:#000;font-weight:bold">.</span>ndim <span style="color:#000;font-weight:bold">==</span> <span style="color:#099">3</span>:
</span></span><span style="display:flex;"><span>            h, w, c <span style="color:#000;font-weight:bold">=</span> img<span style="color:#000;font-weight:bold">.</span>shape
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>            _, h, w, c <span style="color:#000;font-weight:bold">=</span> img<span style="color:#000;font-weight:bold">.</span>shape
</span></span><span style="display:flex;"><span>        mask <span style="color:#000;font-weight:bold">=</span> np<span style="color:#000;font-weight:bold">.</span>ones((h, w, c), np<span style="color:#000;font-weight:bold">.</span>float32)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">for</span> n <span style="color:#000;font-weight:bold">in</span> <span style="color:#0086b3">range</span>(n_holes):
</span></span><span style="display:flex;"><span>            chongdie <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>  <span style="color:#998;font-style:italic"># 看切割的区域是否与box重叠太多</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">while</span> chongdie:
</span></span><span style="display:flex;"><span>                y <span style="color:#000;font-weight:bold">=</span> np<span style="color:#000;font-weight:bold">.</span>random<span style="color:#000;font-weight:bold">.</span>randint(h)
</span></span><span style="display:flex;"><span>                x <span style="color:#000;font-weight:bold">=</span> np<span style="color:#000;font-weight:bold">.</span>random<span style="color:#000;font-weight:bold">.</span>randint(w)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                y1 <span style="color:#000;font-weight:bold">=</span> np<span style="color:#000;font-weight:bold">.</span>clip(y <span style="color:#000;font-weight:bold">-</span> length <span style="color:#000;font-weight:bold">//</span> <span style="color:#099">2</span>, <span style="color:#099">0</span>,
</span></span><span style="display:flex;"><span>                             h)  <span style="color:#998;font-style:italic"># numpy.clip(a, a_min, a_max, out=None), clip这个函数将将数组中的元素限制在a_min, a_max之间，大于a_max的就使得它等于 a_max，小于a_min,的就使得它等于a_min</span>
</span></span><span style="display:flex;"><span>                y2 <span style="color:#000;font-weight:bold">=</span> np<span style="color:#000;font-weight:bold">.</span>clip(y <span style="color:#000;font-weight:bold">+</span> length <span style="color:#000;font-weight:bold">//</span> <span style="color:#099">2</span>, <span style="color:#099">0</span>, h)
</span></span><span style="display:flex;"><span>                x1 <span style="color:#000;font-weight:bold">=</span> np<span style="color:#000;font-weight:bold">.</span>clip(x <span style="color:#000;font-weight:bold">-</span> length <span style="color:#000;font-weight:bold">//</span> <span style="color:#099">2</span>, <span style="color:#099">0</span>, w)
</span></span><span style="display:flex;"><span>                x2 <span style="color:#000;font-weight:bold">=</span> np<span style="color:#000;font-weight:bold">.</span>clip(x <span style="color:#000;font-weight:bold">+</span> length <span style="color:#000;font-weight:bold">//</span> <span style="color:#099">2</span>, <span style="color:#099">0</span>, w)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                chongdie <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">for</span> box <span style="color:#000;font-weight:bold">in</span> bboxes:
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">if</span> cal_iou([x1, y1, x2, y2], box) <span style="color:#000;font-weight:bold">&gt;</span> threshold:
</span></span><span style="display:flex;"><span>                        chongdie <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">break</span>
</span></span><span style="display:flex;"><span>            mask[y1: y2, x1: x2, :] <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.</span>
</span></span><span style="display:flex;"><span>        img <span style="color:#000;font-weight:bold">=</span> img <span style="color:#000;font-weight:bold">*</span> mask
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> img
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic"># ---4.旋转--- #</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_rotate_img_bbox</span>(<span style="color:#999">self</span>, img, bboxes, angle<span style="color:#000;font-weight:bold">=</span><span style="color:#099">5</span>, scale<span style="color:#000;font-weight:bold">=</span><span style="color:#099">1.</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        参考:https://blog.csdn.net/u014540717/article/details/53301195crop_rate
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        输入:
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            img:图像array,(h,w,c)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            bboxes:该图像包含的所有boundingboxs,一个list,每个元素为[x_min, y_min, x_max, y_max],要确保是数值
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            angle:旋转角度
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            scale:默认1
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        输出:
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            rot_img:旋转后的图像array
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            rot_bboxes:旋转后的boundingbox坐标list
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># 旋转图像</span>
</span></span><span style="display:flex;"><span>        w <span style="color:#000;font-weight:bold">=</span> img<span style="color:#000;font-weight:bold">.</span>shape[<span style="color:#099">1</span>]
</span></span><span style="display:flex;"><span>        h <span style="color:#000;font-weight:bold">=</span> img<span style="color:#000;font-weight:bold">.</span>shape[<span style="color:#099">0</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># 角度变弧度</span>
</span></span><span style="display:flex;"><span>        rangle <span style="color:#000;font-weight:bold">=</span> np<span style="color:#000;font-weight:bold">.</span>deg2rad(angle)  <span style="color:#998;font-style:italic"># angle in radians</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># now calculate new image width and height</span>
</span></span><span style="display:flex;"><span>        nw <span style="color:#000;font-weight:bold">=</span> (<span style="color:#0086b3">abs</span>(np<span style="color:#000;font-weight:bold">.</span>sin(rangle) <span style="color:#000;font-weight:bold">*</span> h) <span style="color:#000;font-weight:bold">+</span> <span style="color:#0086b3">abs</span>(np<span style="color:#000;font-weight:bold">.</span>cos(rangle) <span style="color:#000;font-weight:bold">*</span> w)) <span style="color:#000;font-weight:bold">*</span> scale
</span></span><span style="display:flex;"><span>        nh <span style="color:#000;font-weight:bold">=</span> (<span style="color:#0086b3">abs</span>(np<span style="color:#000;font-weight:bold">.</span>cos(rangle) <span style="color:#000;font-weight:bold">*</span> h) <span style="color:#000;font-weight:bold">+</span> <span style="color:#0086b3">abs</span>(np<span style="color:#000;font-weight:bold">.</span>sin(rangle) <span style="color:#000;font-weight:bold">*</span> w)) <span style="color:#000;font-weight:bold">*</span> scale
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># ask OpenCV for the rotation matrix</span>
</span></span><span style="display:flex;"><span>        rot_mat <span style="color:#000;font-weight:bold">=</span> cv2<span style="color:#000;font-weight:bold">.</span>getRotationMatrix2D((nw <span style="color:#000;font-weight:bold">*</span> <span style="color:#099">0.5</span>, nh <span style="color:#000;font-weight:bold">*</span> <span style="color:#099">0.5</span>), angle, scale)
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># calculate the move from the old center to the new center combined</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># with the rotation</span>
</span></span><span style="display:flex;"><span>        rot_move <span style="color:#000;font-weight:bold">=</span> np<span style="color:#000;font-weight:bold">.</span>dot(rot_mat, np<span style="color:#000;font-weight:bold">.</span>array([(nw <span style="color:#000;font-weight:bold">-</span> w) <span style="color:#000;font-weight:bold">*</span> <span style="color:#099">0.5</span>, (nh <span style="color:#000;font-weight:bold">-</span> h) <span style="color:#000;font-weight:bold">*</span> <span style="color:#099">0.5</span>, <span style="color:#099">0</span>]))
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># the move only affects the translation, so update the translation</span>
</span></span><span style="display:flex;"><span>        rot_mat[<span style="color:#099">0</span>, <span style="color:#099">2</span>] <span style="color:#000;font-weight:bold">+=</span> rot_move[<span style="color:#099">0</span>]
</span></span><span style="display:flex;"><span>        rot_mat[<span style="color:#099">1</span>, <span style="color:#099">2</span>] <span style="color:#000;font-weight:bold">+=</span> rot_move[<span style="color:#099">1</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># 仿射变换</span>
</span></span><span style="display:flex;"><span>        rot_img <span style="color:#000;font-weight:bold">=</span> cv2<span style="color:#000;font-weight:bold">.</span>warpAffine(img, rot_mat, (<span style="color:#0086b3">int</span>(math<span style="color:#000;font-weight:bold">.</span>ceil(nw)), <span style="color:#0086b3">int</span>(math<span style="color:#000;font-weight:bold">.</span>ceil(nh))), flags<span style="color:#000;font-weight:bold">=</span>cv2<span style="color:#000;font-weight:bold">.</span>INTER_LANCZOS4)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># 矫正bbox坐标</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># rot_mat是最终的旋转矩阵</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># 获取原始bbox的四个中点，然后将这四个点转换到旋转后的坐标系下</span>
</span></span><span style="display:flex;"><span>        rot_bboxes <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">list</span>()
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">for</span> bbox <span style="color:#000;font-weight:bold">in</span> bboxes:
</span></span><span style="display:flex;"><span>            xmin <span style="color:#000;font-weight:bold">=</span> bbox[<span style="color:#099">0</span>]
</span></span><span style="display:flex;"><span>            ymin <span style="color:#000;font-weight:bold">=</span> bbox[<span style="color:#099">1</span>]
</span></span><span style="display:flex;"><span>            xmax <span style="color:#000;font-weight:bold">=</span> bbox[<span style="color:#099">2</span>]
</span></span><span style="display:flex;"><span>            ymax <span style="color:#000;font-weight:bold">=</span> bbox[<span style="color:#099">3</span>]
</span></span><span style="display:flex;"><span>            point1 <span style="color:#000;font-weight:bold">=</span> np<span style="color:#000;font-weight:bold">.</span>dot(rot_mat, np<span style="color:#000;font-weight:bold">.</span>array([(xmin <span style="color:#000;font-weight:bold">+</span> xmax) <span style="color:#000;font-weight:bold">/</span> <span style="color:#099">2</span>, ymin, <span style="color:#099">1</span>]))
</span></span><span style="display:flex;"><span>            point2 <span style="color:#000;font-weight:bold">=</span> np<span style="color:#000;font-weight:bold">.</span>dot(rot_mat, np<span style="color:#000;font-weight:bold">.</span>array([xmax, (ymin <span style="color:#000;font-weight:bold">+</span> ymax) <span style="color:#000;font-weight:bold">/</span> <span style="color:#099">2</span>, <span style="color:#099">1</span>]))
</span></span><span style="display:flex;"><span>            point3 <span style="color:#000;font-weight:bold">=</span> np<span style="color:#000;font-weight:bold">.</span>dot(rot_mat, np<span style="color:#000;font-weight:bold">.</span>array([(xmin <span style="color:#000;font-weight:bold">+</span> xmax) <span style="color:#000;font-weight:bold">/</span> <span style="color:#099">2</span>, ymax, <span style="color:#099">1</span>]))
</span></span><span style="display:flex;"><span>            point4 <span style="color:#000;font-weight:bold">=</span> np<span style="color:#000;font-weight:bold">.</span>dot(rot_mat, np<span style="color:#000;font-weight:bold">.</span>array([xmin, (ymin <span style="color:#000;font-weight:bold">+</span> ymax) <span style="color:#000;font-weight:bold">/</span> <span style="color:#099">2</span>, <span style="color:#099">1</span>]))
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic"># 合并np.array</span>
</span></span><span style="display:flex;"><span>            concat <span style="color:#000;font-weight:bold">=</span> np<span style="color:#000;font-weight:bold">.</span>vstack((point1, point2, point3, point4))
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic"># 改变array类型</span>
</span></span><span style="display:flex;"><span>            concat <span style="color:#000;font-weight:bold">=</span> concat<span style="color:#000;font-weight:bold">.</span>astype(np<span style="color:#000;font-weight:bold">.</span>int32)
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic"># 得到旋转后的坐标</span>
</span></span><span style="display:flex;"><span>            rx, ry, rw, rh <span style="color:#000;font-weight:bold">=</span> cv2<span style="color:#000;font-weight:bold">.</span>boundingRect(concat)
</span></span><span style="display:flex;"><span>            rx_min <span style="color:#000;font-weight:bold">=</span> rx
</span></span><span style="display:flex;"><span>            ry_min <span style="color:#000;font-weight:bold">=</span> ry
</span></span><span style="display:flex;"><span>            rx_max <span style="color:#000;font-weight:bold">=</span> rx <span style="color:#000;font-weight:bold">+</span> rw
</span></span><span style="display:flex;"><span>            ry_max <span style="color:#000;font-weight:bold">=</span> ry <span style="color:#000;font-weight:bold">+</span> rh
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic"># 加入list中</span>
</span></span><span style="display:flex;"><span>            rot_bboxes<span style="color:#000;font-weight:bold">.</span>append([rx_min, ry_min, rx_max, ry_max])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> rot_img, rot_bboxes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic"># ---5.裁剪--- #</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_crop_img_bboxes</span>(<span style="color:#999">self</span>, img, bboxes):
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        裁剪后的图片要包含所有的框
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        输入:
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            img:图像array
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            bboxes:该图像包含的所有boundingboxs,一个list,每个元素为[x_min, y_min, x_max, y_max],要确保是数值
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        输出:
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            crop_img:裁剪后的图像array
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            crop_bboxes:裁剪后的bounding box的坐标list
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># 裁剪图像</span>
</span></span><span style="display:flex;"><span>        w <span style="color:#000;font-weight:bold">=</span> img<span style="color:#000;font-weight:bold">.</span>shape[<span style="color:#099">1</span>]
</span></span><span style="display:flex;"><span>        h <span style="color:#000;font-weight:bold">=</span> img<span style="color:#000;font-weight:bold">.</span>shape[<span style="color:#099">0</span>]
</span></span><span style="display:flex;"><span>        x_min <span style="color:#000;font-weight:bold">=</span> w  <span style="color:#998;font-style:italic"># 裁剪后的包含所有目标框的最小的框</span>
</span></span><span style="display:flex;"><span>        x_max <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>        y_min <span style="color:#000;font-weight:bold">=</span> h
</span></span><span style="display:flex;"><span>        y_max <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">for</span> bbox <span style="color:#000;font-weight:bold">in</span> bboxes:
</span></span><span style="display:flex;"><span>            x_min <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">min</span>(x_min, bbox[<span style="color:#099">0</span>])
</span></span><span style="display:flex;"><span>            y_min <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">min</span>(y_min, bbox[<span style="color:#099">1</span>])
</span></span><span style="display:flex;"><span>            x_max <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">max</span>(x_max, bbox[<span style="color:#099">2</span>])
</span></span><span style="display:flex;"><span>            y_max <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">max</span>(y_max, bbox[<span style="color:#099">3</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        d_to_left <span style="color:#000;font-weight:bold">=</span> x_min  <span style="color:#998;font-style:italic"># 包含所有目标框的最小框到左边的距离</span>
</span></span><span style="display:flex;"><span>        d_to_right <span style="color:#000;font-weight:bold">=</span> w <span style="color:#000;font-weight:bold">-</span> x_max  <span style="color:#998;font-style:italic"># 包含所有目标框的最小框到右边的距离</span>
</span></span><span style="display:flex;"><span>        d_to_top <span style="color:#000;font-weight:bold">=</span> y_min  <span style="color:#998;font-style:italic"># 包含所有目标框的最小框到顶端的距离</span>
</span></span><span style="display:flex;"><span>        d_to_bottom <span style="color:#000;font-weight:bold">=</span> h <span style="color:#000;font-weight:bold">-</span> y_max  <span style="color:#998;font-style:italic"># 包含所有目标框的最小框到底部的距离</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># 随机扩展这个最小框</span>
</span></span><span style="display:flex;"><span>        crop_x_min <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">int</span>(x_min <span style="color:#000;font-weight:bold">-</span> random<span style="color:#000;font-weight:bold">.</span>uniform(<span style="color:#099">0</span>, d_to_left))
</span></span><span style="display:flex;"><span>        crop_y_min <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">int</span>(y_min <span style="color:#000;font-weight:bold">-</span> random<span style="color:#000;font-weight:bold">.</span>uniform(<span style="color:#099">0</span>, d_to_top))
</span></span><span style="display:flex;"><span>        crop_x_max <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">int</span>(x_max <span style="color:#000;font-weight:bold">+</span> random<span style="color:#000;font-weight:bold">.</span>uniform(<span style="color:#099">0</span>, d_to_right))
</span></span><span style="display:flex;"><span>        crop_y_max <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">int</span>(y_max <span style="color:#000;font-weight:bold">+</span> random<span style="color:#000;font-weight:bold">.</span>uniform(<span style="color:#099">0</span>, d_to_bottom))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># 随机扩展这个最小框 , 防止别裁的太小</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># crop_x_min = int(x_min - random.uniform(d_to_left//2, d_to_left))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># crop_y_min = int(y_min - random.uniform(d_to_top//2, d_to_top))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># crop_x_max = int(x_max + random.uniform(d_to_right//2, d_to_right))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># crop_y_max = int(y_max + random.uniform(d_to_bottom//2, d_to_bottom))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># 确保不要越界</span>
</span></span><span style="display:flex;"><span>        crop_x_min <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">max</span>(<span style="color:#099">0</span>, crop_x_min)
</span></span><span style="display:flex;"><span>        crop_y_min <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">max</span>(<span style="color:#099">0</span>, crop_y_min)
</span></span><span style="display:flex;"><span>        crop_x_max <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">min</span>(w, crop_x_max)
</span></span><span style="display:flex;"><span>        crop_y_max <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">min</span>(h, crop_y_max)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        crop_img <span style="color:#000;font-weight:bold">=</span> img[crop_y_min:crop_y_max, crop_x_min:crop_x_max]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># 裁剪boundingbox</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># 裁剪后的boundingbox坐标计算</span>
</span></span><span style="display:flex;"><span>        crop_bboxes <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">list</span>()
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">for</span> bbox <span style="color:#000;font-weight:bold">in</span> bboxes:
</span></span><span style="display:flex;"><span>            crop_bboxes<span style="color:#000;font-weight:bold">.</span>append([bbox[<span style="color:#099">0</span>] <span style="color:#000;font-weight:bold">-</span> crop_x_min, bbox[<span style="color:#099">1</span>] <span style="color:#000;font-weight:bold">-</span> crop_y_min, bbox[<span style="color:#099">2</span>] <span style="color:#000;font-weight:bold">-</span> crop_x_min, bbox[<span style="color:#099">3</span>] <span style="color:#000;font-weight:bold">-</span> crop_y_min])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> crop_img, crop_bboxes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic"># ---6.平移--- #</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_shift_pic_bboxes</span>(<span style="color:#999">self</span>, img, bboxes):
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        平移后的图片要包含所有的框
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        输入:
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            img:图像array
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            bboxes:该图像包含的所有boundingboxs,一个list,每个元素为[x_min, y_min, x_max, y_max],要确保是数值
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        输出:
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            shift_img:平移后的图像array
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            shift_bboxes:平移后的bounding box的坐标list
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># 平移图像</span>
</span></span><span style="display:flex;"><span>        w <span style="color:#000;font-weight:bold">=</span> img<span style="color:#000;font-weight:bold">.</span>shape[<span style="color:#099">1</span>]
</span></span><span style="display:flex;"><span>        h <span style="color:#000;font-weight:bold">=</span> img<span style="color:#000;font-weight:bold">.</span>shape[<span style="color:#099">0</span>]
</span></span><span style="display:flex;"><span>        x_min <span style="color:#000;font-weight:bold">=</span> w  <span style="color:#998;font-style:italic"># 裁剪后的包含所有目标框的最小的框</span>
</span></span><span style="display:flex;"><span>        x_max <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>        y_min <span style="color:#000;font-weight:bold">=</span> h
</span></span><span style="display:flex;"><span>        y_max <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">for</span> bbox <span style="color:#000;font-weight:bold">in</span> bboxes:
</span></span><span style="display:flex;"><span>            x_min <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">min</span>(x_min, bbox[<span style="color:#099">0</span>])
</span></span><span style="display:flex;"><span>            y_min <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">min</span>(y_min, bbox[<span style="color:#099">1</span>])
</span></span><span style="display:flex;"><span>            x_max <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">max</span>(x_max, bbox[<span style="color:#099">2</span>])
</span></span><span style="display:flex;"><span>            y_max <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">max</span>(y_max, bbox[<span style="color:#099">3</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        d_to_left <span style="color:#000;font-weight:bold">=</span> x_min  <span style="color:#998;font-style:italic"># 包含所有目标框的最大左移动距离</span>
</span></span><span style="display:flex;"><span>        d_to_right <span style="color:#000;font-weight:bold">=</span> w <span style="color:#000;font-weight:bold">-</span> x_max  <span style="color:#998;font-style:italic"># 包含所有目标框的最大右移动距离</span>
</span></span><span style="display:flex;"><span>        d_to_top <span style="color:#000;font-weight:bold">=</span> y_min  <span style="color:#998;font-style:italic"># 包含所有目标框的最大上移动距离</span>
</span></span><span style="display:flex;"><span>        d_to_bottom <span style="color:#000;font-weight:bold">=</span> h <span style="color:#000;font-weight:bold">-</span> y_max  <span style="color:#998;font-style:italic"># 包含所有目标框的最大下移动距离</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        x <span style="color:#000;font-weight:bold">=</span> random<span style="color:#000;font-weight:bold">.</span>uniform(<span style="color:#000;font-weight:bold">-</span>(d_to_left <span style="color:#000;font-weight:bold">-</span> <span style="color:#099">1</span>) <span style="color:#000;font-weight:bold">/</span> <span style="color:#099">3</span>, (d_to_right <span style="color:#000;font-weight:bold">-</span> <span style="color:#099">1</span>) <span style="color:#000;font-weight:bold">/</span> <span style="color:#099">3</span>)
</span></span><span style="display:flex;"><span>        y <span style="color:#000;font-weight:bold">=</span> random<span style="color:#000;font-weight:bold">.</span>uniform(<span style="color:#000;font-weight:bold">-</span>(d_to_top <span style="color:#000;font-weight:bold">-</span> <span style="color:#099">1</span>) <span style="color:#000;font-weight:bold">/</span> <span style="color:#099">3</span>, (d_to_bottom <span style="color:#000;font-weight:bold">-</span> <span style="color:#099">1</span>) <span style="color:#000;font-weight:bold">/</span> <span style="color:#099">3</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        M <span style="color:#000;font-weight:bold">=</span> np<span style="color:#000;font-weight:bold">.</span>float32([[<span style="color:#099">1</span>, <span style="color:#099">0</span>, x], [<span style="color:#099">0</span>, <span style="color:#099">1</span>, y]])  <span style="color:#998;font-style:italic"># x为向左或右移动的像素值,正为向右负为向左; y为向上或者向下移动的像素值,正为向下负为向上</span>
</span></span><span style="display:flex;"><span>        shift_img <span style="color:#000;font-weight:bold">=</span> cv2<span style="color:#000;font-weight:bold">.</span>warpAffine(img, M, (img<span style="color:#000;font-weight:bold">.</span>shape[<span style="color:#099">1</span>], img<span style="color:#000;font-weight:bold">.</span>shape[<span style="color:#099">0</span>]))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">#  平移boundingbox</span>
</span></span><span style="display:flex;"><span>        shift_bboxes <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">list</span>()
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">for</span> bbox <span style="color:#000;font-weight:bold">in</span> bboxes:
</span></span><span style="display:flex;"><span>            shift_bboxes<span style="color:#000;font-weight:bold">.</span>append([bbox[<span style="color:#099">0</span>] <span style="color:#000;font-weight:bold">+</span> x, bbox[<span style="color:#099">1</span>] <span style="color:#000;font-weight:bold">+</span> y, bbox[<span style="color:#099">2</span>] <span style="color:#000;font-weight:bold">+</span> x, bbox[<span style="color:#099">3</span>] <span style="color:#000;font-weight:bold">+</span> y])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> shift_img, shift_bboxes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic"># ---7.镜像--- #</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_filp_pic_bboxes</span>(<span style="color:#999">self</span>, img, bboxes):
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            平移后的图片要包含所有的框
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            输入:
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                img:图像array
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                bboxes:该图像包含的所有boundingboxs,一个list,每个元素为[x_min, y_min, x_max, y_max],要确保是数值
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            输出:
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                flip_img:平移后的图像array
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                flip_bboxes:平移后的bounding box的坐标list
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># 翻转图像</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        flip_img <span style="color:#000;font-weight:bold">=</span> copy<span style="color:#000;font-weight:bold">.</span>deepcopy(img)
</span></span><span style="display:flex;"><span>        h, w, _ <span style="color:#000;font-weight:bold">=</span> img<span style="color:#000;font-weight:bold">.</span>shape
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        sed <span style="color:#000;font-weight:bold">=</span> random<span style="color:#000;font-weight:bold">.</span>random()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#099">0</span> <span style="color:#000;font-weight:bold">&lt;</span> sed <span style="color:#000;font-weight:bold">&lt;</span> <span style="color:#099">0.33</span>:  <span style="color:#998;font-style:italic"># 0.33的概率水平翻转，0.33的概率垂直翻转,0.33是对角反转</span>
</span></span><span style="display:flex;"><span>            flip_img <span style="color:#000;font-weight:bold">=</span> cv2<span style="color:#000;font-weight:bold">.</span>flip(flip_img, <span style="color:#099">0</span>)  <span style="color:#998;font-style:italic"># _flip_x</span>
</span></span><span style="display:flex;"><span>            inver <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">elif</span> <span style="color:#099">0.33</span> <span style="color:#000;font-weight:bold">&lt;</span> sed <span style="color:#000;font-weight:bold">&lt;</span> <span style="color:#099">0.66</span>:
</span></span><span style="display:flex;"><span>            flip_img <span style="color:#000;font-weight:bold">=</span> cv2<span style="color:#000;font-weight:bold">.</span>flip(flip_img, <span style="color:#099">1</span>)  <span style="color:#998;font-style:italic"># _flip_y</span>
</span></span><span style="display:flex;"><span>            inver <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>            flip_img <span style="color:#000;font-weight:bold">=</span> cv2<span style="color:#000;font-weight:bold">.</span>flip(flip_img, <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span>)  <span style="color:#998;font-style:italic"># flip_x_y</span>
</span></span><span style="display:flex;"><span>            inver <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># 调整boundingbox</span>
</span></span><span style="display:flex;"><span>        flip_bboxes <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">list</span>()
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">for</span> box <span style="color:#000;font-weight:bold">in</span> bboxes:
</span></span><span style="display:flex;"><span>            x_min <span style="color:#000;font-weight:bold">=</span> box[<span style="color:#099">0</span>]
</span></span><span style="display:flex;"><span>            y_min <span style="color:#000;font-weight:bold">=</span> box[<span style="color:#099">1</span>]
</span></span><span style="display:flex;"><span>            x_max <span style="color:#000;font-weight:bold">=</span> box[<span style="color:#099">2</span>]
</span></span><span style="display:flex;"><span>            y_max <span style="color:#000;font-weight:bold">=</span> box[<span style="color:#099">3</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">if</span> inver <span style="color:#000;font-weight:bold">==</span> <span style="color:#099">0</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#998;font-style:italic"># 0：垂直翻转</span>
</span></span><span style="display:flex;"><span>                flip_bboxes<span style="color:#000;font-weight:bold">.</span>append([x_min, h <span style="color:#000;font-weight:bold">-</span> y_max, x_max, h <span style="color:#000;font-weight:bold">-</span> y_min])
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">elif</span> inver <span style="color:#000;font-weight:bold">==</span> <span style="color:#099">1</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#998;font-style:italic"># 1：水平翻转</span>
</span></span><span style="display:flex;"><span>                flip_bboxes<span style="color:#000;font-weight:bold">.</span>append([w <span style="color:#000;font-weight:bold">-</span> x_max, y_min, w <span style="color:#000;font-weight:bold">-</span> x_min, y_max])
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">elif</span> inver <span style="color:#000;font-weight:bold">==</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#998;font-style:italic"># -1：水平垂直翻转</span>
</span></span><span style="display:flex;"><span>                flip_bboxes<span style="color:#000;font-weight:bold">.</span>append([w <span style="color:#000;font-weight:bold">-</span> x_max, h <span style="color:#000;font-weight:bold">-</span> y_max, w <span style="color:#000;font-weight:bold">-</span> x_min, h <span style="color:#000;font-weight:bold">-</span> y_min])
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> flip_img, flip_bboxes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic"># 图像增强方法</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">dataAugment</span>(<span style="color:#999">self</span>, img, bboxes):
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        图像增强
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        输入:
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            img:图像array
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            bboxes:该图像的所有框坐标
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        输出:
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            img:增强后的图像
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            bboxes:增强后图片对应的box
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>        change_num <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>  <span style="color:#998;font-style:italic"># 改变的次数</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># print(&#39;------&#39;)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">while</span> change_num <span style="color:#000;font-weight:bold">&lt;</span> <span style="color:#099">1</span>:  <span style="color:#998;font-style:italic"># 默认至少有一种数据增强生效</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>is_rotate_img_bbox:
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">if</span> random<span style="color:#000;font-weight:bold">.</span>random() <span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>rotation_rate:  <span style="color:#998;font-style:italic"># 旋转</span>
</span></span><span style="display:flex;"><span>                    change_num <span style="color:#000;font-weight:bold">+=</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>                    angle <span style="color:#000;font-weight:bold">=</span> random<span style="color:#000;font-weight:bold">.</span>uniform(<span style="color:#000;font-weight:bold">-</span><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>max_rotation_angle, <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>max_rotation_angle)
</span></span><span style="display:flex;"><span>                    scale <span style="color:#000;font-weight:bold">=</span> random<span style="color:#000;font-weight:bold">.</span>uniform(<span style="color:#099">0.7</span>, <span style="color:#099">0.8</span>)
</span></span><span style="display:flex;"><span>                    img, bboxes <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_rotate_img_bbox(img, bboxes, angle, scale)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>is_shift_pic_bboxes:
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">if</span> random<span style="color:#000;font-weight:bold">.</span>random() <span style="color:#000;font-weight:bold">&lt;</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>shift_rate:  <span style="color:#998;font-style:italic"># 平移</span>
</span></span><span style="display:flex;"><span>                    change_num <span style="color:#000;font-weight:bold">+=</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>                    img, bboxes <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_shift_pic_bboxes(img, bboxes)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>is_changeLight:
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">if</span> random<span style="color:#000;font-weight:bold">.</span>random() <span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>change_light_rate:  <span style="color:#998;font-style:italic"># 改变亮度</span>
</span></span><span style="display:flex;"><span>                    change_num <span style="color:#000;font-weight:bold">+=</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>                    img <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_changeLight(img)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>is_addNoise:
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">if</span> random<span style="color:#000;font-weight:bold">.</span>random() <span style="color:#000;font-weight:bold">&lt;</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>add_noise_rate:  <span style="color:#998;font-style:italic"># 加噪声</span>
</span></span><span style="display:flex;"><span>                    change_num <span style="color:#000;font-weight:bold">+=</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>                    img <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_addNoise(img)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>is_cutout:
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">if</span> random<span style="color:#000;font-weight:bold">.</span>random() <span style="color:#000;font-weight:bold">&lt;</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>cutout_rate:  <span style="color:#998;font-style:italic"># cutout</span>
</span></span><span style="display:flex;"><span>                    change_num <span style="color:#000;font-weight:bold">+=</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>                    img <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_cutout(img, bboxes, length<span style="color:#000;font-weight:bold">=</span><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>cut_out_length, n_holes<span style="color:#000;font-weight:bold">=</span><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>cut_out_holes,
</span></span><span style="display:flex;"><span>                                       threshold<span style="color:#000;font-weight:bold">=</span><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>cut_out_threshold)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>is_filp_pic_bboxes:
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">if</span> random<span style="color:#000;font-weight:bold">.</span>random() <span style="color:#000;font-weight:bold">&lt;</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>flip_rate:  <span style="color:#998;font-style:italic"># 翻转</span>
</span></span><span style="display:flex;"><span>                    change_num <span style="color:#000;font-weight:bold">+=</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>                    img, bboxes <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_filp_pic_bboxes(img, bboxes)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> img, bboxes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># xml解析工具</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">ToolHelper</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic"># 从xml文件中提取bounding box信息, 格式为[[x_min, y_min, x_max, y_max, name]]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">parse_xml</span>(<span style="color:#999">self</span>, path):
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        输入：
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            xml_path: xml的文件路径
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        输出：
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            从xml文件中提取bounding box信息, 格式为[[x_min, y_min, x_max, y_max, name]]
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>        tree <span style="color:#000;font-weight:bold">=</span> ET<span style="color:#000;font-weight:bold">.</span>parse(path)
</span></span><span style="display:flex;"><span>        root <span style="color:#000;font-weight:bold">=</span> tree<span style="color:#000;font-weight:bold">.</span>getroot()
</span></span><span style="display:flex;"><span>        objs <span style="color:#000;font-weight:bold">=</span> root<span style="color:#000;font-weight:bold">.</span>findall(<span style="color:#d14">&#39;object&#39;</span>)
</span></span><span style="display:flex;"><span>        coords <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">list</span>()
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">for</span> ix, obj <span style="color:#000;font-weight:bold">in</span> <span style="color:#0086b3">enumerate</span>(objs):
</span></span><span style="display:flex;"><span>            name <span style="color:#000;font-weight:bold">=</span> obj<span style="color:#000;font-weight:bold">.</span>find(<span style="color:#d14">&#39;name&#39;</span>)<span style="color:#000;font-weight:bold">.</span>text
</span></span><span style="display:flex;"><span>            box <span style="color:#000;font-weight:bold">=</span> obj<span style="color:#000;font-weight:bold">.</span>find(<span style="color:#d14">&#39;bndbox&#39;</span>)
</span></span><span style="display:flex;"><span>            x_min <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">int</span>(box[<span style="color:#099">0</span>]<span style="color:#000;font-weight:bold">.</span>text)
</span></span><span style="display:flex;"><span>            y_min <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">int</span>(box[<span style="color:#099">1</span>]<span style="color:#000;font-weight:bold">.</span>text)
</span></span><span style="display:flex;"><span>            x_max <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">int</span>(box[<span style="color:#099">2</span>]<span style="color:#000;font-weight:bold">.</span>text)
</span></span><span style="display:flex;"><span>            y_max <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">int</span>(box[<span style="color:#099">3</span>]<span style="color:#000;font-weight:bold">.</span>text)
</span></span><span style="display:flex;"><span>            coords<span style="color:#000;font-weight:bold">.</span>append([x_min, y_min, x_max, y_max, name])
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> coords
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic"># 保存图片结果</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">save_img</span>(<span style="color:#999">self</span>, file_name, save_folder, img):
</span></span><span style="display:flex;"><span>        cv2<span style="color:#000;font-weight:bold">.</span>imwrite(os<span style="color:#000;font-weight:bold">.</span>path<span style="color:#000;font-weight:bold">.</span>join(save_folder, file_name), img)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic"># 保持xml结果</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">save_xml</span>(<span style="color:#999">self</span>, file_name, save_folder, img_info, height, width, channel, bboxs_info):
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        :param file_name:文件名
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        :param save_folder:#保存的xml文件的结果
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        :param height:图片的信息
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        :param width:图片的宽度
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        :param channel:通道
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        :return:
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>        folder_name, img_name <span style="color:#000;font-weight:bold">=</span> img_info  <span style="color:#998;font-style:italic"># 得到图片的信息</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        E <span style="color:#000;font-weight:bold">=</span> objectify<span style="color:#000;font-weight:bold">.</span>ElementMaker(annotate<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">False</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        anno_tree <span style="color:#000;font-weight:bold">=</span> E<span style="color:#000;font-weight:bold">.</span>annotation(
</span></span><span style="display:flex;"><span>            E<span style="color:#000;font-weight:bold">.</span>folder(folder_name),
</span></span><span style="display:flex;"><span>            E<span style="color:#000;font-weight:bold">.</span>filename(img_name),
</span></span><span style="display:flex;"><span>            E<span style="color:#000;font-weight:bold">.</span>path(os<span style="color:#000;font-weight:bold">.</span>path<span style="color:#000;font-weight:bold">.</span>join(folder_name, img_name)),
</span></span><span style="display:flex;"><span>            E<span style="color:#000;font-weight:bold">.</span>source(
</span></span><span style="display:flex;"><span>                E<span style="color:#000;font-weight:bold">.</span>database(<span style="color:#d14">&#39;Unknown&#39;</span>),
</span></span><span style="display:flex;"><span>            ),
</span></span><span style="display:flex;"><span>            E<span style="color:#000;font-weight:bold">.</span>size(
</span></span><span style="display:flex;"><span>                E<span style="color:#000;font-weight:bold">.</span>width(width),
</span></span><span style="display:flex;"><span>                E<span style="color:#000;font-weight:bold">.</span>height(height),
</span></span><span style="display:flex;"><span>                E<span style="color:#000;font-weight:bold">.</span>depth(channel)
</span></span><span style="display:flex;"><span>            ),
</span></span><span style="display:flex;"><span>            E<span style="color:#000;font-weight:bold">.</span>segmented(<span style="color:#099">0</span>),
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        labels, bboxs <span style="color:#000;font-weight:bold">=</span> bboxs_info  <span style="color:#998;font-style:italic"># 得到边框和标签信息</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">for</span> label, box <span style="color:#000;font-weight:bold">in</span> <span style="color:#0086b3">zip</span>(labels, bboxs):
</span></span><span style="display:flex;"><span>            anno_tree<span style="color:#000;font-weight:bold">.</span>append(
</span></span><span style="display:flex;"><span>                E<span style="color:#000;font-weight:bold">.</span>object(
</span></span><span style="display:flex;"><span>                    E<span style="color:#000;font-weight:bold">.</span>name(label),
</span></span><span style="display:flex;"><span>                    E<span style="color:#000;font-weight:bold">.</span>pose(<span style="color:#d14">&#39;Unspecified&#39;</span>),
</span></span><span style="display:flex;"><span>                    E<span style="color:#000;font-weight:bold">.</span>truncated(<span style="color:#d14">&#39;0&#39;</span>),
</span></span><span style="display:flex;"><span>                    E<span style="color:#000;font-weight:bold">.</span>difficult(<span style="color:#d14">&#39;0&#39;</span>),
</span></span><span style="display:flex;"><span>                    E<span style="color:#000;font-weight:bold">.</span>bndbox(
</span></span><span style="display:flex;"><span>                        E<span style="color:#000;font-weight:bold">.</span>xmin(box[<span style="color:#099">0</span>]),
</span></span><span style="display:flex;"><span>                        E<span style="color:#000;font-weight:bold">.</span>ymin(box[<span style="color:#099">1</span>]),
</span></span><span style="display:flex;"><span>                        E<span style="color:#000;font-weight:bold">.</span>xmax(box[<span style="color:#099">2</span>]),
</span></span><span style="display:flex;"><span>                        E<span style="color:#000;font-weight:bold">.</span>ymax(box[<span style="color:#099">3</span>])
</span></span><span style="display:flex;"><span>                    )
</span></span><span style="display:flex;"><span>                ))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        etree<span style="color:#000;font-weight:bold">.</span>ElementTree(anno_tree)<span style="color:#000;font-weight:bold">.</span>write(os<span style="color:#000;font-weight:bold">.</span>path<span style="color:#000;font-weight:bold">.</span>join(save_folder, file_name), pretty_print<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">if</span> __name__ <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    need_aug_num <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">5</span>  <span style="color:#998;font-style:italic"># 每张图片需要增强的次数</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    is_endwidth_dot <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>  <span style="color:#998;font-style:italic"># 文件是否以.jpg或者png结尾</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    dataAug <span style="color:#000;font-weight:bold">=</span> DataAugmentForObjectDetection()  <span style="color:#998;font-style:italic"># 数据增强工具类</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    toolhelper <span style="color:#000;font-weight:bold">=</span> ToolHelper()  <span style="color:#998;font-style:italic"># 工具</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic"># 获取相关参数</span>
</span></span><span style="display:flex;"><span>    parser <span style="color:#000;font-weight:bold">=</span> argparse<span style="color:#000;font-weight:bold">.</span>ArgumentParser()
</span></span><span style="display:flex;"><span>    parser<span style="color:#000;font-weight:bold">.</span>add_argument(<span style="color:#d14">&#39;--source_img_path&#39;</span>, <span style="color:#0086b3">type</span><span style="color:#000;font-weight:bold">=</span><span style="color:#0086b3">str</span>, default<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;D:\@Graduation\enhance\images&#39;</span>)
</span></span><span style="display:flex;"><span>    parser<span style="color:#000;font-weight:bold">.</span>add_argument(<span style="color:#d14">&#39;--source_xml_path&#39;</span>, <span style="color:#0086b3">type</span><span style="color:#000;font-weight:bold">=</span><span style="color:#0086b3">str</span>, default<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;D:\@Graduation\enhance\labels&#39;</span>)
</span></span><span style="display:flex;"><span>    parser<span style="color:#000;font-weight:bold">.</span>add_argument(<span style="color:#d14">&#39;--save_img_path&#39;</span>, <span style="color:#0086b3">type</span><span style="color:#000;font-weight:bold">=</span><span style="color:#0086b3">str</span>, default<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;D:\@Graduation\enhance\images2&#39;</span>)
</span></span><span style="display:flex;"><span>    parser<span style="color:#000;font-weight:bold">.</span>add_argument(<span style="color:#d14">&#39;--save_xml_path&#39;</span>, <span style="color:#0086b3">type</span><span style="color:#000;font-weight:bold">=</span><span style="color:#0086b3">str</span>, default<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;D:\@Graduation\enhance\Annotations2&#39;</span>)
</span></span><span style="display:flex;"><span>    args <span style="color:#000;font-weight:bold">=</span> parser<span style="color:#000;font-weight:bold">.</span>parse_args()
</span></span><span style="display:flex;"><span>    source_img_path <span style="color:#000;font-weight:bold">=</span> args<span style="color:#000;font-weight:bold">.</span>source_img_path  <span style="color:#998;font-style:italic"># 图片原始位置</span>
</span></span><span style="display:flex;"><span>    source_xml_path <span style="color:#000;font-weight:bold">=</span> args<span style="color:#000;font-weight:bold">.</span>source_xml_path  <span style="color:#998;font-style:italic"># xml的原始位置</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    save_img_path <span style="color:#000;font-weight:bold">=</span> args<span style="color:#000;font-weight:bold">.</span>save_img_path  <span style="color:#998;font-style:italic"># 图片增强结果保存文件</span>
</span></span><span style="display:flex;"><span>    save_xml_path <span style="color:#000;font-weight:bold">=</span> args<span style="color:#000;font-weight:bold">.</span>save_xml_path  <span style="color:#998;font-style:italic"># xml增强结果保存文件</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic"># 如果保存文件夹不存在就创建</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">not</span> os<span style="color:#000;font-weight:bold">.</span>path<span style="color:#000;font-weight:bold">.</span>exists(save_img_path):
</span></span><span style="display:flex;"><span>        os<span style="color:#000;font-weight:bold">.</span>mkdir(save_img_path)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">not</span> os<span style="color:#000;font-weight:bold">.</span>path<span style="color:#000;font-weight:bold">.</span>exists(save_xml_path):
</span></span><span style="display:flex;"><span>        os<span style="color:#000;font-weight:bold">.</span>mkdir(save_xml_path)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">for</span> parent, _, files <span style="color:#000;font-weight:bold">in</span> os<span style="color:#000;font-weight:bold">.</span>walk(source_img_path):
</span></span><span style="display:flex;"><span>        files<span style="color:#000;font-weight:bold">.</span>sort()
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">for</span> file <span style="color:#000;font-weight:bold">in</span> files:
</span></span><span style="display:flex;"><span>            cnt <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>            pic_path <span style="color:#000;font-weight:bold">=</span> os<span style="color:#000;font-weight:bold">.</span>path<span style="color:#000;font-weight:bold">.</span>join(parent, file)
</span></span><span style="display:flex;"><span>            xml_path <span style="color:#000;font-weight:bold">=</span> os<span style="color:#000;font-weight:bold">.</span>path<span style="color:#000;font-weight:bold">.</span>join(source_xml_path, file[:<span style="color:#000;font-weight:bold">-</span><span style="color:#099">4</span>] <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#39;.xml&#39;</span>)
</span></span><span style="display:flex;"><span>            values <span style="color:#000;font-weight:bold">=</span> toolhelper<span style="color:#000;font-weight:bold">.</span>parse_xml(xml_path)  <span style="color:#998;font-style:italic"># 解析得到box信息，格式为[[x_min,y_min,x_max,y_max,name]]</span>
</span></span><span style="display:flex;"><span>            coords <span style="color:#000;font-weight:bold">=</span> [v[:<span style="color:#099">4</span>] <span style="color:#000;font-weight:bold">for</span> v <span style="color:#000;font-weight:bold">in</span> values]  <span style="color:#998;font-style:italic"># 得到框</span>
</span></span><span style="display:flex;"><span>            labels <span style="color:#000;font-weight:bold">=</span> [v[<span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span>] <span style="color:#000;font-weight:bold">for</span> v <span style="color:#000;font-weight:bold">in</span> values]  <span style="color:#998;font-style:italic"># 对象的标签</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic"># 如果图片是有后缀的</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">if</span> is_endwidth_dot:
</span></span><span style="display:flex;"><span>                <span style="color:#998;font-style:italic"># 找到文件的最后名字</span>
</span></span><span style="display:flex;"><span>                dot_index <span style="color:#000;font-weight:bold">=</span> file<span style="color:#000;font-weight:bold">.</span>rfind(<span style="color:#d14">&#39;.&#39;</span>)
</span></span><span style="display:flex;"><span>                _file_prefix <span style="color:#000;font-weight:bold">=</span> file[:dot_index]  <span style="color:#998;font-style:italic"># 文件名的前缀</span>
</span></span><span style="display:flex;"><span>                _file_suffix <span style="color:#000;font-weight:bold">=</span> file[dot_index:]  <span style="color:#998;font-style:italic"># 文件名的后缀</span>
</span></span><span style="display:flex;"><span>            img <span style="color:#000;font-weight:bold">=</span> cv2<span style="color:#000;font-weight:bold">.</span>imread(pic_path)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic"># show_pic(img, coords)  # 显示原图</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">while</span> cnt <span style="color:#000;font-weight:bold">&lt;</span> need_aug_num:  <span style="color:#998;font-style:italic"># 继续增强</span>
</span></span><span style="display:flex;"><span>                auged_img, auged_bboxes <span style="color:#000;font-weight:bold">=</span> dataAug<span style="color:#000;font-weight:bold">.</span>dataAugment(img, coords)
</span></span><span style="display:flex;"><span>                auged_bboxes_int <span style="color:#000;font-weight:bold">=</span> np<span style="color:#000;font-weight:bold">.</span>array(auged_bboxes)<span style="color:#000;font-weight:bold">.</span>astype(np<span style="color:#000;font-weight:bold">.</span>int32)
</span></span><span style="display:flex;"><span>                height, width, channel <span style="color:#000;font-weight:bold">=</span> auged_img<span style="color:#000;font-weight:bold">.</span>shape  <span style="color:#998;font-style:italic"># 得到图片的属性</span>
</span></span><span style="display:flex;"><span>                img_name <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">{}</span><span style="color:#d14">_</span><span style="color:#d14">{}{}</span><span style="color:#d14">&#39;</span><span style="color:#000;font-weight:bold">.</span>format(_file_prefix, cnt <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">1</span>, _file_suffix)  <span style="color:#998;font-style:italic"># 图片保存的信息</span>
</span></span><span style="display:flex;"><span>                toolhelper<span style="color:#000;font-weight:bold">.</span>save_img(img_name, save_img_path,
</span></span><span style="display:flex;"><span>                                    auged_img)  <span style="color:#998;font-style:italic"># 保存增强图片</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                toolhelper<span style="color:#000;font-weight:bold">.</span>save_xml(<span style="color:#d14">&#39;</span><span style="color:#d14">{}</span><span style="color:#d14">_</span><span style="color:#d14">{}</span><span style="color:#d14">.xml&#39;</span><span style="color:#000;font-weight:bold">.</span>format(_file_prefix, cnt <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">1</span>),
</span></span><span style="display:flex;"><span>                                    save_xml_path, (save_img_path, img_name), height, width, channel,
</span></span><span style="display:flex;"><span>                                    (labels, auged_bboxes_int))  <span style="color:#998;font-style:italic"># 保存xml文件</span>
</span></span><span style="display:flex;"><span>                <span style="color:#998;font-style:italic"># show_pic(auged_img, auged_bboxes)  # 强化后的图</span>
</span></span><span style="display:flex;"><span>                <span style="color:#0086b3">print</span>(img_name)
</span></span><span style="display:flex;"><span>                cnt <span style="color:#000;font-weight:bold">+=</span> <span style="color:#099">1</span>  <span style="color:#998;font-style:italic"># 继续增强下一张</span>
</span></span></code></pre></div><p><strong>这是扩充数据集后的效果图：</strong></p>
<p><img src="https://bu.dusays.com/2024/04/23/6627b07a28fd0.jpeg" alt=""></p>
<p><strong>接下来需要对扩充好的数据集进行 xml 转 txt：</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">xml.etree.ElementTree</span> <span style="color:#000;font-weight:bold">as</span> <span style="color:#555">ET</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">os</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">os</span> <span style="color:#000;font-weight:bold">import</span> getcwd
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">glob</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># 1.</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># 自己创建文件夹,例如：label_mal label_txt  也可以修改别的</span>
</span></span><span style="display:flex;"><span>image_set <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;xml&#39;</span>  <span style="color:#998;font-style:italic"># 需要转换的文件夹名称（文件夹内放xml标签文件）</span>
</span></span><span style="display:flex;"><span>imageset2 <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;labels2&#39;</span>  <span style="color:#998;font-style:italic"># 保存txt的文件夹</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># 2.</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># 换成你的类别 当前的顺序，就txt 0,1,2,3 四个类别</span>
</span></span><span style="display:flex;"><span>classes <span style="color:#000;font-weight:bold">=</span> [<span style="color:#d14">&#39;0&#39;</span>]  <span style="color:#998;font-style:italic"># 标注时的标签 注意顺序一定不要错。</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># 3.</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># # 转换文件夹的绝对路径</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># data_dir = &#39;D:/detectAuto_/data&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># 或者 读取当前路径</span>
</span></span><span style="display:flex;"><span>data_dir <span style="color:#000;font-weight:bold">=</span> getcwd()  <span style="color:#998;font-style:italic"># 当前路径</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#d14">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">xml中框的左上角坐标和右下角坐标(x1,y1,x2,y2)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">》》txt中的中心点坐标和宽和高(x,y,w,h)，并且归一化
</span></span></span><span style="display:flex;"><span><span style="color:#d14">&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">convert</span>(size, box):
</span></span><span style="display:flex;"><span>    dw <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1.</span> <span style="color:#000;font-weight:bold">/</span> size[<span style="color:#099">0</span>]
</span></span><span style="display:flex;"><span>    dh <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1.</span> <span style="color:#000;font-weight:bold">/</span> size[<span style="color:#099">1</span>]
</span></span><span style="display:flex;"><span>    x <span style="color:#000;font-weight:bold">=</span> (box[<span style="color:#099">0</span>] <span style="color:#000;font-weight:bold">+</span> box[<span style="color:#099">1</span>]) <span style="color:#000;font-weight:bold">/</span> <span style="color:#099">2.0</span>
</span></span><span style="display:flex;"><span>    y <span style="color:#000;font-weight:bold">=</span> (box[<span style="color:#099">2</span>] <span style="color:#000;font-weight:bold">+</span> box[<span style="color:#099">3</span>]) <span style="color:#000;font-weight:bold">/</span> <span style="color:#099">2.0</span>
</span></span><span style="display:flex;"><span>    w <span style="color:#000;font-weight:bold">=</span> box[<span style="color:#099">1</span>] <span style="color:#000;font-weight:bold">-</span> box[<span style="color:#099">0</span>]
</span></span><span style="display:flex;"><span>    h <span style="color:#000;font-weight:bold">=</span> box[<span style="color:#099">3</span>] <span style="color:#000;font-weight:bold">-</span> box[<span style="color:#099">2</span>]
</span></span><span style="display:flex;"><span>    x <span style="color:#000;font-weight:bold">=</span> x <span style="color:#000;font-weight:bold">*</span> dw
</span></span><span style="display:flex;"><span>    w <span style="color:#000;font-weight:bold">=</span> w <span style="color:#000;font-weight:bold">*</span> dw
</span></span><span style="display:flex;"><span>    y <span style="color:#000;font-weight:bold">=</span> y <span style="color:#000;font-weight:bold">*</span> dh
</span></span><span style="display:flex;"><span>    h <span style="color:#000;font-weight:bold">=</span> h <span style="color:#000;font-weight:bold">*</span> dh
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> (x, y, w, h)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">convert_annotation</span>(data_dir, imageset1, imageset2, image_id):
</span></span><span style="display:flex;"><span>    in_file <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">open</span>(data_dir <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#39;/</span><span style="color:#d14">%s</span><span style="color:#d14">/</span><span style="color:#d14">%s</span><span style="color:#d14">.xml&#39;</span> <span style="color:#000;font-weight:bold">%</span> (imageset1, image_id),encoding<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;UTF-8&#39;</span>)  <span style="color:#998;font-style:italic"># 读取xml</span>
</span></span><span style="display:flex;"><span>    out_file <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">open</span>(data_dir <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#39;/</span><span style="color:#d14">%s</span><span style="color:#d14">/</span><span style="color:#d14">%s</span><span style="color:#d14">.txt&#39;</span> <span style="color:#000;font-weight:bold">%</span> (imageset2, image_id), <span style="color:#d14">&#39;w&#39;</span>,encoding<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;UTF-8&#39;</span>)  <span style="color:#998;font-style:italic"># 保存txt</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    tree <span style="color:#000;font-weight:bold">=</span> ET<span style="color:#000;font-weight:bold">.</span>parse(in_file)
</span></span><span style="display:flex;"><span>    root <span style="color:#000;font-weight:bold">=</span> tree<span style="color:#000;font-weight:bold">.</span>getroot()
</span></span><span style="display:flex;"><span>    size <span style="color:#000;font-weight:bold">=</span> root<span style="color:#000;font-weight:bold">.</span>find(<span style="color:#d14">&#39;size&#39;</span>)
</span></span><span style="display:flex;"><span>    w <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">int</span>(size<span style="color:#000;font-weight:bold">.</span>find(<span style="color:#d14">&#39;width&#39;</span>)<span style="color:#000;font-weight:bold">.</span>text)
</span></span><span style="display:flex;"><span>    h <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">int</span>(size<span style="color:#000;font-weight:bold">.</span>find(<span style="color:#d14">&#39;height&#39;</span>)<span style="color:#000;font-weight:bold">.</span>text)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">for</span> obj <span style="color:#000;font-weight:bold">in</span> root<span style="color:#000;font-weight:bold">.</span>iter(<span style="color:#d14">&#39;object&#39;</span>):
</span></span><span style="display:flex;"><span>        difficult <span style="color:#000;font-weight:bold">=</span> obj<span style="color:#000;font-weight:bold">.</span>find(<span style="color:#d14">&#39;difficult&#39;</span>)<span style="color:#000;font-weight:bold">.</span>text
</span></span><span style="display:flex;"><span>        <span style="color:#999">cls</span> <span style="color:#000;font-weight:bold">=</span> obj<span style="color:#000;font-weight:bold">.</span>find(<span style="color:#d14">&#39;name&#39;</span>)<span style="color:#000;font-weight:bold">.</span>text
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">cls</span> <span style="color:#000;font-weight:bold">not</span> <span style="color:#000;font-weight:bold">in</span> classes <span style="color:#000;font-weight:bold">or</span> <span style="color:#0086b3">int</span>(difficult) <span style="color:#000;font-weight:bold">==</span> <span style="color:#099">1</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">continue</span>
</span></span><span style="display:flex;"><span>        cls_id <span style="color:#000;font-weight:bold">=</span> classes<span style="color:#000;font-weight:bold">.</span>index(<span style="color:#999">cls</span>)  <span style="color:#998;font-style:italic"># 获取类别索引</span>
</span></span><span style="display:flex;"><span>        xmlbox <span style="color:#000;font-weight:bold">=</span> obj<span style="color:#000;font-weight:bold">.</span>find(<span style="color:#d14">&#39;bndbox&#39;</span>)
</span></span><span style="display:flex;"><span>        b <span style="color:#000;font-weight:bold">=</span> (<span style="color:#0086b3">float</span>(xmlbox<span style="color:#000;font-weight:bold">.</span>find(<span style="color:#d14">&#39;xmin&#39;</span>)<span style="color:#000;font-weight:bold">.</span>text), <span style="color:#0086b3">float</span>(xmlbox<span style="color:#000;font-weight:bold">.</span>find(<span style="color:#d14">&#39;xmax&#39;</span>)<span style="color:#000;font-weight:bold">.</span>text), <span style="color:#0086b3">float</span>(xmlbox<span style="color:#000;font-weight:bold">.</span>find(<span style="color:#d14">&#39;ymin&#39;</span>)<span style="color:#000;font-weight:bold">.</span>text),
</span></span><span style="display:flex;"><span>             <span style="color:#0086b3">float</span>(xmlbox<span style="color:#000;font-weight:bold">.</span>find(<span style="color:#d14">&#39;ymax&#39;</span>)<span style="color:#000;font-weight:bold">.</span>text))
</span></span><span style="display:flex;"><span>        bb <span style="color:#000;font-weight:bold">=</span> convert((w, h), b)
</span></span><span style="display:flex;"><span>        out_file<span style="color:#000;font-weight:bold">.</span>write(<span style="color:#0086b3">str</span>(cls_id) <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#34; &#34;</span> <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#34; &#34;</span><span style="color:#000;font-weight:bold">.</span>join([<span style="color:#0086b3">str</span>(<span style="color:#d14">&#39;</span><span style="color:#d14">%.6f</span><span style="color:#d14">&#39;</span> <span style="color:#000;font-weight:bold">%</span> a) <span style="color:#000;font-weight:bold">for</span> a <span style="color:#000;font-weight:bold">in</span> bb]) <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#39;</span><span style="color:#d14">\n</span><span style="color:#d14">&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>image_ids <span style="color:#000;font-weight:bold">=</span> []
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">for</span> x <span style="color:#000;font-weight:bold">in</span> glob<span style="color:#000;font-weight:bold">.</span>glob(data_dir <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#39;/</span><span style="color:#d14">%s</span><span style="color:#d14">&#39;</span> <span style="color:#000;font-weight:bold">%</span> image_set <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#39;/*.xml&#39;</span>):
</span></span><span style="display:flex;"><span>    image_ids<span style="color:#000;font-weight:bold">.</span>append(os<span style="color:#000;font-weight:bold">.</span>path<span style="color:#000;font-weight:bold">.</span>basename(x)[:<span style="color:#000;font-weight:bold">-</span><span style="color:#099">4</span>])
</span></span><span style="display:flex;"><span><span style="color:#0086b3">print</span>(<span style="color:#d14">&#39;</span><span style="color:#d14">\n</span><span style="color:#d14">%s</span><span style="color:#d14">数量:&#39;</span> <span style="color:#000;font-weight:bold">%</span> image_set, <span style="color:#0086b3">len</span>(image_ids))  <span style="color:#998;font-style:italic"># 确认数量</span>
</span></span><span style="display:flex;"><span>i <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">for</span> image_id <span style="color:#000;font-weight:bold">in</span> image_ids:
</span></span><span style="display:flex;"><span>    i <span style="color:#000;font-weight:bold">=</span> i <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>    convert_annotation(data_dir, image_set, imageset2, image_id)
</span></span><span style="display:flex;"><span>    <span style="color:#0086b3">print</span>(<span style="color:#d14">&#34;</span><span style="color:#d14">%s</span><span style="color:#d14"> 数据:</span><span style="color:#d14">%s</span><span style="color:#d14">/</span><span style="color:#d14">%s</span><span style="color:#d14">文件完成！&#34;</span> <span style="color:#000;font-weight:bold">%</span> (image_set, i, <span style="color:#0086b3">len</span>(image_ids)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0086b3">print</span>(<span style="color:#d14">&#34;Done!!!&#34;</span>)
</span></span></code></pre></div><p>然后打包好数据集上传服务器</p>
<h2 id="autodl-训练效果">Autodl 训练效果</h2>
<hr>
<p>由于引入了数据集进行扩充后，图片的数量增多，训练时间也更长。</p>
<p><strong>50 轮训练的效果图：</strong></p>
<p><img src="https://bu.dusays.com/2024/04/23/6627b0cfc7a18.jpeg" alt=""></p>
<p><img src="https://bu.dusays.com/2024/04/23/6627b0e219483.jpeg" alt=""></p>
<p><strong>60 轮训练的效果图：</strong></p>
<p><img src="https://bu.dusays.com/2024/04/23/6627b0f6ba6c8.jpeg" alt=""></p>
<p><img src="https://bu.dusays.com/2024/04/23/6627b11e00ddd.jpeg" alt=""></p>
<p><strong>100 轮训练的效果图：</strong></p>
<p><img src="https://bu.dusays.com/2024/04/23/6627b1f607e8a.jpeg" alt=""></p>
<p><img src="https://bu.dusays.com/2024/04/23/6627b22dea65c.jpeg" alt=""></p>
<p>应该还是数据集的问题，出现了过拟合的现象。之后肯定还需要对数据集进行调整，另外由于采用的是最快的训练模型，在训练精度上肯定还有提升的空间。但之前在使用的时候，还出现了一些报错的情况，需要再花时间研究研究。</p>
<h2 id="测试模块的编写">测试模块的编写</h2>
<hr>
<p>在设计 GUI 之前，需要初步完成图片和视频检测的程序编写</p>
<p><strong>1.图片检测测试-核心代码摘录</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">predict</span>(img):
</span></span><span style="display:flex;"><span>    img <span style="color:#000;font-weight:bold">=</span> torch<span style="color:#000;font-weight:bold">.</span>from_numpy(img)<span style="color:#000;font-weight:bold">.</span>to(device)
</span></span><span style="display:flex;"><span>    img <span style="color:#000;font-weight:bold">=</span> img<span style="color:#000;font-weight:bold">.</span>half() <span style="color:#000;font-weight:bold">if</span> half <span style="color:#000;font-weight:bold">else</span> img<span style="color:#000;font-weight:bold">.</span>float()
</span></span><span style="display:flex;"><span>    img <span style="color:#000;font-weight:bold">/=</span> <span style="color:#099">255.0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> img<span style="color:#000;font-weight:bold">.</span>ndimension() <span style="color:#000;font-weight:bold">==</span> <span style="color:#099">3</span>:
</span></span><span style="display:flex;"><span>        img <span style="color:#000;font-weight:bold">=</span> img<span style="color:#000;font-weight:bold">.</span>unsqueeze(<span style="color:#099">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    t1 <span style="color:#000;font-weight:bold">=</span> time_synchronized()
</span></span><span style="display:flex;"><span>    pred <span style="color:#000;font-weight:bold">=</span> model(img, augment<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">False</span>)[<span style="color:#099">0</span>]
</span></span><span style="display:flex;"><span>    pred <span style="color:#000;font-weight:bold">=</span> non_max_suppression(pred, opt<span style="color:#000;font-weight:bold">.</span>conf_thres, opt<span style="color:#000;font-weight:bold">.</span>iou_thres, classes<span style="color:#000;font-weight:bold">=</span>opt<span style="color:#000;font-weight:bold">.</span>classes,
</span></span><span style="display:flex;"><span>                               agnostic<span style="color:#000;font-weight:bold">=</span>opt<span style="color:#000;font-weight:bold">.</span>agnostic_nms)
</span></span><span style="display:flex;"><span>    t2 <span style="color:#000;font-weight:bold">=</span> time_synchronized()
</span></span><span style="display:flex;"><span>    InferNms <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">round</span>((t2 <span style="color:#000;font-weight:bold">-</span> t1), <span style="color:#099">2</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> pred, InferNms
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">cv_imread</span>(filePath):
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic"># 读取图片</span>
</span></span><span style="display:flex;"><span>    cv_img <span style="color:#000;font-weight:bold">=</span> cv2<span style="color:#000;font-weight:bold">.</span>imdecode(np<span style="color:#000;font-weight:bold">.</span>fromfile(filePath, dtype<span style="color:#000;font-weight:bold">=</span>np<span style="color:#000;font-weight:bold">.</span>uint8), <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> <span style="color:#0086b3">len</span>(cv_img<span style="color:#000;font-weight:bold">.</span>shape) <span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#099">2</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> cv_img<span style="color:#000;font-weight:bold">.</span>shape[<span style="color:#099">2</span>] <span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#099">3</span>:
</span></span><span style="display:flex;"><span>            cv_img <span style="color:#000;font-weight:bold">=</span> cv_img[:, :, :<span style="color:#099">3</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> cv_img
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">plot_one_box</span>(img, x, color<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">None</span>, label<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">None</span>, line_thickness<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">None</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic"># Plots one bounding box on image img</span>
</span></span><span style="display:flex;"><span>    tl <span style="color:#000;font-weight:bold">=</span> line_thickness <span style="color:#000;font-weight:bold">or</span> <span style="color:#0086b3">round</span>(<span style="color:#099">0.002</span> <span style="color:#000;font-weight:bold">*</span> (img<span style="color:#000;font-weight:bold">.</span>shape[<span style="color:#099">0</span>] <span style="color:#000;font-weight:bold">+</span> img<span style="color:#000;font-weight:bold">.</span>shape[<span style="color:#099">1</span>]) <span style="color:#000;font-weight:bold">/</span> <span style="color:#099">2</span>) <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">1</span>  <span style="color:#998;font-style:italic"># line/font thickness</span>
</span></span><span style="display:flex;"><span>    color <span style="color:#000;font-weight:bold">=</span> color <span style="color:#000;font-weight:bold">or</span> [random<span style="color:#000;font-weight:bold">.</span>randint(<span style="color:#099">0</span>, <span style="color:#099">255</span>) <span style="color:#000;font-weight:bold">for</span> _ <span style="color:#000;font-weight:bold">in</span> <span style="color:#0086b3">range</span>(<span style="color:#099">3</span>)]
</span></span><span style="display:flex;"><span>    c1, c2 <span style="color:#000;font-weight:bold">=</span> (<span style="color:#0086b3">int</span>(x[<span style="color:#099">0</span>]), <span style="color:#0086b3">int</span>(x[<span style="color:#099">1</span>])), (<span style="color:#0086b3">int</span>(x[<span style="color:#099">2</span>]), <span style="color:#0086b3">int</span>(x[<span style="color:#099">3</span>]))
</span></span><span style="display:flex;"><span>    cv2<span style="color:#000;font-weight:bold">.</span>rectangle(img, c1, c2, color, thickness<span style="color:#000;font-weight:bold">=</span>tl, lineType<span style="color:#000;font-weight:bold">=</span>cv2<span style="color:#000;font-weight:bold">.</span>LINE_AA)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> label:
</span></span><span style="display:flex;"><span>        tf <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">max</span>(tl <span style="color:#000;font-weight:bold">-</span> <span style="color:#099">1</span>, <span style="color:#099">1</span>)  <span style="color:#998;font-style:italic"># font thickness</span>
</span></span><span style="display:flex;"><span>        t_size <span style="color:#000;font-weight:bold">=</span> cv2<span style="color:#000;font-weight:bold">.</span>getTextSize(label, <span style="color:#099">0</span>, fontScale<span style="color:#000;font-weight:bold">=</span>tl <span style="color:#000;font-weight:bold">/</span> <span style="color:#099">3</span>, thickness<span style="color:#000;font-weight:bold">=</span>tf)[<span style="color:#099">0</span>]
</span></span><span style="display:flex;"><span>        c2 <span style="color:#000;font-weight:bold">=</span> c1[<span style="color:#099">0</span>] <span style="color:#000;font-weight:bold">+</span> t_size[<span style="color:#099">0</span>], c1[<span style="color:#099">1</span>] <span style="color:#000;font-weight:bold">-</span> t_size[<span style="color:#099">1</span>] <span style="color:#000;font-weight:bold">-</span> <span style="color:#099">3</span>
</span></span><span style="display:flex;"><span>        cv2<span style="color:#000;font-weight:bold">.</span>rectangle(img, c1, c2, color, <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span>, cv2<span style="color:#000;font-weight:bold">.</span>LINE_AA)  <span style="color:#998;font-style:italic"># filled</span>
</span></span><span style="display:flex;"><span>        cv2<span style="color:#000;font-weight:bold">.</span>putText(img, label, (c1[<span style="color:#099">0</span>], c1[<span style="color:#099">1</span>] <span style="color:#000;font-weight:bold">-</span> <span style="color:#099">2</span>), <span style="color:#099">0</span>, tl <span style="color:#000;font-weight:bold">/</span> <span style="color:#099">3</span>, [<span style="color:#099">225</span>, <span style="color:#099">255</span>, <span style="color:#099">255</span>], thickness<span style="color:#000;font-weight:bold">=</span>tf, lineType<span style="color:#000;font-weight:bold">=</span>cv2<span style="color:#000;font-weight:bold">.</span>LINE_AA)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">if</span> __name__ <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    img_path <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;./UI_rec/testpicture/000743_slice_3_5.jpg&#34;</span>
</span></span><span style="display:flex;"><span>    image <span style="color:#000;font-weight:bold">=</span> cv_imread(img_path)
</span></span><span style="display:flex;"><span>    image <span style="color:#000;font-weight:bold">=</span> cv2<span style="color:#000;font-weight:bold">.</span>resize(image, (<span style="color:#099">640</span>, <span style="color:#099">640</span>))
</span></span><span style="display:flex;"><span>    img0 <span style="color:#000;font-weight:bold">=</span> image<span style="color:#000;font-weight:bold">.</span>copy()
</span></span><span style="display:flex;"><span>    img <span style="color:#000;font-weight:bold">=</span> letterbox(img0, new_shape<span style="color:#000;font-weight:bold">=</span>imgsz)[<span style="color:#099">0</span>]
</span></span><span style="display:flex;"><span>    img <span style="color:#000;font-weight:bold">=</span> np<span style="color:#000;font-weight:bold">.</span>stack(img, <span style="color:#099">0</span>)
</span></span><span style="display:flex;"><span>    img <span style="color:#000;font-weight:bold">=</span> img[:, :, ::<span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span>]<span style="color:#000;font-weight:bold">.</span>transpose(<span style="color:#099">2</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>)  <span style="color:#998;font-style:italic"># BGR to RGB, to 3x416x416</span>
</span></span><span style="display:flex;"><span>    img <span style="color:#000;font-weight:bold">=</span> np<span style="color:#000;font-weight:bold">.</span>ascontiguousarray(img)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    pred, useTime <span style="color:#000;font-weight:bold">=</span> predict(img)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    det <span style="color:#000;font-weight:bold">=</span> pred[<span style="color:#099">0</span>]
</span></span><span style="display:flex;"><span>    p, s, im0 <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">None</span>, <span style="color:#d14">&#39;&#39;</span>, img0
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> det <span style="color:#000;font-weight:bold">is</span> <span style="color:#000;font-weight:bold">not</span> <span style="color:#000;font-weight:bold">None</span> <span style="color:#000;font-weight:bold">and</span> <span style="color:#0086b3">len</span>(det):  <span style="color:#998;font-style:italic"># 如果有检测信息则进入</span>
</span></span><span style="display:flex;"><span>        det[:, :<span style="color:#099">4</span>] <span style="color:#000;font-weight:bold">=</span> scale_coords(img<span style="color:#000;font-weight:bold">.</span>shape[<span style="color:#099">1</span>:], det[:, :<span style="color:#099">4</span>], im0<span style="color:#000;font-weight:bold">.</span>shape)<span style="color:#000;font-weight:bold">.</span>round()  <span style="color:#998;font-style:italic"># 把图像缩放至im0的尺寸</span>
</span></span><span style="display:flex;"><span>        number_i <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>  <span style="color:#998;font-style:italic"># 类别预编号</span>
</span></span><span style="display:flex;"><span>        detInfo <span style="color:#000;font-weight:bold">=</span> []
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">*</span>xyxy, conf, <span style="color:#999">cls</span> <span style="color:#000;font-weight:bold">in</span> <span style="color:#0086b3">reversed</span>(det):  <span style="color:#998;font-style:italic"># 遍历检测信息</span>
</span></span><span style="display:flex;"><span>            c1, c2 <span style="color:#000;font-weight:bold">=</span> (<span style="color:#0086b3">int</span>(xyxy[<span style="color:#099">0</span>]), <span style="color:#0086b3">int</span>(xyxy[<span style="color:#099">1</span>])), (<span style="color:#0086b3">int</span>(xyxy[<span style="color:#099">2</span>]), <span style="color:#0086b3">int</span>(xyxy[<span style="color:#099">3</span>]))
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic"># 将检测信息添加到字典中</span>
</span></span><span style="display:flex;"><span>            detInfo<span style="color:#000;font-weight:bold">.</span>append([names[<span style="color:#0086b3">int</span>(<span style="color:#999">cls</span>)], [c1[<span style="color:#099">0</span>], c1[<span style="color:#099">1</span>], c2[<span style="color:#099">0</span>], c2[<span style="color:#099">1</span>]], <span style="color:#d14">&#39;</span><span style="color:#d14">%.2f</span><span style="color:#d14">&#39;</span> <span style="color:#000;font-weight:bold">%</span> conf])
</span></span><span style="display:flex;"><span>            number_i <span style="color:#000;font-weight:bold">+=</span> <span style="color:#099">1</span>  <span style="color:#998;font-style:italic"># 编号数+1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            label <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">%s</span><span style="color:#d14"> </span><span style="color:#d14">%.2f</span><span style="color:#d14">&#39;</span> <span style="color:#000;font-weight:bold">%</span> (names[<span style="color:#0086b3">int</span>(<span style="color:#999">cls</span>)], conf)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic"># 画出检测到的目标物</span>
</span></span><span style="display:flex;"><span>            plot_one_box(image, xyxy, label<span style="color:#000;font-weight:bold">=</span>label, color<span style="color:#000;font-weight:bold">=</span>colors[<span style="color:#0086b3">int</span>(<span style="color:#999">cls</span>)])
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic"># 实时显示检测画面</span>
</span></span><span style="display:flex;"><span>    cv2<span style="color:#000;font-weight:bold">.</span>imshow(<span style="color:#d14">&#39;Stream&#39;</span>, image)
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic"># if cv2.waitKey(1) &amp; 0xFF == ord(&#39;q&#39;):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">#     break</span>
</span></span><span style="display:flex;"><span>    c <span style="color:#000;font-weight:bold">=</span> cv2<span style="color:#000;font-weight:bold">.</span>waitKey(<span style="color:#099">0</span>) <span style="color:#000;font-weight:bold">&amp;</span> <span style="color:#099">0xff</span>
</span></span></code></pre></div><p><img src="https://bu.dusays.com/2024/04/23/6627b25442ff4.jpeg" alt=""></p>
<p>2.<strong>视频检测测试-核心代码摘录</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">predict</span>(img):
</span></span><span style="display:flex;"><span>    img <span style="color:#000;font-weight:bold">=</span> torch<span style="color:#000;font-weight:bold">.</span>from_numpy(img)<span style="color:#000;font-weight:bold">.</span>to(device)
</span></span><span style="display:flex;"><span>    img <span style="color:#000;font-weight:bold">=</span> img<span style="color:#000;font-weight:bold">.</span>half() <span style="color:#000;font-weight:bold">if</span> half <span style="color:#000;font-weight:bold">else</span> img<span style="color:#000;font-weight:bold">.</span>float()
</span></span><span style="display:flex;"><span>    img <span style="color:#000;font-weight:bold">/=</span> <span style="color:#099">255.0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> img<span style="color:#000;font-weight:bold">.</span>ndimension() <span style="color:#000;font-weight:bold">==</span> <span style="color:#099">3</span>:
</span></span><span style="display:flex;"><span>        img <span style="color:#000;font-weight:bold">=</span> img<span style="color:#000;font-weight:bold">.</span>unsqueeze(<span style="color:#099">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    t1 <span style="color:#000;font-weight:bold">=</span> time_synchronized()
</span></span><span style="display:flex;"><span>    pred <span style="color:#000;font-weight:bold">=</span> model(img, augment<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">False</span>)[<span style="color:#099">0</span>]
</span></span><span style="display:flex;"><span>    pred <span style="color:#000;font-weight:bold">=</span> non_max_suppression(pred, opt<span style="color:#000;font-weight:bold">.</span>conf_thres, opt<span style="color:#000;font-weight:bold">.</span>iou_thres, classes<span style="color:#000;font-weight:bold">=</span>opt<span style="color:#000;font-weight:bold">.</span>classes,
</span></span><span style="display:flex;"><span>                               agnostic<span style="color:#000;font-weight:bold">=</span>opt<span style="color:#000;font-weight:bold">.</span>agnostic_nms)
</span></span><span style="display:flex;"><span>    t2 <span style="color:#000;font-weight:bold">=</span> time_synchronized()
</span></span><span style="display:flex;"><span>    InferNms <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">round</span>((t2 <span style="color:#000;font-weight:bold">-</span> t1), <span style="color:#099">2</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> pred, InferNms
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">plot_one_box</span>(img, x, color<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">None</span>, label<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">None</span>, line_thickness<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">None</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic"># Plots one bounding box on image img</span>
</span></span><span style="display:flex;"><span>    tl <span style="color:#000;font-weight:bold">=</span> line_thickness <span style="color:#000;font-weight:bold">or</span> <span style="color:#0086b3">round</span>(<span style="color:#099">0.002</span> <span style="color:#000;font-weight:bold">*</span> (img<span style="color:#000;font-weight:bold">.</span>shape[<span style="color:#099">0</span>] <span style="color:#000;font-weight:bold">+</span> img<span style="color:#000;font-weight:bold">.</span>shape[<span style="color:#099">1</span>]) <span style="color:#000;font-weight:bold">/</span> <span style="color:#099">2</span>) <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">1</span>  <span style="color:#998;font-style:italic"># line/font thickness</span>
</span></span><span style="display:flex;"><span>    color <span style="color:#000;font-weight:bold">=</span> color <span style="color:#000;font-weight:bold">or</span> [random<span style="color:#000;font-weight:bold">.</span>randint(<span style="color:#099">0</span>, <span style="color:#099">255</span>) <span style="color:#000;font-weight:bold">for</span> _ <span style="color:#000;font-weight:bold">in</span> <span style="color:#0086b3">range</span>(<span style="color:#099">3</span>)]
</span></span><span style="display:flex;"><span>    c1, c2 <span style="color:#000;font-weight:bold">=</span> (<span style="color:#0086b3">int</span>(x[<span style="color:#099">0</span>]), <span style="color:#0086b3">int</span>(x[<span style="color:#099">1</span>])), (<span style="color:#0086b3">int</span>(x[<span style="color:#099">2</span>]), <span style="color:#0086b3">int</span>(x[<span style="color:#099">3</span>]))
</span></span><span style="display:flex;"><span>    cv2<span style="color:#000;font-weight:bold">.</span>rectangle(img, c1, c2, color, thickness<span style="color:#000;font-weight:bold">=</span>tl, lineType<span style="color:#000;font-weight:bold">=</span>cv2<span style="color:#000;font-weight:bold">.</span>LINE_AA)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> label:
</span></span><span style="display:flex;"><span>        tf <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">max</span>(tl <span style="color:#000;font-weight:bold">-</span> <span style="color:#099">1</span>, <span style="color:#099">1</span>)  <span style="color:#998;font-style:italic"># font thickness</span>
</span></span><span style="display:flex;"><span>        t_size <span style="color:#000;font-weight:bold">=</span> cv2<span style="color:#000;font-weight:bold">.</span>getTextSize(label, <span style="color:#099">0</span>, fontScale<span style="color:#000;font-weight:bold">=</span>tl <span style="color:#000;font-weight:bold">/</span> <span style="color:#099">3</span>, thickness<span style="color:#000;font-weight:bold">=</span>tf)[<span style="color:#099">0</span>]
</span></span><span style="display:flex;"><span>        c2 <span style="color:#000;font-weight:bold">=</span> c1[<span style="color:#099">0</span>] <span style="color:#000;font-weight:bold">+</span> t_size[<span style="color:#099">0</span>], c1[<span style="color:#099">1</span>] <span style="color:#000;font-weight:bold">-</span> t_size[<span style="color:#099">1</span>] <span style="color:#000;font-weight:bold">-</span> <span style="color:#099">3</span>
</span></span><span style="display:flex;"><span>        cv2<span style="color:#000;font-weight:bold">.</span>rectangle(img, c1, c2, color, <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span>, cv2<span style="color:#000;font-weight:bold">.</span>LINE_AA)  <span style="color:#998;font-style:italic"># filled</span>
</span></span><span style="display:flex;"><span>        cv2<span style="color:#000;font-weight:bold">.</span>putText(img, label, (c1[<span style="color:#099">0</span>], c1[<span style="color:#099">1</span>] <span style="color:#000;font-weight:bold">-</span> <span style="color:#099">2</span>), <span style="color:#099">0</span>, tl <span style="color:#000;font-weight:bold">/</span> <span style="color:#099">3</span>, [<span style="color:#099">225</span>, <span style="color:#099">255</span>, <span style="color:#099">255</span>], thickness<span style="color:#000;font-weight:bold">=</span>tf, lineType<span style="color:#000;font-weight:bold">=</span>cv2<span style="color:#000;font-weight:bold">.</span>LINE_AA)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">if</span> __name__ <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">#video_path = 1</span>
</span></span><span style="display:flex;"><span>    video_path <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;UI_rec/testvideo/test.mp4&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic"># 初始化视频流</span>
</span></span><span style="display:flex;"><span>    vs <span style="color:#000;font-weight:bold">=</span> cv2<span style="color:#000;font-weight:bold">.</span>VideoCapture(video_path)
</span></span><span style="display:flex;"><span>    (W, H) <span style="color:#000;font-weight:bold">=</span> (<span style="color:#000;font-weight:bold">None</span>, <span style="color:#000;font-weight:bold">None</span>)
</span></span><span style="display:flex;"><span>    frameIndex <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>  <span style="color:#998;font-style:italic"># 视频帧数</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">try</span>:
</span></span><span style="display:flex;"><span>        prop <span style="color:#000;font-weight:bold">=</span> cv2<span style="color:#000;font-weight:bold">.</span>CAP_PROP_FRAME_COUNT
</span></span><span style="display:flex;"><span>        total <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">int</span>(vs<span style="color:#000;font-weight:bold">.</span>get(prop))
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># print(&#34;[INFO] 视频总帧数：{}&#34;.format(total))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic"># 若读取失败，报错退出</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">except</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#0086b3">print</span>(<span style="color:#d14">&#34;[INFO] could not determine # of frames in video&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#0086b3">print</span>(<span style="color:#d14">&#34;[INFO] no approx. completion time can be provided&#34;</span>)
</span></span><span style="display:flex;"><span>        total <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    fourcc <span style="color:#000;font-weight:bold">=</span> cv2<span style="color:#000;font-weight:bold">.</span>VideoWriter_fourcc(<span style="color:#000;font-weight:bold">*</span><span style="color:#d14">&#39;XVID&#39;</span>)
</span></span><span style="display:flex;"><span>    ret, frame <span style="color:#000;font-weight:bold">=</span> vs<span style="color:#000;font-weight:bold">.</span>read()
</span></span><span style="display:flex;"><span>    vw <span style="color:#000;font-weight:bold">=</span> frame<span style="color:#000;font-weight:bold">.</span>shape[<span style="color:#099">1</span>]
</span></span><span style="display:flex;"><span>    vh <span style="color:#000;font-weight:bold">=</span> frame<span style="color:#000;font-weight:bold">.</span>shape[<span style="color:#099">0</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#0086b3">print</span>(<span style="color:#d14">&#34;[INFO] 视频尺寸：</span><span style="color:#d14">{}</span><span style="color:#d14"> * </span><span style="color:#d14">{}</span><span style="color:#d14">&#34;</span><span style="color:#000;font-weight:bold">.</span>format(vw, vh))
</span></span><span style="display:flex;"><span>    output_video <span style="color:#000;font-weight:bold">=</span> cv2<span style="color:#000;font-weight:bold">.</span>VideoWriter(<span style="color:#d14">&#34;./UI_rec/result/results.avi&#34;</span>, fourcc, <span style="color:#099">20.0</span>, (vw, vh))  <span style="color:#998;font-style:italic"># 处理后的视频对象</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic"># 遍历视频帧进行检测</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">while</span> <span style="color:#000;font-weight:bold">True</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># 从视频文件中逐帧读取画面</span>
</span></span><span style="display:flex;"><span>        (grabbed, image) <span style="color:#000;font-weight:bold">=</span> vs<span style="color:#000;font-weight:bold">.</span>read()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># 若grabbed为空，表示视频到达最后一帧，退出</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">not</span> grabbed:
</span></span><span style="display:flex;"><span>            <span style="color:#0086b3">print</span>(<span style="color:#d14">&#34;[INFO] 运行结束...&#34;</span>)
</span></span><span style="display:flex;"><span>            output_video<span style="color:#000;font-weight:bold">.</span>release()
</span></span><span style="display:flex;"><span>            vs<span style="color:#000;font-weight:bold">.</span>release()
</span></span><span style="display:flex;"><span>            exit()
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># 获取画面长宽</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> W <span style="color:#000;font-weight:bold">is</span> <span style="color:#000;font-weight:bold">None</span> <span style="color:#000;font-weight:bold">or</span> H <span style="color:#000;font-weight:bold">is</span> <span style="color:#000;font-weight:bold">None</span>:
</span></span><span style="display:flex;"><span>            (H, W) <span style="color:#000;font-weight:bold">=</span> image<span style="color:#000;font-weight:bold">.</span>shape[:<span style="color:#099">2</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        image <span style="color:#000;font-weight:bold">=</span> cv2<span style="color:#000;font-weight:bold">.</span>resize(image, (<span style="color:#099">640</span>, <span style="color:#099">640</span>))
</span></span><span style="display:flex;"><span>        img0 <span style="color:#000;font-weight:bold">=</span> image<span style="color:#000;font-weight:bold">.</span>copy()
</span></span><span style="display:flex;"><span>        img <span style="color:#000;font-weight:bold">=</span> letterbox(img0, new_shape<span style="color:#000;font-weight:bold">=</span>imgsz)[<span style="color:#099">0</span>]
</span></span><span style="display:flex;"><span>        img <span style="color:#000;font-weight:bold">=</span> np<span style="color:#000;font-weight:bold">.</span>stack(img, <span style="color:#099">0</span>)
</span></span><span style="display:flex;"><span>        img <span style="color:#000;font-weight:bold">=</span> img[:, :, ::<span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span>]<span style="color:#000;font-weight:bold">.</span>transpose(<span style="color:#099">2</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>)  <span style="color:#998;font-style:italic"># BGR to RGB, to 3x416x416</span>
</span></span><span style="display:flex;"><span>        img <span style="color:#000;font-weight:bold">=</span> np<span style="color:#000;font-weight:bold">.</span>ascontiguousarray(img)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        pred, useTime <span style="color:#000;font-weight:bold">=</span> predict(img)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        det <span style="color:#000;font-weight:bold">=</span> pred[<span style="color:#099">0</span>]
</span></span><span style="display:flex;"><span>        p, s, im0 <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">None</span>, <span style="color:#d14">&#39;&#39;</span>, img0
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> det <span style="color:#000;font-weight:bold">is</span> <span style="color:#000;font-weight:bold">not</span> <span style="color:#000;font-weight:bold">None</span> <span style="color:#000;font-weight:bold">and</span> <span style="color:#0086b3">len</span>(det):  <span style="color:#998;font-style:italic"># 如果有检测信息则进入</span>
</span></span><span style="display:flex;"><span>            det[:, :<span style="color:#099">4</span>] <span style="color:#000;font-weight:bold">=</span> scale_coords(img<span style="color:#000;font-weight:bold">.</span>shape[<span style="color:#099">1</span>:], det[:, :<span style="color:#099">4</span>], im0<span style="color:#000;font-weight:bold">.</span>shape)<span style="color:#000;font-weight:bold">.</span>round()  <span style="color:#998;font-style:italic"># 把图像缩放至im0的尺寸</span>
</span></span><span style="display:flex;"><span>            number_i <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>  <span style="color:#998;font-style:italic"># 类别预编号</span>
</span></span><span style="display:flex;"><span>            detInfo <span style="color:#000;font-weight:bold">=</span> []
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">*</span>xyxy, conf, <span style="color:#999">cls</span> <span style="color:#000;font-weight:bold">in</span> <span style="color:#0086b3">reversed</span>(det):  <span style="color:#998;font-style:italic"># 遍历检测信息</span>
</span></span><span style="display:flex;"><span>                c1, c2 <span style="color:#000;font-weight:bold">=</span> (<span style="color:#0086b3">int</span>(xyxy[<span style="color:#099">0</span>]), <span style="color:#0086b3">int</span>(xyxy[<span style="color:#099">1</span>])), (<span style="color:#0086b3">int</span>(xyxy[<span style="color:#099">2</span>]), <span style="color:#0086b3">int</span>(xyxy[<span style="color:#099">3</span>]))
</span></span><span style="display:flex;"><span>                <span style="color:#998;font-style:italic"># 将检测信息添加到字典中</span>
</span></span><span style="display:flex;"><span>                detInfo<span style="color:#000;font-weight:bold">.</span>append([names[<span style="color:#0086b3">int</span>(<span style="color:#999">cls</span>)], [c1[<span style="color:#099">0</span>], c1[<span style="color:#099">1</span>], c2[<span style="color:#099">0</span>], c2[<span style="color:#099">1</span>]], <span style="color:#d14">&#39;</span><span style="color:#d14">%.2f</span><span style="color:#d14">&#39;</span> <span style="color:#000;font-weight:bold">%</span> conf])
</span></span><span style="display:flex;"><span>                number_i <span style="color:#000;font-weight:bold">+=</span> <span style="color:#099">1</span>  <span style="color:#998;font-style:italic"># 编号数+1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                label <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">%s</span><span style="color:#d14"> </span><span style="color:#d14">%.2f</span><span style="color:#d14">&#39;</span> <span style="color:#000;font-weight:bold">%</span> (names[<span style="color:#0086b3">int</span>(<span style="color:#999">cls</span>)], conf)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#998;font-style:italic"># 画出检测到的目标物</span>
</span></span><span style="display:flex;"><span>                plot_one_box(image, xyxy, label<span style="color:#000;font-weight:bold">=</span>label, color<span style="color:#000;font-weight:bold">=</span>colors[<span style="color:#0086b3">int</span>(<span style="color:#999">cls</span>)])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># 实时显示检测画面</span>
</span></span><span style="display:flex;"><span>        cv2<span style="color:#000;font-weight:bold">.</span>imshow(<span style="color:#d14">&#39;Stream&#39;</span>, image)
</span></span><span style="display:flex;"><span>        image <span style="color:#000;font-weight:bold">=</span> cv2<span style="color:#000;font-weight:bold">.</span>resize(image, (vw, vh))
</span></span><span style="display:flex;"><span>        output_video<span style="color:#000;font-weight:bold">.</span>write(image)  <span style="color:#998;font-style:italic"># 保存标记后的视频</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> cv2<span style="color:#000;font-weight:bold">.</span>waitKey(<span style="color:#099">1</span>) <span style="color:#000;font-weight:bold">&amp;</span> <span style="color:#099">0xFF</span> <span style="color:#000;font-weight:bold">==</span> <span style="color:#0086b3">ord</span>(<span style="color:#d14">&#39;q&#39;</span>):
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">break</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># print(&#34;FPS:{}&#34;.format(int(0.6/(end-start))))</span>
</span></span><span style="display:flex;"><span>        frameIndex <span style="color:#000;font-weight:bold">+=</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># if frameIndex &gt;= total:  # 可设置检测的最大帧数提前退出</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">#     print(&#34;[INFO] 运行结束...&#34;)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">#     output_video.release()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">#     vs.release()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">#     exit()</span>
</span></span></code></pre></div><p><a href="https://www.bilibili.com/video/BV1Lm421E7M2/?spm_id_from=333.999.0.0&amp;vd_source=237e295a40d7aaea043ead8c0d2c78ab">效果呈现</a></p>
<h2 id="gui-界面">GUI 界面</h2>
<hr>
<p><strong>主控程序：</strong></p>
<p><img src="https://bu.dusays.com/2024/04/23/6627b273e3d5f.jpeg" alt=""></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># -*- coding: utf-8 -*-</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># runMain.py</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">sys</span> <span style="color:#000;font-weight:bold">import</span> argv, exit
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#这行代码从sys模块中导入了两个函数：argv和exit。argv是一个命令行参数的列表，当从终端运行Python脚本时，可以通过这个列表访问这些参数。exit函数用于退出Python程序。</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">PyQt5.QtWidgets</span> <span style="color:#000;font-weight:bold">import</span> QApplication
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#这行代码从PyQt5的QtWidgets模块中导入了QApplication类。QApplication类管理GUI应用程序的控制流和主要设置，是所有基于Qt的GUI应用程序的起点。</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">bboxRecognition</span> <span style="color:#000;font-weight:bold">import</span> bbox_MainWindow
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#这行代码从bboxRecognition模块（可能是一个自定义模块）中导入了一个名为bbox_MainWindow的类。这个类用于识别黑匣子。</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">if</span> __name__ <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#这行代码检查是否是直接运行这个脚本，而不是作为模块导入到其他脚本中。如果是直接运行，那么下面的代码块将被执行</span>
</span></span><span style="display:flex;"><span>    app <span style="color:#000;font-weight:bold">=</span> QApplication(argv)
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#这行代码创建了一个QApplication实例，它是任何PyQt5应用程序的入口点。argv参数传递给QApplication，这样它就可以处理来自命令行的参数。</span>
</span></span><span style="display:flex;"><span>    win <span style="color:#000;font-weight:bold">=</span> bbox_MainWindow()
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#这行代码创建了box_MainWindow类的一个实例，这个实例很可能是应用程序的主窗口。</span>
</span></span><span style="display:flex;"><span>    win<span style="color:#000;font-weight:bold">.</span>showTime()
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#与时间相关的功能。</span>
</span></span><span style="display:flex;"><span>    exit(app<span style="color:#000;font-weight:bold">.</span>exec_())
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#最后，这行代码启动了应用程序的主事件循环，通过调用exec_()方法。当事件循环开始后，应用程序将等待用户事件并响应他们。exit函数确保应用程序可以干净地退出，返回码将传递给exit，以便操作系统可以知道程序是正常退出还是发生了错误。</span>
</span></span></code></pre></div><p><strong>简要摘录核心功能代码：</strong></p>
<p>1.启动 GUI 界面</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#这段代码定义了一个名为bbox_MainWindow的类，它继承自QBeautyUI。这个类是一个GUI窗口，用于某种目标检测或者视频处理应用程序。</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">bbox_MainWindow</span>(QBeautyUI):
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">#这行代码调用父类QBeautyUI的构造函数，确保继承的功能得到正确初始化。</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> __init__(<span style="color:#999">self</span>, <span style="color:#000;font-weight:bold">*</span>args, obj<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">None</span>, <span style="color:#000;font-weight:bold">**</span>kwargs):
</span></span><span style="display:flex;"><span>        <span style="color:#0086b3">super</span>(bbox_MainWindow, <span style="color:#999">self</span>)<span style="color:#000;font-weight:bold">.</span>__init__(<span style="color:#000;font-weight:bold">*</span>args, <span style="color:#000;font-weight:bold">**</span>kwargs)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>setupUi(<span style="color:#999">self</span>)  <span style="color:#998;font-style:italic"># 界面生成</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>retranslateUi(<span style="color:#999">self</span>)  <span style="color:#998;font-style:italic"># 界面控件</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">#这两行代码可能调用了在QBeautyUI中定义的方法，用于初始化和设置用户界面。</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>setUiStyle(window_flag<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">True</span>, transBack_flag<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">True</span>)  <span style="color:#998;font-style:italic"># 设置界面样式</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">#这行代码调用setUiStyle方法来设置窗口的样式，是使窗口透明或者应用其他视觉效果。</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>path <span style="color:#000;font-weight:bold">=</span> getcwd()
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>video_path <span style="color:#000;font-weight:bold">=</span> getcwd()
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">#这里设置了两个路径变量，self.path和self.video_path，它们都被初始化为当前工作目录的路径。</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>timer_camera <span style="color:#000;font-weight:bold">=</span> QtCore<span style="color:#000;font-weight:bold">.</span>QTimer()  <span style="color:#998;font-style:italic"># 定时器</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>timer_video <span style="color:#000;font-weight:bold">=</span> QtCore<span style="color:#000;font-weight:bold">.</span>QTimer()  <span style="color:#998;font-style:italic"># 视频定时器</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>flag_timer <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;&#34;</span>  <span style="color:#998;font-style:italic"># 用于标记正在进行的功能项（视频/摄像）</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>LoadModel()  <span style="color:#998;font-style:italic"># 加载预训练模型</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>slot_init()  <span style="color:#998;font-style:italic"># 定义槽函数，这是Qt中用于处理信号和槽机制的函数，用于响应事件。</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>files <span style="color:#000;font-weight:bold">=</span> []  <span style="color:#998;font-style:italic">#</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>cap_video <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">None</span>  <span style="color:#998;font-style:italic"># 视频流对象</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>CAM_NUM <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>  <span style="color:#998;font-style:italic"># 摄像头标号</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>cap <span style="color:#000;font-weight:bold">=</span> cv2<span style="color:#000;font-weight:bold">.</span>VideoCapture(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>CAM_NUM)  <span style="color:#998;font-style:italic"># 屏幕画面对象</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">#这几行代码初始化了一些变量，包括一个空列表self.files，一个空的视频流对象self.cap_video，一个摄像头编号self.CAM_NUM，以及使用cv2.VideoCapture创建的摄像头视频捕获对象self.cap。</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>detInfo <span style="color:#000;font-weight:bold">=</span> []
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>current_image <span style="color:#000;font-weight:bold">=</span> []
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>detected_image <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">None</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># self.dataset = None</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>count <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>  <span style="color:#998;font-style:italic"># 表格行数，用于记录识别识别条目</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>res_set <span style="color:#000;font-weight:bold">=</span> []  <span style="color:#998;font-style:italic"># 用于历史结果记录的列表</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>c_video <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>count_name <span style="color:#000;font-weight:bold">=</span> [<span style="color:#d14">&#34;黑匣子&#34;</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>count_table <span style="color:#000;font-weight:bold">=</span> []
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">#这一部分初始化了更多的变量，包括用于存储检测信息、当前图像、检测到的图像、结果集和其他相关数据的列表和变量。</span>
</span></span></code></pre></div><ol>
<li>读取预训练模型</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">LoadModel</span>(<span style="color:#999">self</span>, model_path<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">None</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        读取预训练模型
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        parser <span style="color:#000;font-weight:bold">=</span> argparse<span style="color:#000;font-weight:bold">.</span>ArgumentParser()
</span></span><span style="display:flex;"><span>        parser<span style="color:#000;font-weight:bold">.</span>add_argument(<span style="color:#d14">&#39;--weights&#39;</span>, nargs<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;+&#39;</span>, <span style="color:#0086b3">type</span><span style="color:#000;font-weight:bold">=</span><span style="color:#0086b3">str</span>, default<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;../weights/best.pt&#39;</span>,
</span></span><span style="display:flex;"><span>                            help<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;model.pt path(s)&#39;</span>)  <span style="color:#998;font-style:italic"># 模型路径仅支持.pt文件</span>
</span></span><span style="display:flex;"><span>        parser<span style="color:#000;font-weight:bold">.</span>add_argument(<span style="color:#d14">&#39;--img-size&#39;</span>, <span style="color:#0086b3">type</span><span style="color:#000;font-weight:bold">=</span><span style="color:#0086b3">int</span>, default<span style="color:#000;font-weight:bold">=</span><span style="color:#099">480</span>, help<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;inference size (pixels)&#39;</span>)  <span style="color:#998;font-style:italic"># 检测图像大小，仅支持480</span>
</span></span><span style="display:flex;"><span>        parser<span style="color:#000;font-weight:bold">.</span>add_argument(<span style="color:#d14">&#39;--conf-thres&#39;</span>, <span style="color:#0086b3">type</span><span style="color:#000;font-weight:bold">=</span><span style="color:#0086b3">float</span>, default<span style="color:#000;font-weight:bold">=</span><span style="color:#099">0.25</span>, help<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;object confidence threshold&#39;</span>)  <span style="color:#998;font-style:italic"># 置信度阈值</span>
</span></span><span style="display:flex;"><span>        parser<span style="color:#000;font-weight:bold">.</span>add_argument(<span style="color:#d14">&#39;--iou-thres&#39;</span>, <span style="color:#0086b3">type</span><span style="color:#000;font-weight:bold">=</span><span style="color:#0086b3">float</span>, default<span style="color:#000;font-weight:bold">=</span><span style="color:#099">0.45</span>, help<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;IOU threshold for NMS&#39;</span>)  <span style="color:#998;font-style:italic"># NMS阈值</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># 选中运行机器的GPU或者cpu，有GPU则GPU，没有则cpu，若想仅使用cpu，可以填cpu即可</span>
</span></span><span style="display:flex;"><span>        parser<span style="color:#000;font-weight:bold">.</span>add_argument(<span style="color:#d14">&#39;--device&#39;</span>, default<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;0&#39;</span>,
</span></span><span style="display:flex;"><span>                            help<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;cuda device, i.e. 0 or 0,1,2,3 or cpu&#39;</span>)
</span></span><span style="display:flex;"><span>        parser<span style="color:#000;font-weight:bold">.</span>add_argument(<span style="color:#d14">&#39;--save-dir&#39;</span>, <span style="color:#0086b3">type</span><span style="color:#000;font-weight:bold">=</span><span style="color:#0086b3">str</span>, default<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;inference&#39;</span>, help<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;directory to save results&#39;</span>)  <span style="color:#998;font-style:italic"># 文件保存路径</span>
</span></span><span style="display:flex;"><span>        parser<span style="color:#000;font-weight:bold">.</span>add_argument(<span style="color:#d14">&#39;--classes&#39;</span>, nargs<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;+&#39;</span>, <span style="color:#0086b3">type</span><span style="color:#000;font-weight:bold">=</span><span style="color:#0086b3">int</span>,
</span></span><span style="display:flex;"><span>                            help<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;filter by class: --class 0, or --class 0 2 3&#39;</span>)  <span style="color:#998;font-style:italic"># 分开类别</span>
</span></span><span style="display:flex;"><span>        parser<span style="color:#000;font-weight:bold">.</span>add_argument(<span style="color:#d14">&#39;--agnostic-nms&#39;</span>, action<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;store_true&#39;</span>, help<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;class-agnostic NMS&#39;</span>)  <span style="color:#998;font-style:italic"># 使用NMS</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>opt <span style="color:#000;font-weight:bold">=</span> parser<span style="color:#000;font-weight:bold">.</span>parse_args()  <span style="color:#998;font-style:italic"># opt局部变量，重要</span>
</span></span><span style="display:flex;"><span>        out, weight, imgsz <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>opt<span style="color:#000;font-weight:bold">.</span>save_dir, <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>opt<span style="color:#000;font-weight:bold">.</span>weights, <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>opt<span style="color:#000;font-weight:bold">.</span>img_size  <span style="color:#998;font-style:italic"># 得到文件保存路径，文件权重路径，图像尺寸</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>device <span style="color:#000;font-weight:bold">=</span> select_device(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>opt<span style="color:#000;font-weight:bold">.</span>device)  <span style="color:#998;font-style:italic"># 检验计算单元,gpu还是cpu</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>half <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>device<span style="color:#000;font-weight:bold">.</span>type <span style="color:#000;font-weight:bold">!=</span> <span style="color:#d14">&#39;0&#39;</span>  <span style="color:#998;font-style:italic"># 如果使用gpu则进行半精度推理</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> model_path:
</span></span><span style="display:flex;"><span>            weight <span style="color:#000;font-weight:bold">=</span> model_path
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>model <span style="color:#000;font-weight:bold">=</span> attempt_load(weight, map_location<span style="color:#000;font-weight:bold">=</span><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>device)  <span style="color:#998;font-style:italic"># 读取模型</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>imgsz <span style="color:#000;font-weight:bold">=</span> check_img_size(imgsz, s<span style="color:#000;font-weight:bold">=</span><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>model<span style="color:#000;font-weight:bold">.</span>stride<span style="color:#000;font-weight:bold">.</span>max())  <span style="color:#998;font-style:italic"># 检查图像尺寸</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>half:  <span style="color:#998;font-style:italic"># 如果是半精度推理</span>
</span></span><span style="display:flex;"><span>            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>model<span style="color:#000;font-weight:bold">.</span>half()  <span style="color:#998;font-style:italic"># 转换模型的格式</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>names <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>model<span style="color:#000;font-weight:bold">.</span>module<span style="color:#000;font-weight:bold">.</span>names <span style="color:#000;font-weight:bold">if</span> <span style="color:#0086b3">hasattr</span>(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>model, <span style="color:#d14">&#39;module&#39;</span>) <span style="color:#000;font-weight:bold">else</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>model<span style="color:#000;font-weight:bold">.</span>names  <span style="color:#998;font-style:italic"># 得到模型训练的类别名</span>
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    这段代码定义了一个名为 `LoadModel` 的方法，它用于加载预训练的机器学习模型，并对模型进行一些初始化设置。这个方法是用于深度学习模型的推理（inference）的准备工作。具体来看，方法的功能包括：
</span></span></span><span style="display:flex;"><span><span style="color:#d14">1. **参数解析**：
</span></span></span><span style="display:flex;"><span><span style="color:#d14">   使用 `argparse` 库来解析命令行参数。这些参数包括模型权重文件的路径、输入图像的大小、置信度阈值、IOU阈值、计算设备（CPU或GPU）、结果保存目录、类别过滤以及是否使用类别无关的非极大值抑制（NMS）。
</span></span></span><span style="display:flex;"><span><span style="color:#d14">2. **设置默认参数**：
</span></span></span><span style="display:flex;"><span><span style="color:#d14">   如果在调用方法时没有指定 `model_path`，它会使用默认的参数设置。
</span></span></span><span style="display:flex;"><span><span style="color:#d14">3. **选择计算设备**：
</span></span></span><span style="display:flex;"><span><span style="color:#d14">   使用 `select_device` 函数（这个函数在代码中没有给出，但可以推断它的功能是选择使用CPU还是GPU进行计算）。
</span></span></span><span style="display:flex;"><span><span style="color:#d14">4. **模型加载**：
</span></span></span><span style="display:flex;"><span><span style="color:#d14">   使用 `attempt_load` 函数加载模型，这个函数可能是一个自定义函数或者来自某个库，用于加载模型并将其映射到指定的计算设备上。
</span></span></span><span style="display:flex;"><span><span style="color:#d14">5. **图像尺寸检查**：
</span></span></span><span style="display:flex;"><span><span style="color:#d14">   使用 `check_img_size` 函数确保输入图像的尺寸与模型的步长兼容。
</span></span></span><span style="display:flex;"><span><span style="color:#d14">6. **半精度推理**：
</span></span></span><span style="display:flex;"><span><span style="color:#d14">   如果计算设备是GPU，则将模型转换为半精度（float16），这样可以加快推理速度并减少内存使用。
</span></span></span><span style="display:flex;"><span><span style="color:#d14">7. **类别名称处理**：
</span></span></span><span style="display:flex;"><span><span style="color:#d14">   获取模型训练时的类别名称，并且如果这些名称在 `Chinese_name` 字典中有对应的中文名称，就替换为中文名称。
</span></span></span><span style="display:flex;"><span><span style="color:#d14">8. **颜色分配**：
</span></span></span><span style="display:flex;"><span><span style="color:#d14">   为每个类别分配一个颜色，这通常用于在图像上绘制检测结果。如果类别的数量没有超过预定义的颜色列表 `color`，它会使用这些颜色；否则，会随机生成颜色。
</span></span></span><span style="display:flex;"><span><span style="color:#d14">9. **预推理**：
</span></span></span><span style="display:flex;"><span><span style="color:#d14">   创建一个零图像张量，并通过模型进行一次前向传递，这通常是为了让模型在实际推理之前“热身”，确保CUDA核心已经加载，从而在后续的推理中能够更快。
</span></span></span><span style="display:flex;"><span><span style="color:#d14">这个方法是深度学习模型部署的常见步骤的集合，用于准备模型进行后续的图像处理和对象检测任务。代码中提到的一些函数和变量（如 `select_device`, `attempt_load`, `check_img_size`, `Chinese_name`）没有在这段代码中定义，所以它们的具体实现细节是未知的，但从上下文中可以推测它们的大致功能。
</span></span></span></code></pre></div><p>3.融合检测程序-如上面所呈现</p>
<h2 id="后续多模态的融合">后续多模态的融合</h2>
<hr>
<p>后续完成基础可见光条件的训练之后，还要尝试进行多光谱的融合，提高模型的精确度。</p>
<h1 id="20240413-会议纪要">20240413 会议纪要</h1>
<hr>
<ul>
<li>明确可检测的图片，进行界限的区分；</li>
<li>在可见光条件下，界定遮挡比例</li>
<li>黑匣子出现极端位置（例如垂直放置情况下），识别灵敏度的控制</li>
<li>漏检率不能低于 5%</li>
<li>提高验证集的数量，要有统计结果，配合导出检测结果</li>
<li>更改 GUI 界面的配色</li>
<li>使用多光谱网络模型</li>
<li>预计五月初开始论文的撰写</li>
</ul>
<h1 id="总结">总结</h1>
<hr>
<p>这篇文章随进度更新，用于记录在毕设过程中遇到的心得和问题。</p>

    </div>

    

    

    <div class="container-prevnext">
    <div><a href="https://hugo.matrixcore.life/posts/%E6%83%85%E7%BB%AA%E8%A1%A8%E8%BE%BE/240309/">← [生活感悟] 中断、预终提醒和协同管理</a></div>
    <div><a href="https://hugo.matrixcore.life/posts/%E5%AF%B9%E8%AF%9D%E6%9C%AA%E6%9D%A5/note/">[观点探讨] 末端创作的方式   →</a></div>
</div>
    
    

    
</div>

        </div>
        <div id="footer"><div class="container-footer">
    
    <a href="//beian.miit.gov.cn" target="_blank">
        
        萌ICP备20241020号
        
    </a>
    <a id="s" href="/secrets">&nbsp;</a>
    
</div></div>
    </body>
</html>
